{"remainingRequest":"/Users/hyunjongkim/Documents/GitHub/palura-frontend/client-v1.0/node_modules/babel-loader/lib/index.js!/Users/hyunjongkim/Documents/GitHub/palura-frontend/client-v1.0/src/parula-js/src/parula.js","dependencies":[{"path":"/Users/hyunjongkim/Documents/GitHub/palura-frontend/client-v1.0/src/parula-js/src/parula.js","mtime":1637808730642},{"path":"/Users/hyunjongkim/Documents/GitHub/palura-frontend/client-v1.0/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/hyunjongkim/Documents/GitHub/palura-frontend/client-v1.0/node_modules/babel-loader/lib/index.js","mtime":315532800000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:dmFyIF90eXBlb2YgPSByZXF1aXJlKCIvVXNlcnMvaHl1bmpvbmdraW0vRG9jdW1lbnRzL0dpdEh1Yi9wYWx1cmEtZnJvbnRlbmQvY2xpZW50LXYxLjAvbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lL2hlbHBlcnMvdHlwZW9mIikuZGVmYXVsdDsKCnZhciBfb2JqZWN0U3ByZWFkID0gcmVxdWlyZSgiL1VzZXJzL2h5dW5qb25na2ltL0RvY3VtZW50cy9HaXRIdWIvcGFsdXJhLWZyb250ZW5kL2NsaWVudC12MS4wL25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL29iamVjdFNwcmVhZDIiKS5kZWZhdWx0OwoKdmFyIF9hc3luY1RvR2VuZXJhdG9yID0gcmVxdWlyZSgiL1VzZXJzL2h5dW5qb25na2ltL0RvY3VtZW50cy9HaXRIdWIvcGFsdXJhLWZyb250ZW5kL2NsaWVudC12MS4wL25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2FzeW5jVG9HZW5lcmF0b3IiKS5kZWZhdWx0OwoKdmFyIF9jbGFzc0NhbGxDaGVjayA9IHJlcXVpcmUoIi9Vc2Vycy9oeXVuam9uZ2tpbS9Eb2N1bWVudHMvR2l0SHViL3BhbHVyYS1mcm9udGVuZC9jbGllbnQtdjEuMC9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9jbGFzc0NhbGxDaGVjayIpLmRlZmF1bHQ7Cgp2YXIgX2NyZWF0ZUNsYXNzID0gcmVxdWlyZSgiL1VzZXJzL2h5dW5qb25na2ltL0RvY3VtZW50cy9HaXRIdWIvcGFsdXJhLWZyb250ZW5kL2NsaWVudC12MS4wL25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2NyZWF0ZUNsYXNzIikuZGVmYXVsdDsKCnJlcXVpcmUoInJlZ2VuZXJhdG9yLXJ1bnRpbWUvcnVudGltZS5qcyIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLm9iamVjdC5rZXlzLmpzIik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMubnVtYmVyLmNvbnN0cnVjdG9yLmpzIik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvd2ViLmRvbS1jb2xsZWN0aW9ucy5mb3ItZWFjaC5qcyIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LmNvbmNhdC5qcyIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLm9iamVjdC50by1zdHJpbmcuanMiKTsKCnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lcy5yZWdleHAudG8tc3RyaW5nLmpzIik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMubnVtYmVyLnRvLWZpeGVkLmpzIik7Cgp2YXIgX3JlcXVpcmUgPSByZXF1aXJlKCJmYmVtaXR0ZXIiKSwKICAgIEV2ZW50RW1pdHRlciA9IF9yZXF1aXJlLkV2ZW50RW1pdHRlcjsKCnZhciBXZWIzID0gcmVxdWlyZSgid2ViMyIpOwoKdmFyIF9yZXF1aXJlMiA9IHJlcXVpcmUoIi4vdXRpbHMvdXRpbHMuanMiKSwKICAgIG1ha2VDb250cmFjdEluc3RhbmNlID0gX3JlcXVpcmUyLm1ha2VDb250cmFjdEluc3RhbmNlLAogICAgY29uZmlybVRyYW5zYWN0aW9uID0gX3JlcXVpcmUyLmNvbmZpcm1UcmFuc2FjdGlvbiwKICAgIGNyZWF0ZVR5cGVkRGF0YUFuZFNpZ25hdHVyZSA9IF9yZXF1aXJlMi5jcmVhdGVUeXBlZERhdGFBbmRTaWduYXR1cmUsCiAgICByZWNvdmVyVHlwZWRTaWduYXR1cmUgPSBfcmVxdWlyZTIucmVjb3ZlclR5cGVkU2lnbmF0dXJlLAogICAgZW5jID0gX3JlcXVpcmUyLmVuYywKICAgIGRlY0Fzc2V0ID0gX3JlcXVpcmUyLmRlY0Fzc2V0LAogICAgZW5jRGF0YVYxID0gX3JlcXVpcmUyLmVuY0RhdGFWMTsKCnZhciBfcmVxdWlyZTMgPSByZXF1aXJlKCcuL2FwaScpLAogICAgUGFydWxhQVBJID0gX3JlcXVpcmUzLlBhcnVsYUFQSTsKCnZhciBfcmVxdWlyZTQgPSByZXF1aXJlKCIuL2NvbnN0YW50cyIpLAogICAgTlVMTF9CTE9DS19IQVNIID0gX3JlcXVpcmU0Lk5VTExfQkxPQ0tfSEFTSCwKICAgIFpFUk9fQUREUkVTUyA9IF9yZXF1aXJlNC5aRVJPX0FERFJFU1MsCiAgICBPUkRFUl9EQVRBX1YxID0gX3JlcXVpcmU0Lk9SREVSX0RBVEFfVjEsCiAgICBFUkMyMCA9IF9yZXF1aXJlNC5FUkMyMCwKICAgIEVSQzcyMSA9IF9yZXF1aXJlNC5FUkM3MjEsCiAgICBFUkMxMTU1ID0gX3JlcXVpcmU0LkVSQzExNTUsCiAgICBFVEggPSBfcmVxdWlyZTQuRVRIOwoKdmFyIF9yZXF1aXJlNSA9IHJlcXVpcmUoIi4vdHlwZXMiKSwKICAgIE5ldHdvcmsgPSBfcmVxdWlyZTUuTmV0d29yaywKICAgIEV2ZW50VHlwZSA9IF9yZXF1aXJlNS5FdmVudFR5cGUsCiAgICBPcmRlciA9IF9yZXF1aXJlNS5PcmRlciwKICAgIEFzc2V0ID0gX3JlcXVpcmU1LkFzc2V0OwoKdmFyIF9yZXF1aXJlNiA9IHJlcXVpcmUoIi4vY29udHJhY3RzIiksCiAgICBORlRDb250cmFjdCA9IF9yZXF1aXJlNi5ORlRDb250cmFjdCwKICAgIE5GVDExNTVDb250cmFjdCA9IF9yZXF1aXJlNi5ORlQxMTU1Q29udHJhY3QsCiAgICBFeGNoYW5nZSA9IF9yZXF1aXJlNi5FeGNoYW5nZSwKICAgIFJveWFsdGllc1JlZ2lzdHJ5ID0gX3JlcXVpcmU2LlJveWFsdGllc1JlZ2lzdHJ5LAogICAgSUVSQzIwID0gX3JlcXVpcmU2LklFUkMyMCwKICAgIElFUkMxNjUgPSBfcmVxdWlyZTYuSUVSQzE2NSwKICAgIElFUkMxMTU1ID0gX3JlcXVpcmU2LklFUkMxMTU1OwoKdmFyIF9yZXF1aXJlNyA9IHJlcXVpcmUoIi4uL2NvbmZpZ3Mvcmlua2VieSIpLAogICAgY29uZmlnID0gX3JlcXVpcmU3LmNvbmZpZzsgLy8gZGVmYXVsdENvbmZpZwoKCnZhciBQYXJ1bGEgPSAvKiNfX1BVUkVfXyovZnVuY3Rpb24gKCkgewogICJ1c2Ugc3RyaWN0IjsKCiAgZnVuY3Rpb24gUGFydWxhKHByb3ZpZGVyKSB7CiAgICB2YXIgYXBpQ29uZmlnID0gYXJndW1lbnRzLmxlbmd0aCA+IDEgJiYgYXJndW1lbnRzWzFdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMV0gOiB7fTsKICAgIHZhciBsb2dnZXIgPSBhcmd1bWVudHMubGVuZ3RoID4gMiA/IGFyZ3VtZW50c1syXSA6IHVuZGVmaW5lZDsKCiAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgUGFydWxhKTsKCiAgICAvLyBhcGlDb25maWcuZ2FzUHJpY2UgPSBhcGlDb25maWcuZ2FzUHJpY2UgfHwgbWFrZUJpZ051bWJlcigzMDAwMDApCiAgICBpZiAoT2JqZWN0LmtleXMoYXBpQ29uZmlnKSA9PSAwKSB7CiAgICAgIGFwaUNvbmZpZyA9IGNvbmZpZzsKICAgIH0KCiAgICBpZiAoTnVtYmVyKHByb3ZpZGVyLmNoYWluSWQpICE9IGFwaUNvbmZpZy5jaGFpbklkKSB7CiAgICAgIHRocm93ICJwYXJ1bGEtanMuY29uc3RydWN0b3I6OiBwcm92aWRlci5jaGFpbl9pZCAhPSBjb25maWcuY2hhaW5faWQiOwogICAgfQoKICAgIHRoaXMubmV0d29ya05hbWUgPSBhcGlDb25maWcubmV0d29ya05hbWU7CiAgICB0aGlzLm5ldElkID0gYXBpQ29uZmlnLm5ldElkOwogICAgdGhpcy5uZnRBZGRyZXNzID0gYXBpQ29uZmlnLm5mdEFkZHJlc3M7CiAgICB0aGlzLm5mdDExNTVBZGRyZXNzID0gYXBpQ29uZmlnLm5mdDExNTVBZGRyZXNzOwogICAgdGhpcy5leGNoYW5nZUFkZHJlc3MgPSBhcGlDb25maWcuZXhjaGFuZ2VBZGRyZXNzOwogICAgdGhpcy5yb3lhbHRpZXNBZGRyZXNzID0gYXBpQ29uZmlnLnJveWFsdGllc1JlZ2lzdHJ5QWRkcmVzczsKICAgIHRoaXMudHJhbnNmZXJQcm94eUFkZHJlc3MgPSBhcGlDb25maWcudHJhbnNmZXJQcm94eUFkZHJlc3M7CiAgICB0aGlzLmVyYzIwVHJhbnNmZXJQcm94eUFkZHJlc3MgPSBhcGlDb25maWcuZXJjMjBUcmFuc2ZlclByb3h5QWRkcmVzczsKICAgIHZhciBuZWVkZWRQcm9wZXJ0aWVzID0gWyduZnRBZGRyZXNzJywgJ25mdDExNTVBZGRyZXNzJywgJ25ldElkJywgJ25ldHdvcmtOYW1lJywgJ3JlYWRvbmx5UHJvdmlkZXJVcmwnLCAnZXhjaGFuZ2VBZGRyZXNzJywgJ3JveWFsdGllc1JlZ2lzdHJ5QWRkcmVzcycsICd0cmFuc2ZlclByb3h5QWRkcmVzcycsICdlcmMyMFRyYW5zZmVyUHJveHlBZGRyZXNzJ107CiAgICBuZWVkZWRQcm9wZXJ0aWVzLmZvckVhY2goZnVuY3Rpb24gKHByb3BOYW1lKSB7CiAgICAgIGlmIChhcGlDb25maWdbcHJvcE5hbWVdID09IHVuZGVmaW5lZCkgewogICAgICAgIHRocm93ICJDb25maWd1cmF0aW9uIG5lZWRlZCAnIi5jb25jYXQocHJvcE5hbWUsICInIGlzIG5vdCBkZWZpbmVkIik7CiAgICAgIH0KICAgIH0pOyAvLyBXZWIzIENvbmZpZwoKICAgIHRoaXMud2ViMyA9IG5ldyBXZWIzKHByb3ZpZGVyKTsKICAgIHRoaXMud2ViM1JlYWRPbmx5ID0gbmV3IFdlYjMoYXBpQ29uZmlnLnJlYWRvbmx5UHJvdmlkZXJVcmwpOwogICAgdGhpcy5nYXNQcmljZUFkZGl0aW9uID0gbmV3IFdlYjMudXRpbHMuQk4oMSk7CiAgICBhcGlDb25maWcud2ViMyA9IHRoaXMud2ViM1JlYWRPbmx5OwogICAgdGhpcy5hcGkgPSBuZXcgUGFydWxhQVBJKGFwaUNvbmZpZywgbG9nZ2VyKTsKCiAgICB0aGlzLmxvZ2dlciA9IGxvZ2dlciB8fCBmdW5jdGlvbiAoYXJnKSB7CiAgICAgIHJldHVybiBhcmc7CiAgICB9OwoKICAgIHRoaXMuX2VtaXR0ZXIgPSBuZXcgRXZlbnRFbWl0dGVyKCk7CiAgfQoKICBfY3JlYXRlQ2xhc3MoUGFydWxhLCBbewogICAga2V5OiAiY3JlYXRlQXJ0d29yayIsCiAgICB2YWx1ZTogZnVuY3Rpb24gKCkgewogICAgICB2YXIgX2NyZWF0ZUFydHdvcmsgPSBfYXN5bmNUb0dlbmVyYXRvciggLyojX19QVVJFX18qL3JlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUoc2lnbmVyKSB7CiAgICAgICAgdmFyIF90aGlzID0gdGhpczsKCiAgICAgICAgdmFyIG93bmVyLAogICAgICAgICAgICBlcmM3MjFtZXRhZGF0YVVSTCwKICAgICAgICAgICAgcm95YWx0aWVzLAogICAgICAgICAgICB0bywKICAgICAgICAgICAgbmZ0X2NvbnRyYWN0LAogICAgICAgICAgICBfY2FsbG9iaiwKICAgICAgICAgICAgZnJvbSwKICAgICAgICAgICAgX3BhcmFtLAogICAgICAgICAgICByZXQsCiAgICAgICAgICAgIF9hcmdzID0gYXJndW1lbnRzOwoKICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZSQoX2NvbnRleHQpIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQucHJldiA9IF9jb250ZXh0Lm5leHQpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICBvd25lciA9IF9hcmdzLmxlbmd0aCA+IDEgJiYgX2FyZ3NbMV0gIT09IHVuZGVmaW5lZCA/IF9hcmdzWzFdIDogJyc7CiAgICAgICAgICAgICAgICBlcmM3MjFtZXRhZGF0YVVSTCA9IF9hcmdzLmxlbmd0aCA+IDIgJiYgX2FyZ3NbMl0gIT09IHVuZGVmaW5lZCA/IF9hcmdzWzJdIDogJyc7CiAgICAgICAgICAgICAgICByb3lhbHRpZXMgPSBfYXJncy5sZW5ndGggPiAzICYmIF9hcmdzWzNdICE9PSB1bmRlZmluZWQgPyBfYXJnc1szXSA6IFtdOwoKICAgICAgICAgICAgICAgIHRoaXMuX3ZlcmlmeVBhcmFtQWRkcmVzcyhbc2lnbmVyXSk7CgogICAgICAgICAgICAgICAgaWYgKG93bmVyKSB7CiAgICAgICAgICAgICAgICAgIHRoaXMuX3ZlcmlmeVBhcmFtQWRkcmVzcyhbb3duZXJdKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgIG93bmVyID0gc2lnbmVyOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHRvID0gdGhpcy5uZnRBZGRyZXNzOwogICAgICAgICAgICAgICAgbmZ0X2NvbnRyYWN0ID0gdGhpcy5fbWFrZUNvbnRyYWN0SW5zdGFuY2UoTkZUQ29udHJhY3QsIHRoaXMubmZ0QWRkcmVzcyk7CiAgICAgICAgICAgICAgICAvLyBjaGVjayByb3lhbHRpZXMgdmFsaWQKICAgICAgICAgICAgICAgIHJveWFsdGllcy5mb3JFYWNoKGZ1bmN0aW9uIChyb3lhbHR5KSB7CiAgICAgICAgICAgICAgICAgIC8vIGNoZWNrIHJveWFsdHkgYWNjb3VudAogICAgICAgICAgICAgICAgICB2YXIgaXNfdmFsaWRfYWRkcmVzcyA9IF90aGlzLndlYjMudXRpbHMuaXNBZGRyZXNzKHJveWFsdHlbMF0pOwoKICAgICAgICAgICAgICAgICAgaWYgKCFpc192YWxpZF9hZGRyZXNzKSB7CiAgICAgICAgICAgICAgICAgICAgdGhyb3cgImZhaWwgdG8gbWludCB3aXRoIHJveWFsdHksIGludmFsaWQgYWRkcmVzczogIi5jb25jYXQocm95YWx0eVswXSk7CiAgICAgICAgICAgICAgICAgIH0gLy8gY2hlY2sgcm95YWx0eSB2YWx1ZQoKCiAgICAgICAgICAgICAgICAgIHZhciBfdmFsID0gTnVtYmVyKHJveWFsdHlbMV0pOwoKICAgICAgICAgICAgICAgICAgaWYgKGlzTmFOKF92YWwpIHx8IF92YWwgPCAxIHx8IF92YWwgPiA1MDApIHsKICAgICAgICAgICAgICAgICAgICAvLyAxfjUwMAogICAgICAgICAgICAgICAgICAgIHRocm93ICJmYWlsIHRvIG1pbnQgd2l0aCByb3lhbHR5LCBpbnZhbGlkIHZhbHVlOiAiLmNvbmNhdChyb3lhbHR5WzFdKTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhyb3lhbHRpZXMpOwoKICAgICAgICAgICAgICAgIGlmIChyb3lhbHRpZXMubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgICB0aGlzLl92ZXJpZnlQYXJhbVR5cGVQYXJ0KFtyb3lhbHRpZXNdKTsKCiAgICAgICAgICAgICAgICAgIF9jYWxsb2JqID0gbmZ0X2NvbnRyYWN0Lm1ldGhvZHMubWludEl0ZW1XaXRoUm95YWx0eShvd25lciwgZXJjNzIxbWV0YWRhdGFVUkwsIG93bmVyLCByb3lhbHRpZXMpOyAvLyByb3lhbHR5T3duZXIsIHJveWFsdGllcwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgX2NhbGxvYmogPSBuZnRfY29udHJhY3QubWV0aG9kcy5taW50SXRlbShvd25lciwgZXJjNzIxbWV0YWRhdGFVUkwpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGZyb20gPSBzaWduZXI7CiAgICAgICAgICAgICAgICBfcGFyYW0gPSB7fTsKICAgICAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSAxNDsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnNlbmRUcmFuc2FjdGlvbkFuZENvbmZpcm0oZnJvbSwgdG8sIF9jYWxsb2JqLCBfcGFyYW0sIEV2ZW50VHlwZS5UcmFuc2FjdGlvbkNyZWF0ZWQsICJDcmVhdGUgTkZUIik7CgogICAgICAgICAgICAgIGNhc2UgMTQ6CiAgICAgICAgICAgICAgICByZXQgPSBfY29udGV4dC5zZW50OwoKICAgICAgICAgICAgICAgIGlmICghcmV0LnN0YXR1cykgewogICAgICAgICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gMTk7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSAxODsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9leHRyYWN0VHJhbnNmZXJJbmZvKHJldC50eC50cmFuc2FjdGlvbkhhc2gpOwoKICAgICAgICAgICAgICBjYXNlIDE4OgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0LmFicnVwdCgicmV0dXJuIiwgX2NvbnRleHQuc2VudCk7CgogICAgICAgICAgICAgIGNhc2UgMTk6CiAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dC5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlLCB0aGlzKTsKICAgICAgfSkpOwoKICAgICAgZnVuY3Rpb24gY3JlYXRlQXJ0d29yayhfeCkgewogICAgICAgIHJldHVybiBfY3JlYXRlQXJ0d29yay5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICB9CgogICAgICByZXR1cm4gY3JlYXRlQXJ0d29yazsKICAgIH0oKQogIH0sIHsKICAgIGtleTogImNyZWF0ZUFydHdvcmsxMTU1IiwKICAgIHZhbHVlOiBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBfY3JlYXRlQXJ0d29yazIgPSBfYXN5bmNUb0dlbmVyYXRvciggLyojX19QVVJFX18qL3JlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUyKHNpZ25lcikgewogICAgICAgIHZhciBvd25lciwKICAgICAgICAgICAgZXJjNzIxbWV0YWRhdGFVUkwsCiAgICAgICAgICAgIGlkLAogICAgICAgICAgICBxdWFudGl0eSwKICAgICAgICAgICAgcm95YWx0aWVzLAogICAgICAgICAgICB0bywKICAgICAgICAgICAgbmZ0X2NvbnRyYWN0LAogICAgICAgICAgICBfY2FsbG9iaiwKICAgICAgICAgICAgZnJvbSwKICAgICAgICAgICAgX3BhcmFtLAogICAgICAgICAgICByZXQsCiAgICAgICAgICAgIF9hcmdzMiA9IGFyZ3VtZW50czsKCiAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUyJChfY29udGV4dDIpIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQyLnByZXYgPSBfY29udGV4dDIubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIG93bmVyID0gX2FyZ3MyLmxlbmd0aCA+IDEgJiYgX2FyZ3MyWzFdICE9PSB1bmRlZmluZWQgPyBfYXJnczJbMV0gOiAnJzsKICAgICAgICAgICAgICAgIGVyYzcyMW1ldGFkYXRhVVJMID0gX2FyZ3MyLmxlbmd0aCA+IDIgJiYgX2FyZ3MyWzJdICE9PSB1bmRlZmluZWQgPyBfYXJnczJbMl0gOiAnJzsKICAgICAgICAgICAgICAgIGlkID0gX2FyZ3MyLmxlbmd0aCA+IDMgJiYgX2FyZ3MyWzNdICE9PSB1bmRlZmluZWQgPyBfYXJnczJbM10gOiAwOwogICAgICAgICAgICAgICAgcXVhbnRpdHkgPSBfYXJnczIubGVuZ3RoID4gNCAmJiBfYXJnczJbNF0gIT09IHVuZGVmaW5lZCA/IF9hcmdzMls0XSA6IDE7CiAgICAgICAgICAgICAgICByb3lhbHRpZXMgPSBfYXJnczIubGVuZ3RoID4gNSAmJiBfYXJnczJbNV0gIT09IHVuZGVmaW5lZCA/IF9hcmdzMls1XSA6IFtdOwoKICAgICAgICAgICAgICAgIHRoaXMuX3ZlcmlmeVBhcmFtQWRkcmVzcyhbc2lnbmVyXSk7CgogICAgICAgICAgICAgICAgaWYgKG93bmVyKSB7CiAgICAgICAgICAgICAgICAgIHRoaXMuX3ZlcmlmeVBhcmFtQWRkcmVzcyhbb3duZXJdKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgIG93bmVyID0gc2lnbmVyOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHRoaXMuX3ZlcmlmeVBhcmFtVWludE51bWJlcihbaWQsIHF1YW50aXR5XSk7CgogICAgICAgICAgICAgICAgdG8gPSB0aGlzLm5mdDExNTVBZGRyZXNzOwogICAgICAgICAgICAgICAgbmZ0X2NvbnRyYWN0ID0gdGhpcy5fbWFrZUNvbnRyYWN0SW5zdGFuY2UoTkZUMTE1NUNvbnRyYWN0LCB0aGlzLm5mdDExNTVBZGRyZXNzKTsKCiAgICAgICAgICAgICAgICBpZiAocm95YWx0aWVzLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgICAgdGhpcy5fdmVyaWZ5UGFyYW1UeXBlUGFydChbcm95YWx0aWVzXSk7CgogICAgICAgICAgICAgICAgICBfY2FsbG9iaiA9IG5mdF9jb250cmFjdC5tZXRob2RzLm1pbnRJdGVtV2l0aFJveWFsdHkob3duZXIsIGlkLCBxdWFudGl0eSwgW10sIG93bmVyLCByb3lhbHRpZXMpOyAvLywgcm95YWx0eU93bmVyLCByb3lhbHRpZXMKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgIF9jYWxsb2JqID0gbmZ0X2NvbnRyYWN0Lm1ldGhvZHMubWludEl0ZW0ob3duZXIsIGlkLCBxdWFudGl0eSwgW10pOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGZyb20gPSBzaWduZXI7CiAgICAgICAgICAgICAgICBfcGFyYW0gPSB7fTsKICAgICAgICAgICAgICAgIF9jb250ZXh0Mi5uZXh0ID0gMTU7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5zZW5kVHJhbnNhY3Rpb25BbmRDb25maXJtKGZyb20sIHRvLCBfY2FsbG9iaiwgX3BhcmFtLCBFdmVudFR5cGUuVHJhbnNhY3Rpb25DcmVhdGVkLCAiQ3JlYXRlIE5GVCIpOwoKICAgICAgICAgICAgICBjYXNlIDE1OgogICAgICAgICAgICAgICAgcmV0ID0gX2NvbnRleHQyLnNlbnQ7CgogICAgICAgICAgICAgICAgaWYgKCFyZXQuc3RhdHVzKSB7CiAgICAgICAgICAgICAgICAgIF9jb250ZXh0Mi5uZXh0ID0gMjA7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIF9jb250ZXh0Mi5uZXh0ID0gMTk7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fZXh0cmFjdFRyYW5zZmVySW5mbyhyZXQudHgudHJhbnNhY3Rpb25IYXNoKTsKCiAgICAgICAgICAgICAgY2FzZSAxOToKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDIuYWJydXB0KCJyZXR1cm4iLCBfY29udGV4dDIuc2VudCk7CgogICAgICAgICAgICAgIGNhc2UgMjA6CiAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDIuc3RvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZTIsIHRoaXMpOwogICAgICB9KSk7CgogICAgICBmdW5jdGlvbiBjcmVhdGVBcnR3b3JrMTE1NShfeDIpIHsKICAgICAgICByZXR1cm4gX2NyZWF0ZUFydHdvcmsyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgIH0KCiAgICAgIHJldHVybiBjcmVhdGVBcnR3b3JrMTE1NTsKICAgIH0oKQogIH0sIHsKICAgIGtleTogImNyZWF0ZVNlbGxPcmRlciIsCiAgICB2YWx1ZTogZnVuY3Rpb24gKCkgewogICAgICB2YXIgX2NyZWF0ZVNlbGxPcmRlciA9IF9hc3luY1RvR2VuZXJhdG9yKCAvKiNfX1BVUkVfXyovcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTMoX3JlZikgewogICAgICAgIHZhciBtYWtlciwgbWFUeXBlTVYsIG1hQ29udHJhY3RBZGRyZXNzLCBtYVZhbHVlLCBfcmVmJHF1YW50aXR5LCBxdWFudGl0eSwgX3JlZiR0YWtlciwgdGFrZXIsIHRhVHlwZU1WLCB0YUNvbnRyYWN0QWRkcmVzcywgdGFWYWx1ZSwgX3JlZiRzYWx0LCBzYWx0LCBfcmVmJHN0YXJ0RGF0ZXRpbWUsIHN0YXJ0RGF0ZXRpbWUsIF9yZWYkZW5kRGF0ZXRpbWUsIGVuZERhdGV0aW1lLCByZWFsT3duZXIsIGJhbGFuY2VPZiwgb3JpZ2luRmVlcywgcGF5b3V0cywgZW5jRGF0YSwgbWFFbmNEYXRhLCB0YUVuY0RhdGEsIHJldDsKCiAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUzJChfY29udGV4dDMpIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQzLnByZXYgPSBfY29udGV4dDMubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIG1ha2VyID0gX3JlZi5tYWtlciwgbWFUeXBlTVYgPSBfcmVmLm1hVHlwZU1WLCBtYUNvbnRyYWN0QWRkcmVzcyA9IF9yZWYubWFDb250cmFjdEFkZHJlc3MsIG1hVmFsdWUgPSBfcmVmLm1hVmFsdWUsIF9yZWYkcXVhbnRpdHkgPSBfcmVmLnF1YW50aXR5LCBxdWFudGl0eSA9IF9yZWYkcXVhbnRpdHkgPT09IHZvaWQgMCA/IDEgOiBfcmVmJHF1YW50aXR5LCBfcmVmJHRha2VyID0gX3JlZi50YWtlciwgdGFrZXIgPSBfcmVmJHRha2VyID09PSB2b2lkIDAgPyBaRVJPX0FERFJFU1MgOiBfcmVmJHRha2VyLCB0YVR5cGVNViA9IF9yZWYudGFUeXBlTVYsIHRhQ29udHJhY3RBZGRyZXNzID0gX3JlZi50YUNvbnRyYWN0QWRkcmVzcywgdGFWYWx1ZSA9IF9yZWYudGFWYWx1ZSwgX3JlZiRzYWx0ID0gX3JlZi5zYWx0LCBzYWx0ID0gX3JlZiRzYWx0ID09PSB2b2lkIDAgPyBEYXRlLm5vdygpIDogX3JlZiRzYWx0LCBfcmVmJHN0YXJ0RGF0ZXRpbWUgPSBfcmVmLnN0YXJ0RGF0ZXRpbWUsIHN0YXJ0RGF0ZXRpbWUgPSBfcmVmJHN0YXJ0RGF0ZXRpbWUgPT09IHZvaWQgMCA/IDAgOiBfcmVmJHN0YXJ0RGF0ZXRpbWUsIF9yZWYkZW5kRGF0ZXRpbWUgPSBfcmVmLmVuZERhdGV0aW1lLCBlbmREYXRldGltZSA9IF9yZWYkZW5kRGF0ZXRpbWUgPT09IHZvaWQgMCA/IDAgOiBfcmVmJGVuZERhdGV0aW1lOwoKICAgICAgICAgICAgICAgIGlmICh0YVR5cGVNViA9PSBFVEgpIHsKICAgICAgICAgICAgICAgICAgdGhpcy5fdmVyaWZ5UGFyYW1BZGRyZXNzKFttYWtlciwgbWFDb250cmFjdEFkZHJlc3MsIHRha2VyXSk7IC8vIGV0aOuKlCBjb250cmFjdEFkZHJlc3Mg7JeG7J2MCgogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgdGhpcy5fdmVyaWZ5UGFyYW1BZGRyZXNzKFttYWtlciwgbWFDb250cmFjdEFkZHJlc3MsIHRha2VyLCB0YUNvbnRyYWN0QWRkcmVzc10pOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHRoaXMuX3ZlcmlmeVBhcmFtVHlwZU1WKFttYVR5cGVNViwgdGFUeXBlTVZdKTsKCiAgICAgICAgICAgICAgICB0aGlzLl92ZXJpZnlQYXJhbVVpbnROdW1iZXIoW21hVmFsdWUsIHRhVmFsdWVdKTsKCiAgICAgICAgICAgICAgICBpZiAoIShtYVR5cGVNViA9PSBFUkM3MjEpKSB7CiAgICAgICAgICAgICAgICAgIF9jb250ZXh0My5uZXh0ID0gMTI7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIF9jb250ZXh0My5uZXh0ID0gNzsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmdldFRva2VuT3duZXJPZihtYUNvbnRyYWN0QWRkcmVzcywgbWFWYWx1ZSk7CgogICAgICAgICAgICAgIGNhc2UgNzoKICAgICAgICAgICAgICAgIHJlYWxPd25lciA9IF9jb250ZXh0My5zZW50OwoKICAgICAgICAgICAgICAgIGlmICghKHJlYWxPd25lci50b1VwcGVyQ2FzZSgpICE9IG1ha2VyLnRvVXBwZXJDYXNlKCkpKSB7CiAgICAgICAgICAgICAgICAgIF9jb250ZXh0My5uZXh0ID0gMTA7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDMuYWJydXB0KCJyZXR1cm4iLCB7CiAgICAgICAgICAgICAgICAgIHN0YXR1czogZmFsc2UsCiAgICAgICAgICAgICAgICAgIGVycjogIk9yZGVyZXIoIi5jb25jYXQobWFrZXIsICIpIGlzIG5vdCB0aGUgdG9rZW4gb3duZXIoIikuY29uY2F0KHJlYWxPd25lciwgIikiKQogICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgIGNhc2UgMTA6CiAgICAgICAgICAgICAgICBfY29udGV4dDMubmV4dCA9IDIxOwogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgIGNhc2UgMTI6CiAgICAgICAgICAgICAgICBpZiAoIShtYVR5cGVNViA9PSBFUkMxMTU1KSkgewogICAgICAgICAgICAgICAgICBfY29udGV4dDMubmV4dCA9IDIwOwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBfY29udGV4dDMubmV4dCA9IDE1OwogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ2V0QmFsYW5jZU9mKG1ha2VyLCBtYUNvbnRyYWN0QWRkcmVzcywgbWFWYWx1ZSk7CgogICAgICAgICAgICAgIGNhc2UgMTU6CiAgICAgICAgICAgICAgICBiYWxhbmNlT2YgPSBfY29udGV4dDMuc2VudDsKCiAgICAgICAgICAgICAgICBpZiAoIShiYWxhbmNlT2YgPCBxdWFudGl0eSkpIHsKICAgICAgICAgICAgICAgICAgX2NvbnRleHQzLm5leHQgPSAxODsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0My5hYnJ1cHQoInJldHVybiIsIHsKICAgICAgICAgICAgICAgICAgc3RhdHVzOiBmYWxzZSwKICAgICAgICAgICAgICAgICAgZXJyOiAiT3JkZXJlcigiLmNvbmNhdChtYWtlciwgIikncyBiYWxhbmNlIGlzIG5vdCBlbm91Z2guICIpCiAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgY2FzZSAxODoKICAgICAgICAgICAgICAgIF9jb250ZXh0My5uZXh0ID0gMjE7CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgY2FzZSAyMDoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDMuYWJydXB0KCJyZXR1cm4iLCB7CiAgICAgICAgICAgICAgICAgIHN0YXR1czogZmFsc2UsCiAgICAgICAgICAgICAgICAgIGVycjogIlVuc3VwcG9ydGVkIGFzc2V0IHR5cGU6ICIuY29uY2F0KG1hVHlwZU1WKQogICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgIGNhc2UgMjE6CiAgICAgICAgICAgICAgICBvcmlnaW5GZWVzID0gW107IC8vIG9yaWdpbkZlZXMg6rCAIOybkOyynOynleyImCDripDrgozsnbjqsIDrs7Tri6QKCiAgICAgICAgICAgICAgICBwYXlvdXRzID0gW1ttYWtlciwgMTAwMDBdXTsgLy8gMTAwJSBvZiB0YWtlQXNzZXQgdG8gb3JkZXJNYWtlcgoKICAgICAgICAgICAgICAgIGVuY0RhdGEgPSBlbmNEYXRhVjEodGhpcy53ZWIzLCBbcGF5b3V0cywgb3JpZ2luRmVlc10pOyAvLyBUT0RPOiBjaGVjayBzdGFydCBhbmQgZW5kIGRhdGUgCiAgICAgICAgICAgICAgICAvLyAgIHZhciBkYXRlID0gbmV3IERhdGUoKQogICAgICAgICAgICAgICAgLy8gICBkYXRlLnZhbHVlT2YoKSAvLyAxNjIyNjgzMjk1MzI4CiAgICAgICAgICAgICAgICAvLyAgIG5ldyBEYXRlKDE2MjI2ODMyOTUzMjgpIC8vIDIwMjEtMDYtMDNUMDE6MjE6MzUuMzI4WgoKICAgICAgICAgICAgICAgIG1hRW5jRGF0YSA9IHRoaXMuX2VuY0Fzc2V0RGF0YShtYVR5cGVNViwgbWFDb250cmFjdEFkZHJlc3MsIG1hVmFsdWUpOwogICAgICAgICAgICAgICAgdGFFbmNEYXRhID0gdGhpcy5fZW5jQXNzZXREYXRhKHRhVHlwZU1WLCB0YUNvbnRyYWN0QWRkcmVzcywgdGFWYWx1ZSk7IC8vIG9yZGVyIHN0cnVjdAoKICAgICAgICAgICAgICAgIF9jb250ZXh0My5uZXh0ID0gMjg7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fbWFrZU9yZGVyQW5kQXBwcm92ZShtYWtlciwgQXNzZXQobWFUeXBlTVYsIG1hRW5jRGF0YSwgcXVhbnRpdHkpLCAvLyA3MjHsnbTrqbQgdmFsdWUgMSwgMTE1NeuptCAxIOydtOyDgQogICAgICAgICAgICAgICAgdGFrZXIsIEFzc2V0KHRhVHlwZU1WLCB0YUVuY0RhdGEsIHRhVmFsdWUpLCAvLyB0YWtlckFzc2V0LAogICAgICAgICAgICAgICAgc2FsdCwgc3RhcnREYXRldGltZSwgZW5kRGF0ZXRpbWUsIE9SREVSX0RBVEFfVjEsIGVuY0RhdGEpOwoKICAgICAgICAgICAgICBjYXNlIDI4OgogICAgICAgICAgICAgICAgcmV0ID0gX2NvbnRleHQzLnNlbnQ7CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQzLmFicnVwdCgicmV0dXJuIiwgcmV0KTsKCiAgICAgICAgICAgICAgY2FzZSAzMDoKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0My5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlMywgdGhpcyk7CiAgICAgIH0pKTsKCiAgICAgIGZ1bmN0aW9uIGNyZWF0ZVNlbGxPcmRlcihfeDMpIHsKICAgICAgICByZXR1cm4gX2NyZWF0ZVNlbGxPcmRlci5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICB9CgogICAgICByZXR1cm4gY3JlYXRlU2VsbE9yZGVyOwogICAgfSgpIC8vIOuIhOqwgCDtjJDri6Tqs6Ag64K064aT7J2AIOqxsCDsgrDri6TripQg7Jik642UJuunpOy5mAoKICB9LCB7CiAgICBrZXk6ICJjcmVhdGVCdXlPcmRlckFuZE1hdGNoIiwKICAgIHZhbHVlOiBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBfY3JlYXRlQnV5T3JkZXJBbmRNYXRjaCA9IF9hc3luY1RvR2VuZXJhdG9yKCAvKiNfX1BVUkVfXyovcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTQoX3JlZjIpIHsKICAgICAgICB2YXIgbWFrZXIsIG1hVHlwZU1WLCBtYUNvbnRyYWN0QWRkcmVzcywgbWFWYWx1ZSwgc2VsbE9yZGVySWQsIF9yZWYyJHNhbHQsIHNhbHQsIF9yZWYyJHN0YXJ0LCBzdGFydCwgX3JlZjIkZW5kLCBlbmQsIGVyciwgb3JpZ2luRmVlcywgcGF5b3V0cywgZW5jRGF0YSwgc2VsbE9yZGVyLCBhc3NldERhdGEsIG1ha2VBc3NldCwgcmV0QnV5T3JkZXIsIHZhbHVlLCByZXRNYXRjaDsKCiAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWU0JChfY29udGV4dDQpIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQ0LnByZXYgPSBfY29udGV4dDQubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIG1ha2VyID0gX3JlZjIubWFrZXIsIG1hVHlwZU1WID0gX3JlZjIubWFUeXBlTVYsIG1hQ29udHJhY3RBZGRyZXNzID0gX3JlZjIubWFDb250cmFjdEFkZHJlc3MsIG1hVmFsdWUgPSBfcmVmMi5tYVZhbHVlLCBzZWxsT3JkZXJJZCA9IF9yZWYyLnNlbGxPcmRlcklkLCBfcmVmMiRzYWx0ID0gX3JlZjIuc2FsdCwgc2FsdCA9IF9yZWYyJHNhbHQgPT09IHZvaWQgMCA/IDAgOiBfcmVmMiRzYWx0LCBfcmVmMiRzdGFydCA9IF9yZWYyLnN0YXJ0LCBzdGFydCA9IF9yZWYyJHN0YXJ0ID09PSB2b2lkIDAgPyAwIDogX3JlZjIkc3RhcnQsIF9yZWYyJGVuZCA9IF9yZWYyLmVuZCwgZW5kID0gX3JlZjIkZW5kID09PSB2b2lkIDAgPyAwIDogX3JlZjIkZW5kOwogICAgICAgICAgICAgICAgY29uc29sZS5sb2coIlxuICAgICAgICBcdUQzMENcdUI4RjBcdUI3N0Nqc1x1QzU0OFx1Q0FCRFxuICAgICAgICBtYWtlciAiLmNvbmNhdChtYWtlciwgIlxuICAgICAgICBtYVR5cGVNViAiKS5jb25jYXQobWFUeXBlTVYsICJcbiAgICAgICAgbWFDb250cmFjdEFkZHJlc3MgIikuY29uY2F0KG1hQ29udHJhY3RBZGRyZXNzLCAiXG4gICAgICAgIG1hVmFsdWUgIikuY29uY2F0KG1hVmFsdWUsICJcbiAgICAgICAgc2VsbE9yZGVySWQgIikuY29uY2F0KHNlbGxPcmRlcklkLCAiXG4gICAgICAgICIpKTsKCiAgICAgICAgICAgICAgICBpZiAobWFUeXBlTVYgPT0gRVRIKSB7CiAgICAgICAgICAgICAgICAgIHRoaXMuX3ZlcmlmeVBhcmFtQWRkcmVzcyhbbWFrZXJdKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgIHRoaXMuX3ZlcmlmeVBhcmFtQWRkcmVzcyhbbWFrZXIsIG1hQ29udHJhY3RBZGRyZXNzXSk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgdGhpcy5fdmVyaWZ5UGFyYW1UeXBlTVYoW21hVHlwZU1WXSk7CgogICAgICAgICAgICAgICAgdGhpcy5fdmVyaWZ5UGFyYW1VaW50TnVtYmVyKFttYVZhbHVlLCBzZWxsT3JkZXJJZF0pOwoKICAgICAgICAgICAgICAgIGVyciA9ICcnOwogICAgICAgICAgICAgICAgb3JpZ2luRmVlcyA9IFtdOwogICAgICAgICAgICAgICAgcGF5b3V0cyA9IFtbbWFrZXIsIDEwMDAwXV07IC8vIDEwMCUgb2YgdGFrZUFzc2V0IHRvIG9yZGVyTWFrZXIKCiAgICAgICAgICAgICAgICBlbmNEYXRhID0gZW5jRGF0YVYxKHRoaXMud2ViMywgW3BheW91dHMsIG9yaWdpbkZlZXNdKTsgLy8gYXBpLmdldCBzZWxsIG9yZGVyCgogICAgICAgICAgICAgICAgX2NvbnRleHQ0Lm5leHQgPSAxMTsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmFwaS5nZXRTZWxsT3JkZXIoewogICAgICAgICAgICAgICAgICBpZDogc2VsbE9yZGVySWQKICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICBjYXNlIDExOgogICAgICAgICAgICAgICAgc2VsbE9yZGVyID0gX2NvbnRleHQ0LnNlbnQ7CiAgICAgICAgICAgICAgICAvLyDqtaztmIQg7ZWE7JqULCDrlJTthYzsnbztlZwg7IKs7Jqp67KV64+EIO2VhOyalAogICAgICAgICAgICAgICAgYXNzZXREYXRhID0gdGhpcy5fZW5jQXNzZXREYXRhKG1hVHlwZU1WLCBtYUNvbnRyYWN0QWRkcmVzcywgbWFWYWx1ZSk7CiAgICAgICAgICAgICAgICBtYWtlQXNzZXQgPSBBc3NldChtYVR5cGVNViwgYXNzZXREYXRhLCBtYVZhbHVlKTsKCiAgICAgICAgICAgICAgICB0aGlzLl9jaGVja0RpZmZBc3NldHMobWFrZUFzc2V0LCBzZWxsT3JkZXIub3JkZXIudGFrZUFzc2V0KTsKCiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnc2FsdCcsIHNhbHQpOyAvLyBvcmRlciBzdHJ1Y3QKCiAgICAgICAgICAgICAgICBfY29udGV4dDQubmV4dCA9IDE4OwogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX21ha2VPcmRlckFuZEFwcHJvdmUobWFrZXIsIG1ha2VBc3NldCwgc2VsbE9yZGVyLm9yZGVyLm1ha2VyLCBzZWxsT3JkZXIub3JkZXIubWFrZUFzc2V0LCAvLyDrs7TsnpDrs7TsnpAgCiAgICAgICAgICAgICAgICBzYWx0LCBzdGFydCwgZW5kLCBPUkRFUl9EQVRBX1YxLCBlbmNEYXRhKTsKCiAgICAgICAgICAgICAgY2FzZSAxODoKICAgICAgICAgICAgICAgIHJldEJ1eU9yZGVyID0gX2NvbnRleHQ0LnNlbnQ7CiAgICAgICAgICAgICAgICB2YWx1ZSA9IG1hVHlwZU1WID09IEVUSCA/IG1hVmFsdWUgOiAwOyAvLyBpZiBldGggdmFsdWUgbmVlZCwgaW4gd2VpCgogICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ3NlbGxPcmRlci5vcmRlcicsIEpTT04uc3RyaW5naWZ5KHNlbGxPcmRlci5vcmRlciksICctLS1zZWxsT3JkZXIuc2lnbmF0dXJlLCcsIEpTT04uc3RyaW5naWZ5KHNlbGxPcmRlci5zaWduYXR1cmUpLCAnLS0tcmV0QnV5T3JkZXIub3JkZXInLCBKU09OLnN0cmluZ2lmeShyZXRCdXlPcmRlci5vcmRlciksICctLS1yZXRCdXlPcmRlci5zaWduYXR1cmUnLCBKU09OLnN0cmluZ2lmeShyZXRCdXlPcmRlci5zaWduYXR1cmUpLCAnbWFrZXInLCBtYWtlciwgJ3ZhbHVlJywgdmFsdWUpOyAvLyBuZWVkIHB1dCBidXktb3JkZXI/CgogICAgICAgICAgICAgICAgX2NvbnRleHQ0Lm5leHQgPSAyMzsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9tYXRjaE9yZGVycyhzZWxsT3JkZXIub3JkZXIsIHNlbGxPcmRlci5zaWduYXR1cmUsIHJldEJ1eU9yZGVyLm9yZGVyLCByZXRCdXlPcmRlci5zaWduYXR1cmUsIG1ha2VyLCB2YWx1ZSk7CgogICAgICAgICAgICAgIGNhc2UgMjM6CiAgICAgICAgICAgICAgICByZXRNYXRjaCA9IF9jb250ZXh0NC5zZW50OwogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0NC5hYnJ1cHQoInJldHVybiIsIHsKICAgICAgICAgICAgICAgICAgc3RhdHVzOiByZXRNYXRjaC5zdGF0dXMsCiAgICAgICAgICAgICAgICAgIGVycjogJycKICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICBjYXNlIDI1OgogICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ0LnN0b3AoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sIF9jYWxsZWU0LCB0aGlzKTsKICAgICAgfSkpOwoKICAgICAgZnVuY3Rpb24gY3JlYXRlQnV5T3JkZXJBbmRNYXRjaChfeDQpIHsKICAgICAgICByZXR1cm4gX2NyZWF0ZUJ1eU9yZGVyQW5kTWF0Y2guYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgfQoKICAgICAgcmV0dXJuIGNyZWF0ZUJ1eU9yZGVyQW5kTWF0Y2g7CiAgICB9KCkgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCiAgICAvLy8vIGJpZOyXkCDrp6Tsua3snYAg7Ja065a76rKMPwogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCiAgICAvLyBhdWN0aW9uIOuTseuhnSAtPiDsnoXssLAoYnV5T3JkZXIpIC0+IOuCmeywsChzZWxsT3JkZXIgLT4gbWF0Y2hPcmRlcnMpCiAgICAvLwogICAgLy8gMS4gYXVjdGlvbiDrk7HroZ3tlZjquLAKICAgIC8vICAgLSDsg4HtkogKICAgIC8vICAgLSBhc3NldAogICAgLy8gICAgIC0g7Iuc7J6R6rCACiAgICAvLyAgIC0g7Iuc7J6R7J287IucCiAgICAvLyAgIC0g7KKF66OM7J287IucCiAgICAvLyAgIC0gCiAgICAvLyAyLiBsaXN0aW5nIGF1Y3Rpb24KICAgIC8vICAgYXVjdGlvbiBpdGVt7J2AIFtiaWRdIOuyhO2KvCDtkZzsi5wKICAgIC8vICAg7Iuk7Iuc6rCEIOyiheujjOq5jOyngCDrgqjsnYAg7Iuc6rCEIO2RnOyLnAogICAgLy8gICDsoJXroKwgKGViYXnssLjqs6A6IGh0dHBzOi8vd3d3LmViYXkuY29tL2IvVG95cy1Ib2JiaWVzLzIyMC9ibl8xODY1NDk3P0xIX0F1Y3Rpb249MSZydD1uYyZfc29wPTUpCiAgICAvLyAgICAgYmVzdCBtYXRjaAogICAgLy8gICAgIHRpbWU6IGVuZGRpbmcgc29vbmVzdAogICAgLy8gICAgIHRpbWU6IG5ld2x5IGxpc3RlZAogICAgLy8gICAgIHByaWNlICsgc2hpcHBpbmc6IGxvd2VzdCBmaXJzdAogICAgLy8gICAgIHByaWNlICsgc2hpcHBpbmc6IGhpZ2hlc3QgZmlyc3QKICAgIC8vICAgICBudW1iZXIgb2YgYmlkczogZmV3ZXN0IGZpcnN0CiAgICAvLyAgICAgbnVtYmVyIG9mIGJpZHM6IG1vc3QgZmlyc3QKICAgIC8vIDMuIGJpZGRpbmcKICAgIC8vIDQuIOuCmeywsChtYXRjaGluZ09yZGVyKQogICAgLy8g6rK966ekIOuCtCDrhpPripQg7Jik642UCgogIH0sIHsKICAgIGtleTogImNyZWF0ZUF1Y3Rpb24iLAogICAgdmFsdWU6IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIF9jcmVhdGVBdWN0aW9uID0gX2FzeW5jVG9HZW5lcmF0b3IoIC8qI19fUFVSRV9fKi9yZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlNShfcmVmMykgewogICAgICAgIHZhciBzdGFydERhdGV0aW1lLCBlbmREYXRldGltZSwgbWFrZXIsIG1hVHlwZU1WLCBtYUNvbnRyYWN0QWRkcmVzcywgbWFWYWx1ZSwgX3JlZjMkcXVhbnRpdHksIHF1YW50aXR5LCBfcmVmMyR0YWtlciwgdGFrZXIsIHRhVHlwZU1WLCB0YUNvbnRyYWN0QWRkcmVzcywgdGFQcmljZUJlZ2luLCBfcmVmMyR0YVByaWNlRW5kLCB0YVByaWNlRW5kLCBfcmVmMyRpc1RpbWVMaW1pdGVkLCBpc1RpbWVMaW1pdGVkLCBfcmVmMyRwcmljZU1pbkhpZGRlbiwgcHJpY2VNaW5IaWRkZW4sIHJlYWxPd25lciwgYmFsYW5jZU9mLCByZXRPcmRlckRhdGEsIGVycjsKCiAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWU1JChfY29udGV4dDUpIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQ1LnByZXYgPSBfY29udGV4dDUubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIHN0YXJ0RGF0ZXRpbWUgPSBfcmVmMy5zdGFydERhdGV0aW1lLCBlbmREYXRldGltZSA9IF9yZWYzLmVuZERhdGV0aW1lLCBtYWtlciA9IF9yZWYzLm1ha2VyLCBtYVR5cGVNViA9IF9yZWYzLm1hVHlwZU1WLCBtYUNvbnRyYWN0QWRkcmVzcyA9IF9yZWYzLm1hQ29udHJhY3RBZGRyZXNzLCBtYVZhbHVlID0gX3JlZjMubWFWYWx1ZSwgX3JlZjMkcXVhbnRpdHkgPSBfcmVmMy5xdWFudGl0eSwgcXVhbnRpdHkgPSBfcmVmMyRxdWFudGl0eSA9PT0gdm9pZCAwID8gMSA6IF9yZWYzJHF1YW50aXR5LCBfcmVmMyR0YWtlciA9IF9yZWYzLnRha2VyLCB0YWtlciA9IF9yZWYzJHRha2VyID09PSB2b2lkIDAgPyBaRVJPX0FERFJFU1MgOiBfcmVmMyR0YWtlciwgdGFUeXBlTVYgPSBfcmVmMy50YVR5cGVNViwgdGFDb250cmFjdEFkZHJlc3MgPSBfcmVmMy50YUNvbnRyYWN0QWRkcmVzcywgdGFQcmljZUJlZ2luID0gX3JlZjMudGFQcmljZUJlZ2luLCBfcmVmMyR0YVByaWNlRW5kID0gX3JlZjMudGFQcmljZUVuZCwgdGFQcmljZUVuZCA9IF9yZWYzJHRhUHJpY2VFbmQgPT09IHZvaWQgMCA/IDAgOiBfcmVmMyR0YVByaWNlRW5kLCBfcmVmMyRpc1RpbWVMaW1pdGVkID0gX3JlZjMuaXNUaW1lTGltaXRlZCwgaXNUaW1lTGltaXRlZCA9IF9yZWYzJGlzVGltZUxpbWl0ZWQgPT09IHZvaWQgMCA/IHRydWUgOiBfcmVmMyRpc1RpbWVMaW1pdGVkLCBfcmVmMyRwcmljZU1pbkhpZGRlbiA9IF9yZWYzLnByaWNlTWluSGlkZGVuLCBwcmljZU1pbkhpZGRlbiA9IF9yZWYzJHByaWNlTWluSGlkZGVuID09PSB2b2lkIDAgPyAtMSA6IF9yZWYzJHByaWNlTWluSGlkZGVuOwoKICAgICAgICAgICAgICAgIHRoaXMuX3ZlcmlmeVBhcmFtQWRkcmVzcyhbbWFrZXIsIG1hQ29udHJhY3RBZGRyZXNzLCB0YWtlcl0pOwoKICAgICAgICAgICAgICAgIHRoaXMuX3ZlcmlmeVBhcmFtVHlwZU1WKFttYVR5cGVNViwgdGFUeXBlTVZdKTsKCiAgICAgICAgICAgICAgICB0aGlzLl92ZXJpZnlQYXJhbVVpbnROdW1iZXIoW21hVmFsdWUsIHF1YW50aXR5LCBzdGFydERhdGV0aW1lLCBlbmREYXRldGltZSwgdGFQcmljZUJlZ2luLCB0YVByaWNlQmVnaW5dKTsKCiAgICAgICAgICAgICAgICBpZiAoIShtYVR5cGVNViA9PSBFUkM3MjEpKSB7CiAgICAgICAgICAgICAgICAgIF9jb250ZXh0NS5uZXh0ID0gMTI7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIF9jb250ZXh0NS5uZXh0ID0gNzsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmdldFRva2VuT3duZXJPZihtYUNvbnRyYWN0QWRkcmVzcywgbWFWYWx1ZSk7CgogICAgICAgICAgICAgIGNhc2UgNzoKICAgICAgICAgICAgICAgIHJlYWxPd25lciA9IF9jb250ZXh0NS5zZW50OwoKICAgICAgICAgICAgICAgIGlmICghKHJlYWxPd25lci50b1VwcGVyQ2FzZSgpICE9IG1ha2VyLnRvVXBwZXJDYXNlKCkpKSB7CiAgICAgICAgICAgICAgICAgIF9jb250ZXh0NS5uZXh0ID0gMTA7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDUuYWJydXB0KCJyZXR1cm4iLCB7CiAgICAgICAgICAgICAgICAgIHN0YXR1czogZmFsc2UsCiAgICAgICAgICAgICAgICAgIGVycjogIk9yZGVyZXIoIi5jb25jYXQobWFrZXIsICIpIGlzIG5vdCB0aGUgdG9rZW4gb3duZXIoIikuY29uY2F0KHJlYWxPd25lciwgIikiKQogICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgIGNhc2UgMTA6CiAgICAgICAgICAgICAgICBfY29udGV4dDUubmV4dCA9IDIxOwogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgIGNhc2UgMTI6CiAgICAgICAgICAgICAgICBpZiAoIShtYVR5cGVNViA9PSBFUkMxMTU1KSkgewogICAgICAgICAgICAgICAgICBfY29udGV4dDUubmV4dCA9IDIwOwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBfY29udGV4dDUubmV4dCA9IDE1OwogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ2V0QmFsYW5jZU9mKG1ha2VyLCBtYUNvbnRyYWN0QWRkcmVzcywgbWFWYWx1ZSk7CgogICAgICAgICAgICAgIGNhc2UgMTU6CiAgICAgICAgICAgICAgICBiYWxhbmNlT2YgPSBfY29udGV4dDUuc2VudDsKCiAgICAgICAgICAgICAgICBpZiAoIShiYWxhbmNlT2YgPCBxdWFudGl0eSkpIHsKICAgICAgICAgICAgICAgICAgX2NvbnRleHQ1Lm5leHQgPSAxODsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0NS5hYnJ1cHQoInJldHVybiIsIHsKICAgICAgICAgICAgICAgICAgc3RhdHVzOiBmYWxzZSwKICAgICAgICAgICAgICAgICAgZXJyOiAiT3JkZXJlcigiLmNvbmNhdChtYWtlciwgIikncyBiYWxhbmNlIGlzIG5vdCBlbm91Z2guICIpCiAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgY2FzZSAxODoKICAgICAgICAgICAgICAgIF9jb250ZXh0NS5uZXh0ID0gMjE7CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgY2FzZSAyMDoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDUuYWJydXB0KCJyZXR1cm4iLCB7CiAgICAgICAgICAgICAgICAgIHN0YXR1czogZmFsc2UsCiAgICAgICAgICAgICAgICAgIGVycjogIlVuc3VwcG9ydGVkIGFzc2V0IHR5cGU6ICIuY29uY2F0KG1hVHlwZU1WKQogICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgIGNhc2UgMjE6CiAgICAgICAgICAgICAgICByZXRPcmRlckRhdGEgPSBudWxsOwogICAgICAgICAgICAgICAgZXJyID0gJyc7CgogICAgICAgICAgICAgICAgaWYgKCEodGFQcmljZUVuZCAhPSAwKSkgewogICAgICAgICAgICAgICAgICBfY29udGV4dDUubmV4dCA9IDI4OwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBfY29udGV4dDUubmV4dCA9IDI2OwogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuY3JlYXRlU2VsbE9yZGVyKHsKICAgICAgICAgICAgICAgICAgbWFrZXI6IG1ha2VyLAogICAgICAgICAgICAgICAgICBtYVR5cGVNVjogbWFUeXBlTVYsCiAgICAgICAgICAgICAgICAgIG1hQ29udHJhY3RBZGRyZXNzOiBtYUNvbnRyYWN0QWRkcmVzcywKICAgICAgICAgICAgICAgICAgbWFWYWx1ZTogbWFWYWx1ZSwKICAgICAgICAgICAgICAgICAgdGFrZXI6IHRha2VyLAogICAgICAgICAgICAgICAgICB0YVR5cGVNVjogdGFUeXBlTVYsCiAgICAgICAgICAgICAgICAgIHRhQ29udHJhY3RBZGRyZXNzOiB0YUNvbnRyYWN0QWRkcmVzcywKICAgICAgICAgICAgICAgICAgdGFWYWx1ZTogdGFQcmljZUVuZCwKICAgICAgICAgICAgICAgICAgcXVhbnRpdHk6IHF1YW50aXR5LAogICAgICAgICAgICAgICAgICBzdGFydDogc3RhcnREYXRldGltZSwKICAgICAgICAgICAgICAgICAgZW5kOiBlbmREYXRldGltZQogICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgIGNhc2UgMjY6CiAgICAgICAgICAgICAgICByZXRPcmRlckRhdGEgPSBfY29udGV4dDUuc2VudDsKCiAgICAgICAgICAgICAgICBpZiAoIXJldE9yZGVyRGF0YS5zdGF0dXMpIHsKICAgICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihyZXRPcmRlckRhdGEuZXJyKTsKICAgICAgICAgICAgICAgICAgZXJyID0gImVycjogIi5jb25jYXQocmV0T3JkZXJEYXRhLmVycik7CiAgICAgICAgICAgICAgICB9IC8vIGNvbnNvbGUubG9nKHJldE9yZGVyRGF0YS5kYXRhLCByZXRPcmRlckRhdGEuc2lnbmF0dXJlKQoKCiAgICAgICAgICAgICAgY2FzZSAyODoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDUuYWJydXB0KCJyZXR1cm4iLCBfb2JqZWN0U3ByZWFkKF9vYmplY3RTcHJlYWQoe30sIHJldE9yZGVyRGF0YSksIHt9LCB7CiAgICAgICAgICAgICAgICAgIGVycjogZXJyCiAgICAgICAgICAgICAgICB9KSk7CgogICAgICAgICAgICAgIGNhc2UgMjk6CiAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDUuc3RvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZTUsIHRoaXMpOwogICAgICB9KSk7CgogICAgICBmdW5jdGlvbiBjcmVhdGVBdWN0aW9uKF94NSkgewogICAgICAgIHJldHVybiBfY3JlYXRlQXVjdGlvbi5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICB9CgogICAgICByZXR1cm4gY3JlYXRlQXVjdGlvbjsKICAgIH0oKQogIH0sIHsKICAgIGtleTogImNyZWF0ZUJpZE9yZGVyIiwKICAgIHZhbHVlOiBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBfY3JlYXRlQmlkT3JkZXIgPSBfYXN5bmNUb0dlbmVyYXRvciggLyojX19QVVJFX18qL3JlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWU2KF9yZWY0KSB7CiAgICAgICAgdmFyIG1ha2VyLCBtYVR5cGVNViwgbWFDb250cmFjdEFkZHJlc3MsIG1hVmFsdWUsIGF1Y3Rpb25JZCwgb3JpZ2luRmVlcywgcGF5b3V0cywgZW5jRGF0YSwgYXVjdGlvbk9yZGVyLCBhc3NldERhdGEsIG1ha2VBc3NldCwgb3JkZXJfbWFrZXIsIG9yZGVyX21ha2VyX2Fzc2V0LCByZXQ7CiAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWU2JChfY29udGV4dDYpIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQ2LnByZXYgPSBfY29udGV4dDYubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIG1ha2VyID0gX3JlZjQubWFrZXIsIG1hVHlwZU1WID0gX3JlZjQubWFUeXBlTVYsIG1hQ29udHJhY3RBZGRyZXNzID0gX3JlZjQubWFDb250cmFjdEFkZHJlc3MsIG1hVmFsdWUgPSBfcmVmNC5tYVZhbHVlLCBhdWN0aW9uSWQgPSBfcmVmNC5hdWN0aW9uSWQ7CgogICAgICAgICAgICAgICAgaWYgKCEobWFUeXBlTVYgPT0gRVRIKSkgewogICAgICAgICAgICAgICAgICBfY29udGV4dDYubmV4dCA9IDM7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDYuYWJydXB0KCJyZXR1cm4iLCB7CiAgICAgICAgICAgICAgICAgIHN0YXR1czogZmFsc2UsCiAgICAgICAgICAgICAgICAgIGVycjogIkNhbid0IHVzZSBFVEggZm9yIGJpZC1vcmRlciIKICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICBjYXNlIDM6CiAgICAgICAgICAgICAgICB0aGlzLl92ZXJpZnlQYXJhbUFkZHJlc3MoW21ha2VyLCBtYUNvbnRyYWN0QWRkcmVzc10pOwoKICAgICAgICAgICAgICAgIHRoaXMuX3ZlcmlmeVBhcmFtVHlwZU1WKFttYVR5cGVNVl0pOwoKICAgICAgICAgICAgICAgIHRoaXMuX3ZlcmlmeVBhcmFtVWludE51bWJlcihbbWFWYWx1ZSwgYXVjdGlvbklkXSk7CgogICAgICAgICAgICAgICAgb3JpZ2luRmVlcyA9IFtdOwogICAgICAgICAgICAgICAgcGF5b3V0cyA9IFtbbWFrZXIsIDEwMDAwXV07IC8vIDEwMCUgb2YgdGFrZUFzc2V0IHRvIG9yZGVyTWFrZXIKCiAgICAgICAgICAgICAgICBlbmNEYXRhID0gZW5jRGF0YVYxKHRoaXMud2ViMywgW3BheW91dHMsIG9yaWdpbkZlZXNdKTsKICAgICAgICAgICAgICAgIF9jb250ZXh0Ni5uZXh0ID0gMTE7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5hcGkuZ2V0QXVjdGlvbk9yZGVyKHsKICAgICAgICAgICAgICAgICAgaWQ6IGF1Y3Rpb25JZAogICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgIGNhc2UgMTE6CiAgICAgICAgICAgICAgICBhdWN0aW9uT3JkZXIgPSBfY29udGV4dDYuc2VudDsKICAgICAgICAgICAgICAgIGFzc2V0RGF0YSA9IHRoaXMuX2VuY0Fzc2V0RGF0YShtYVR5cGVNViwgbWFDb250cmFjdEFkZHJlc3MsIG1hVmFsdWUpOwogICAgICAgICAgICAgICAgbWFrZUFzc2V0ID0gQXNzZXQobWFUeXBlTVYsIGFzc2V0RGF0YSwgbWFWYWx1ZSk7CgogICAgICAgICAgICAgICAgaWYgKCFhdWN0aW9uT3JkZXIuaW1tZWRpYXRlX2J1eWFibGUpIHsKICAgICAgICAgICAgICAgICAgb3JkZXJfbWFrZXJfYXNzZXQgPSBhdWN0aW9uT3JkZXIub3JkZXIubWFrZUFzc2V0OwogICAgICAgICAgICAgICAgICBvcmRlcl9tYWtlciA9IGF1Y3Rpb25PcmRlci5vcmRlci5tYWtlcjsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgIG9yZGVyX21ha2VyID0gYXVjdGlvbk9yZGVyLm9yZGVyLm1ha2VyOwogICAgICAgICAgICAgICAgICBvcmRlcl9tYWtlcl9hc3NldCA9IGF1Y3Rpb25PcmRlci5vcmRlci5tYWtlQXNzZXQ7CiAgICAgICAgICAgICAgICB9IC8vIHRoaXMuX2NoZWNrRGlmZkFzc2V0cyhtYWtlQXNzZXQsIGF1Y3Rpb25PcmRlci5vcmRlci50YWtlQXNzZXQpCiAgICAgICAgICAgICAgICAvLyBvcmRlciBzdHJ1Y3QKCgogICAgICAgICAgICAgICAgX2NvbnRleHQ2Lm5leHQgPSAxNzsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9tYWtlT3JkZXJBbmRBcHByb3ZlKG1ha2VyLCBtYWtlQXNzZXQsIG9yZGVyX21ha2VyLCBvcmRlcl9tYWtlcl9hc3NldCwgMSwgMCwgMCwgT1JERVJfREFUQV9WMSwgZW5jRGF0YSk7CgogICAgICAgICAgICAgIGNhc2UgMTc6CiAgICAgICAgICAgICAgICByZXQgPSBfY29udGV4dDYuc2VudDsKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDYuYWJydXB0KCJyZXR1cm4iLCByZXQpOwoKICAgICAgICAgICAgICBjYXNlIDE5OgogICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ2LnN0b3AoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sIF9jYWxsZWU2LCB0aGlzKTsKICAgICAgfSkpOwoKICAgICAgZnVuY3Rpb24gY3JlYXRlQmlkT3JkZXIoX3g2KSB7CiAgICAgICAgcmV0dXJuIF9jcmVhdGVCaWRPcmRlci5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICB9CgogICAgICByZXR1cm4gY3JlYXRlQmlkT3JkZXI7CiAgICB9KCkKICB9LCB7CiAgICBrZXk6ICJjcmVhdGVCaWRNYXRjaCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gKCkgewogICAgICB2YXIgX2NyZWF0ZUJpZE1hdGNoID0gX2FzeW5jVG9HZW5lcmF0b3IoIC8qI19fUFVSRV9fKi9yZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlNyhfcmVmNSkgewogICAgICAgIHZhciBtYWtlciwgbWFUeXBlTVYsIG1hQ29udHJhY3RBZGRyZXNzLCBtYVZhbHVlLCBfcmVmNSRxdWFudGl0eSwgcXVhbnRpdHksIGJpZElkLCBvcmlnaW5GZWVzLCBwYXlvdXRzLCBlbmNEYXRhLCBiaWRPcmRlciwgYXNzZXREYXRhLCBtYWtlQXNzZXQsIHJldEJpZE1hdGNoT3JkZXIsIHJldDsKCiAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWU3JChfY29udGV4dDcpIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQ3LnByZXYgPSBfY29udGV4dDcubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIG1ha2VyID0gX3JlZjUubWFrZXIsIG1hVHlwZU1WID0gX3JlZjUubWFUeXBlTVYsIG1hQ29udHJhY3RBZGRyZXNzID0gX3JlZjUubWFDb250cmFjdEFkZHJlc3MsIG1hVmFsdWUgPSBfcmVmNS5tYVZhbHVlLCBfcmVmNSRxdWFudGl0eSA9IF9yZWY1LnF1YW50aXR5LCBxdWFudGl0eSA9IF9yZWY1JHF1YW50aXR5ID09PSB2b2lkIDAgPyAxIDogX3JlZjUkcXVhbnRpdHksIGJpZElkID0gX3JlZjUuYmlkSWQ7CgogICAgICAgICAgICAgICAgdGhpcy5fdmVyaWZ5UGFyYW1BZGRyZXNzKFttYWtlciwgbWFDb250cmFjdEFkZHJlc3NdKTsKCiAgICAgICAgICAgICAgICB0aGlzLl92ZXJpZnlQYXJhbVR5cGVNVihbbWFUeXBlTVZdKTsKCiAgICAgICAgICAgICAgICB0aGlzLl92ZXJpZnlQYXJhbVVpbnROdW1iZXIoW21hVmFsdWUsIGJpZElkLCBxdWFudGl0eV0pOwoKICAgICAgICAgICAgICAgIG9yaWdpbkZlZXMgPSBbXTsKICAgICAgICAgICAgICAgIHBheW91dHMgPSBbW21ha2VyLCAxMDAwMF1dOwogICAgICAgICAgICAgICAgZW5jRGF0YSA9IGVuY0RhdGFWMSh0aGlzLndlYjMsIFtwYXlvdXRzLCBvcmlnaW5GZWVzXSk7CiAgICAgICAgICAgICAgICBfY29udGV4dDcubmV4dCA9IDk7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5hcGkuZ2V0QmlkT3JkZXIoewogICAgICAgICAgICAgICAgICBpZDogYmlkSWQKICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICBjYXNlIDk6CiAgICAgICAgICAgICAgICBiaWRPcmRlciA9IF9jb250ZXh0Ny5zZW50OwogICAgICAgICAgICAgICAgYXNzZXREYXRhID0gdGhpcy5fZW5jQXNzZXREYXRhKG1hVHlwZU1WLCBtYUNvbnRyYWN0QWRkcmVzcywgbWFWYWx1ZSk7CiAgICAgICAgICAgICAgICBtYWtlQXNzZXQgPSBBc3NldChtYVR5cGVNViwgYXNzZXREYXRhLCBxdWFudGl0eSk7CgogICAgICAgICAgICAgICAgdGhpcy5fY2hlY2tEaWZmQXNzZXRzKG1ha2VBc3NldCwgYmlkT3JkZXIub3JkZXIudGFrZUFzc2V0KTsKCiAgICAgICAgICAgICAgICBfY29udGV4dDcubmV4dCA9IDE1OwogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX21ha2VPcmRlckFuZEFwcHJvdmUobWFrZXIsIG1ha2VBc3NldCwgYmlkT3JkZXIub3JkZXIubWFrZXIsIGJpZE9yZGVyLm9yZGVyLm1ha2VBc3NldCwgMCwgMCwgMCwgT1JERVJfREFUQV9WMSwgZW5jRGF0YSk7CgogICAgICAgICAgICAgIGNhc2UgMTU6CiAgICAgICAgICAgICAgICByZXRCaWRNYXRjaE9yZGVyID0gX2NvbnRleHQ3LnNlbnQ7CiAgICAgICAgICAgICAgICBfY29udGV4dDcubmV4dCA9IDE4OwogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX21hdGNoT3JkZXJzKHJldEJpZE1hdGNoT3JkZXIub3JkZXIsIHJldEJpZE1hdGNoT3JkZXIuc2lnbmF0dXJlLCBiaWRPcmRlci5vcmRlciwgYmlkT3JkZXIuc2lnbmF0dXJlLCBtYWtlcik7CgogICAgICAgICAgICAgIGNhc2UgMTg6CiAgICAgICAgICAgICAgICByZXQgPSBfY29udGV4dDcuc2VudDsKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDcuYWJydXB0KCJyZXR1cm4iLCByZXQpOwoKICAgICAgICAgICAgICBjYXNlIDIwOgogICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ3LnN0b3AoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sIF9jYWxsZWU3LCB0aGlzKTsKICAgICAgfSkpOwoKICAgICAgZnVuY3Rpb24gY3JlYXRlQmlkTWF0Y2goX3g3KSB7CiAgICAgICAgcmV0dXJuIF9jcmVhdGVCaWRNYXRjaC5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICB9CgogICAgICByZXR1cm4gY3JlYXRlQmlkTWF0Y2g7CiAgICB9KCkgLy8g64KY7ZWc7YWMIO2MlOudvOqzoCDtlZjripQg7KCc7JWIIOyYpOuNlAoKICB9LCB7CiAgICBrZXk6ICJjcmVhdGVPZmZlck9yZGVyIiwKICAgIHZhbHVlOiBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBfY3JlYXRlT2ZmZXJPcmRlciA9IF9hc3luY1RvR2VuZXJhdG9yKCAvKiNfX1BVUkVfXyovcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTgoX3JlZjYpIHsKICAgICAgICB2YXIgbWFrZXIsIG1hVHlwZU1WLCBtYUNvbnRyYWN0QWRkcmVzcywgbWFWYWx1ZSwgdGFrZXIsIHRhVHlwZU1WLCB0YUNvbnRyYWN0QWRkcmVzcywgdGFWYWx1ZSwgX3JlZjYkcXVhbnRpdHksIHF1YW50aXR5LCBfcmVmNiRzYWx0LCBzYWx0LCBvcmlnaW5GZWVzLCBwYXlvdXRzLCBlbmNEYXRhLCBhc3NldERhdGEsIHRhQXNzZXREYXRhLCByZXQ7CgogICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlOCQoX2NvbnRleHQ4KSB7CiAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0OC5wcmV2ID0gX2NvbnRleHQ4Lm5leHQpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICBtYWtlciA9IF9yZWY2Lm1ha2VyLCBtYVR5cGVNViA9IF9yZWY2Lm1hVHlwZU1WLCBtYUNvbnRyYWN0QWRkcmVzcyA9IF9yZWY2Lm1hQ29udHJhY3RBZGRyZXNzLCBtYVZhbHVlID0gX3JlZjYubWFWYWx1ZSwgdGFrZXIgPSBfcmVmNi50YWtlciwgdGFUeXBlTVYgPSBfcmVmNi50YVR5cGVNViwgdGFDb250cmFjdEFkZHJlc3MgPSBfcmVmNi50YUNvbnRyYWN0QWRkcmVzcywgdGFWYWx1ZSA9IF9yZWY2LnRhVmFsdWUsIF9yZWY2JHF1YW50aXR5ID0gX3JlZjYucXVhbnRpdHksIHF1YW50aXR5ID0gX3JlZjYkcXVhbnRpdHkgPT09IHZvaWQgMCA/IDEgOiBfcmVmNiRxdWFudGl0eSwgX3JlZjYkc2FsdCA9IF9yZWY2LnNhbHQsIHNhbHQgPSBfcmVmNiRzYWx0ID09PSB2b2lkIDAgPyBEYXRlLm5vdygpIDogX3JlZjYkc2FsdDsKCiAgICAgICAgICAgICAgICBpZiAoIShtYVR5cGVNViA9PSBFVEgpKSB7CiAgICAgICAgICAgICAgICAgIF9jb250ZXh0OC5uZXh0ID0gMzsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0OC5hYnJ1cHQoInJldHVybiIsIHsKICAgICAgICAgICAgICAgICAgc3RhdHVzOiBmYWxzZSwKICAgICAgICAgICAgICAgICAgZXJyOiAiQ2FuJ3QgdXNlIEVUSCBmb3Igb2ZmZXItb3JkZXIiCiAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgY2FzZSAzOgogICAgICAgICAgICAgICAgdGhpcy5fdmVyaWZ5UGFyYW1BZGRyZXNzKFttYWtlciwgbWFDb250cmFjdEFkZHJlc3MsIHRha2VyLCB0YUNvbnRyYWN0QWRkcmVzc10pOwoKICAgICAgICAgICAgICAgIHRoaXMuX3ZlcmlmeVBhcmFtVHlwZU1WKFttYVR5cGVNViwgdGFUeXBlTVZdKTsKCiAgICAgICAgICAgICAgICB0aGlzLl92ZXJpZnlQYXJhbVVpbnROdW1iZXIoW21hVmFsdWUsIHRhVmFsdWUsIHF1YW50aXR5LCBzYWx0XSk7CgogICAgICAgICAgICAgICAgb3JpZ2luRmVlcyA9IFtdOwogICAgICAgICAgICAgICAgcGF5b3V0cyA9IFtbbWFrZXIsIDEwMDAwXV07IC8vIDEwMCUgb2YgdGFrZUFzc2V0IHRvIG9yZGVyTWFrZXIKCiAgICAgICAgICAgICAgICBlbmNEYXRhID0gZW5jRGF0YVYxKHRoaXMud2ViMywgW3BheW91dHMsIG9yaWdpbkZlZXNdKTsKICAgICAgICAgICAgICAgIGFzc2V0RGF0YSA9IHRoaXMuX2VuY0Fzc2V0RGF0YShtYVR5cGVNViwgbWFDb250cmFjdEFkZHJlc3MsIG1hVmFsdWUpOwogICAgICAgICAgICAgICAgdGFBc3NldERhdGEgPSB0aGlzLl9lbmNBc3NldERhdGEodGFUeXBlTVYsIHRhQ29udHJhY3RBZGRyZXNzLCB0YVZhbHVlKTsgLy8gb3JkZXIgc3RydWN0CgogICAgICAgICAgICAgICAgX2NvbnRleHQ4Lm5leHQgPSAxMzsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9tYWtlT3JkZXJBbmRBcHByb3ZlKG1ha2VyLCBBc3NldChtYVR5cGVNViwgYXNzZXREYXRhLCBtYVZhbHVlKSwgdGFrZXIsIEFzc2V0KHRhVHlwZU1WLCB0YUFzc2V0RGF0YSwgcXVhbnRpdHkpLCAvLyB0YXJnZXQgbXVzdCBiZSBORlQ/CiAgICAgICAgICAgICAgICBzYWx0LCAwLCAwLCBPUkRFUl9EQVRBX1YxLCBlbmNEYXRhKTsKCiAgICAgICAgICAgICAgY2FzZSAxMzoKICAgICAgICAgICAgICAgIHJldCA9IF9jb250ZXh0OC5zZW50OwogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0OC5hYnJ1cHQoInJldHVybiIsIHJldCk7CgogICAgICAgICAgICAgIGNhc2UgMTU6CiAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDguc3RvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZTgsIHRoaXMpOwogICAgICB9KSk7CgogICAgICBmdW5jdGlvbiBjcmVhdGVPZmZlck9yZGVyKF94OCkgewogICAgICAgIHJldHVybiBfY3JlYXRlT2ZmZXJPcmRlci5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICB9CgogICAgICByZXR1cm4gY3JlYXRlT2ZmZXJPcmRlcjsKICAgIH0oKSAvLyAvLyBvZmZlcuulvCDsiJjrnb3tlZjripQg7Jik642UCgogIH0sIHsKICAgIGtleTogImNyZWF0ZUFjY2VwdE9yZGVyQW5kTWF0Y2giLAogICAgdmFsdWU6IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIF9jcmVhdGVBY2NlcHRPcmRlckFuZE1hdGNoID0gX2FzeW5jVG9HZW5lcmF0b3IoIC8qI19fUFVSRV9fKi9yZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlOShfcmVmNykgewogICAgICAgIHZhciBtYWtlciwgbWFUeXBlTVYsIG1hQ29udHJhY3RBZGRyZXNzLCBtYVZhbHVlLCBfcmVmNyRxdWFudGl0eSwgcXVhbnRpdHksIG9mZmVySWQsIG9yaWdpbkZlZXMsIHBheW91dHMsIGVuY0RhdGEsIG9mZmVyT3JkZXIsIGFzc2V0RGF0YSwgbWFrZUFzc2V0LCByZXRBY2NlcHRPcmRlciwgcmV0OwoKICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTkkKF9jb250ZXh0OSkgewogICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDkucHJldiA9IF9jb250ZXh0OS5uZXh0KSB7CiAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgbWFrZXIgPSBfcmVmNy5tYWtlciwgbWFUeXBlTVYgPSBfcmVmNy5tYVR5cGVNViwgbWFDb250cmFjdEFkZHJlc3MgPSBfcmVmNy5tYUNvbnRyYWN0QWRkcmVzcywgbWFWYWx1ZSA9IF9yZWY3Lm1hVmFsdWUsIF9yZWY3JHF1YW50aXR5ID0gX3JlZjcucXVhbnRpdHksIHF1YW50aXR5ID0gX3JlZjckcXVhbnRpdHkgPT09IHZvaWQgMCA/IDEgOiBfcmVmNyRxdWFudGl0eSwgb2ZmZXJJZCA9IF9yZWY3Lm9mZmVySWQ7CgogICAgICAgICAgICAgICAgdGhpcy5fdmVyaWZ5UGFyYW1BZGRyZXNzKFttYWtlciwgbWFDb250cmFjdEFkZHJlc3NdKTsKCiAgICAgICAgICAgICAgICB0aGlzLl92ZXJpZnlQYXJhbVR5cGVNVihbbWFUeXBlTVZdKTsKCiAgICAgICAgICAgICAgICB0aGlzLl92ZXJpZnlQYXJhbVVpbnROdW1iZXIoW21hVmFsdWUsIG9mZmVySWQsIHF1YW50aXR5XSk7CgogICAgICAgICAgICAgICAgb3JpZ2luRmVlcyA9IFtdOwogICAgICAgICAgICAgICAgcGF5b3V0cyA9IFtbbWFrZXIsIDEwMDAwXV07CiAgICAgICAgICAgICAgICBlbmNEYXRhID0gZW5jRGF0YVYxKHRoaXMud2ViMywgW3BheW91dHMsIG9yaWdpbkZlZXNdKTsKICAgICAgICAgICAgICAgIF9jb250ZXh0OS5uZXh0ID0gOTsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmFwaS5nZXRPZmZlck9yZGVyKHsKICAgICAgICAgICAgICAgICAgaWQ6IG9mZmVySWQKICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICBjYXNlIDk6CiAgICAgICAgICAgICAgICBvZmZlck9yZGVyID0gX2NvbnRleHQ5LnNlbnQ7CiAgICAgICAgICAgICAgICBhc3NldERhdGEgPSB0aGlzLl9lbmNBc3NldERhdGEobWFUeXBlTVYsIG1hQ29udHJhY3RBZGRyZXNzLCBtYVZhbHVlKTsKICAgICAgICAgICAgICAgIG1ha2VBc3NldCA9IEFzc2V0KG1hVHlwZU1WLCBhc3NldERhdGEsIHF1YW50aXR5KTsKCiAgICAgICAgICAgICAgICB0aGlzLl9jaGVja0RpZmZBc3NldHMobWFrZUFzc2V0LCBvZmZlck9yZGVyLm9yZGVyLnRha2VBc3NldCk7CgogICAgICAgICAgICAgICAgX2NvbnRleHQ5Lm5leHQgPSAxNTsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9tYWtlT3JkZXJBbmRBcHByb3ZlKG1ha2VyLCBtYWtlQXNzZXQsIG9mZmVyT3JkZXIub3JkZXIubWFrZXIsIG9mZmVyT3JkZXIub3JkZXIubWFrZUFzc2V0LCAwLCAwLCAwLCBPUkRFUl9EQVRBX1YxLCBlbmNEYXRhKTsKCiAgICAgICAgICAgICAgY2FzZSAxNToKICAgICAgICAgICAgICAgIHJldEFjY2VwdE9yZGVyID0gX2NvbnRleHQ5LnNlbnQ7CiAgICAgICAgICAgICAgICBfY29udGV4dDkubmV4dCA9IDE4OwogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX21hdGNoT3JkZXJzKHJldEFjY2VwdE9yZGVyLm9yZGVyLCByZXRBY2NlcHRPcmRlci5zaWduYXR1cmUsIG9mZmVyT3JkZXIub3JkZXIsIG9mZmVyT3JkZXIuc2lnbmF0dXJlLCBtYWtlcik7CgogICAgICAgICAgICAgIGNhc2UgMTg6CiAgICAgICAgICAgICAgICByZXQgPSBfY29udGV4dDkuc2VudDsKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDkuYWJydXB0KCJyZXR1cm4iLCByZXQpOwoKICAgICAgICAgICAgICBjYXNlIDIwOgogICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ5LnN0b3AoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sIF9jYWxsZWU5LCB0aGlzKTsKICAgICAgfSkpOwoKICAgICAgZnVuY3Rpb24gY3JlYXRlQWNjZXB0T3JkZXJBbmRNYXRjaChfeDkpIHsKICAgICAgICByZXR1cm4gX2NyZWF0ZUFjY2VwdE9yZGVyQW5kTWF0Y2guYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgfQoKICAgICAgcmV0dXJuIGNyZWF0ZUFjY2VwdE9yZGVyQW5kTWF0Y2g7CiAgICB9KCkgLy8gb3JkZXLrpbwg7Leo7IaMCgogIH0sIHsKICAgIGtleTogImNhbmNlbE9yZGVyIiwKICAgIHZhbHVlOiBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBfY2FuY2VsT3JkZXIgPSBfYXN5bmNUb0dlbmVyYXRvciggLyojX19QVVJFX18qL3JlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUxMChvcmRlciwgb3JkZXJfbWFrZXIpIHsKICAgICAgICB2YXIgZXhjaGFuZ2UsIF9jYWxsb2JqLCByZXM7CgogICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlMTAkKF9jb250ZXh0MTApIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQxMC5wcmV2ID0gX2NvbnRleHQxMC5uZXh0KSB7CiAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgLy8gaHR0cHM6Ly9naXRodWIuY29tL3JhcmlibGVjb20vcHJvdG9jb2wtZG9jdW1lbnRhdGlvbi9ibG9iL21hc3Rlci9leGNoYW5nZS91cGRhdGluZy1jYW5jZWxsaW5nLWFuLW9yZGVyLm1kCiAgICAgICAgICAgICAgICAvLyBvcmRlcgogICAgICAgICAgICAgICAgZXhjaGFuZ2UgPSB0aGlzLl9tYWtlQ29udHJhY3RJbnN0YW5jZShFeGNoYW5nZSwgdGhpcy5leGNoYW5nZUFkZHJlc3MpOwogICAgICAgICAgICAgICAgX2NhbGxvYmogPSBleGNoYW5nZS5tZXRob2RzLmNhbmNlbChvcmRlcik7CiAgICAgICAgICAgICAgICBfY29udGV4dDEwLm5leHQgPSA0OwogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuc2VuZFRyYW5zYWN0aW9uQW5kQ29uZmlybShvcmRlcl9tYWtlciwgdGhpcy5leGNoYW5nZUFkZHJlc3MsIF9jYWxsb2JqLCB7fSwgRXZlbnRUeXBlLkNhbmNlbE9yZGVyLCAnQ2FuY2VsT3JkZXInKTsKCiAgICAgICAgICAgICAgY2FzZSA0OgogICAgICAgICAgICAgICAgcmVzID0gX2NvbnRleHQxMC5zZW50OwogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0MTAuYWJydXB0KCJyZXR1cm4iLCByZXMpOwoKICAgICAgICAgICAgICBjYXNlIDY6CiAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDEwLnN0b3AoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sIF9jYWxsZWUxMCwgdGhpcyk7CiAgICAgIH0pKTsKCiAgICAgIGZ1bmN0aW9uIGNhbmNlbE9yZGVyKF94MTAsIF94MTEpIHsKICAgICAgICByZXR1cm4gX2NhbmNlbE9yZGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgIH0KCiAgICAgIHJldHVybiBjYW5jZWxPcmRlcjsKICAgIH0oKSAvLyBvcmRlciB1cGRhdGU/CiAgICAvLyBzd2FwIGV0aCB0byBlcmMyMCBob3cgdG8/CgogIH0sIHsKICAgIGtleTogImdldEJhbGFuY2VPZiIsCiAgICB2YWx1ZTogZnVuY3Rpb24gKCkgewogICAgICB2YXIgX2dldEJhbGFuY2VPZiA9IF9hc3luY1RvR2VuZXJhdG9yKCAvKiNfX1BVUkVfXyovcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTExKGFjY291bnQpIHsKICAgICAgICB2YXIgY29udHJhY3RBZGRyZXNzLAogICAgICAgICAgICB0b2tlbklkLAogICAgICAgICAgICBjb250cmFjdENsYXNzLAogICAgICAgICAgICBpbnN0YW5jZSwKICAgICAgICAgICAgX2luc3RhbmNlLAogICAgICAgICAgICBfYXJnczExID0gYXJndW1lbnRzOwoKICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTExJChfY29udGV4dDExKSB7CiAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0MTEucHJldiA9IF9jb250ZXh0MTEubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIGNvbnRyYWN0QWRkcmVzcyA9IF9hcmdzMTEubGVuZ3RoID4gMSAmJiBfYXJnczExWzFdICE9PSB1bmRlZmluZWQgPyBfYXJnczExWzFdIDogMDsKICAgICAgICAgICAgICAgIHRva2VuSWQgPSBfYXJnczExLmxlbmd0aCA+IDIgJiYgX2FyZ3MxMVsyXSAhPT0gdW5kZWZpbmVkID8gX2FyZ3MxMVsyXSA6IDA7CgogICAgICAgICAgICAgICAgLy8gaXMgNzIxIG9yIDExNTUKICAgICAgICAgICAgICAgIHRoaXMuX3ZlcmlmeVBhcmFtQWRkcmVzcyhbYWNjb3VudF0pOwoKICAgICAgICAgICAgICAgIHRoaXMuX3ZlcmlmeVBhcmFtVWludE51bWJlcihbdG9rZW5JZF0pOwoKICAgICAgICAgICAgICAgIGlmICghKGNvbnRyYWN0QWRkcmVzcyA9PSAwKSkgewogICAgICAgICAgICAgICAgICBfY29udGV4dDExLm5leHQgPSA4OwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBfY29udGV4dDExLm5leHQgPSA3OwogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMud2ViMy5ldGguZ2V0QmFsYW5jZShhY2NvdW50KTsKCiAgICAgICAgICAgICAgY2FzZSA3OgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0MTEuYWJydXB0KCJyZXR1cm4iLCBfY29udGV4dDExLnNlbnQpOwoKICAgICAgICAgICAgICBjYXNlIDg6CiAgICAgICAgICAgICAgICBfY29udGV4dDExLm5leHQgPSAxMDsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmNsYXNzaWZ5KGNvbnRyYWN0QWRkcmVzcyk7CgogICAgICAgICAgICAgIGNhc2UgMTA6CiAgICAgICAgICAgICAgICBjb250cmFjdENsYXNzID0gX2NvbnRleHQxMS5zZW50OwoKICAgICAgICAgICAgICAgIGlmICghKGNvbnRyYWN0Q2xhc3MgPT0gMTE1NSkpIHsKICAgICAgICAgICAgICAgICAgX2NvbnRleHQxMS5uZXh0ID0gMjA7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGlmICghKHRva2VuSWQgPCAxKSkgewogICAgICAgICAgICAgICAgICBfY29udGV4dDExLm5leHQgPSAxNDsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgdGhyb3cgJ3Rva2VuIGlkIG11c3QgYmlnZ2VyIHRoYW4gMCc7CgogICAgICAgICAgICAgIGNhc2UgMTQ6CiAgICAgICAgICAgICAgICBpbnN0YW5jZSA9IHRoaXMuX21ha2VDb250cmFjdEluc3RhbmNlKElFUkMxMTU1LCBjb250cmFjdEFkZHJlc3MpOwogICAgICAgICAgICAgICAgX2NvbnRleHQxMS5uZXh0ID0gMTc7CiAgICAgICAgICAgICAgICByZXR1cm4gaW5zdGFuY2UubWV0aG9kcy5iYWxhbmNlT2YoYWNjb3VudCwgdG9rZW5JZCkuY2FsbCgpOwoKICAgICAgICAgICAgICBjYXNlIDE3OgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0MTEuYWJydXB0KCJyZXR1cm4iLCBfY29udGV4dDExLnNlbnQpOwoKICAgICAgICAgICAgICBjYXNlIDIwOgogICAgICAgICAgICAgICAgaWYgKCEoY29udHJhY3RDbGFzcyA9PSAyMCB8fCBjb250cmFjdENsYXNzID09IDcyMSkpIHsKICAgICAgICAgICAgICAgICAgX2NvbnRleHQxMS5uZXh0ID0gMjc7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIC8vIEVSQzIwICYgRVJDNzIxIGhhcyBzYW1lIGludGVyZmFjZSAoICdiYWxhbmNlT2YoYWRkcmVzcyBhY2NvdW50KSByZXR1cm5zKHVpbnQyNTYgYW1vdW50KScgKQogICAgICAgICAgICAgICAgX2luc3RhbmNlID0gdGhpcy5fbWFrZUNvbnRyYWN0SW5zdGFuY2UoSUVSQzIwLCBjb250cmFjdEFkZHJlc3MpOwogICAgICAgICAgICAgICAgX2NvbnRleHQxMS5uZXh0ID0gMjQ7CiAgICAgICAgICAgICAgICByZXR1cm4gX2luc3RhbmNlLm1ldGhvZHMuYmFsYW5jZU9mKGFjY291bnQpLmNhbGwoKTsKCiAgICAgICAgICAgICAgY2FzZSAyNDoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDExLmFicnVwdCgicmV0dXJuIiwgX2NvbnRleHQxMS5zZW50KTsKCiAgICAgICAgICAgICAgY2FzZSAyNzoKICAgICAgICAgICAgICAgIHRocm93ICIiLmNvbmNhdChjb250cmFjdEFkZHJlc3MsICIgaXMgbm90IHRva2VuKDIwLDcyMSwxMTU1KSBjb250cmFjdC4iKTsKCiAgICAgICAgICAgICAgY2FzZSAyODoKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0MTEuc3RvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZTExLCB0aGlzKTsKICAgICAgfSkpOwoKICAgICAgZnVuY3Rpb24gZ2V0QmFsYW5jZU9mKF94MTIpIHsKICAgICAgICByZXR1cm4gX2dldEJhbGFuY2VPZi5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICB9CgogICAgICByZXR1cm4gZ2V0QmFsYW5jZU9mOwogICAgfSgpCiAgfSwgewogICAga2V5OiAiZ2V0VG9rZW5Pd25lck9mIiwKICAgIHZhbHVlOiBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBfZ2V0VG9rZW5Pd25lck9mID0gX2FzeW5jVG9HZW5lcmF0b3IoIC8qI19fUFVSRV9fKi9yZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlMTIoY29udHJhY3RBZGRyZXNzLCB0b2tlbklkKSB7CiAgICAgICAgdmFyIHRva2VuQ29udDsKICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTEyJChfY29udGV4dDEyKSB7CiAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0MTIucHJldiA9IF9jb250ZXh0MTIubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIHRoaXMuX3ZlcmlmeVBhcmFtQWRkcmVzcyhbY29udHJhY3RBZGRyZXNzXSk7CgogICAgICAgICAgICAgICAgdGhpcy5fdmVyaWZ5UGFyYW1VaW50TnVtYmVyKFt0b2tlbklkXSk7CgogICAgICAgICAgICAgICAgX2NvbnRleHQxMi5wcmV2ID0gMjsKICAgICAgICAgICAgICAgIHRva2VuQ29udCA9IHRoaXMuX21ha2VDb250cmFjdEluc3RhbmNlKE5GVENvbnRyYWN0LCBjb250cmFjdEFkZHJlc3MpOwogICAgICAgICAgICAgICAgX2NvbnRleHQxMi5uZXh0ID0gNjsKICAgICAgICAgICAgICAgIHJldHVybiB0b2tlbkNvbnQubWV0aG9kcy5vd25lck9mKHRva2VuSWQpLmNhbGwoKTsKCiAgICAgICAgICAgICAgY2FzZSA2OgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0MTIuYWJydXB0KCJyZXR1cm4iLCBfY29udGV4dDEyLnNlbnQpOwoKICAgICAgICAgICAgICBjYXNlIDk6CiAgICAgICAgICAgICAgICBfY29udGV4dDEyLnByZXYgPSA5OwogICAgICAgICAgICAgICAgX2NvbnRleHQxMi50MCA9IF9jb250ZXh0MTJbImNhdGNoIl0oMik7CiAgICAgICAgICAgICAgICB0aHJvdyAiZXJyb3I6Ii5jb25jYXQoX2NvbnRleHQxMi50MCwgIjogY29udHJhY3Qub3duZXJPZigiKS5jb25jYXQoKGNvbnRyYWN0QWRkcmVzcywgdG9rZW5JZCksICIpICIpOwoKICAgICAgICAgICAgICBjYXNlIDEyOgogICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQxMi5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlMTIsIHRoaXMsIFtbMiwgOV1dKTsKICAgICAgfSkpOwoKICAgICAgZnVuY3Rpb24gZ2V0VG9rZW5Pd25lck9mKF94MTMsIF94MTQpIHsKICAgICAgICByZXR1cm4gX2dldFRva2VuT3duZXJPZi5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICB9CgogICAgICByZXR1cm4gZ2V0VG9rZW5Pd25lck9mOwogICAgfSgpCiAgfSwgewogICAga2V5OiAiY2xhc3NpZnkiLAogICAgdmFsdWU6IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIF9jbGFzc2lmeSA9IF9hc3luY1RvR2VuZXJhdG9yKCAvKiNfX1BVUkVfXyovcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTEzKGNvbnRyYWN0QWRkcmVzcykgewogICAgICAgIHZhciBlcmM3MjFJRCwgZXJjMTE1NUlELCBjb250cmFjdCwgaXM3MjEsIGNvbnRyYWN0MiwgciwgaXMxMTU1OwogICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlMTMkKF9jb250ZXh0MTMpIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQxMy5wcmV2ID0gX2NvbnRleHQxMy5uZXh0KSB7CiAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgdGhpcy5fdmVyaWZ5UGFyYW1BZGRyZXNzKFtjb250cmFjdEFkZHJlc3NdKTsKCiAgICAgICAgICAgICAgICBlcmM3MjFJRCA9ICcweDgwYWM1OGNkJzsKICAgICAgICAgICAgICAgIGVyYzExNTVJRCA9ICcweGQ5YjY3YTI2JzsKICAgICAgICAgICAgICAgIGNvbnRyYWN0ID0gdGhpcy5fbWFrZUNvbnRyYWN0SW5zdGFuY2UoSUVSQzE2NSwgY29udHJhY3RBZGRyZXNzKTsKICAgICAgICAgICAgICAgIF9jb250ZXh0MTMucHJldiA9IDQ7CiAgICAgICAgICAgICAgICBfY29udGV4dDEzLm5leHQgPSA3OwogICAgICAgICAgICAgICAgcmV0dXJuIGNvbnRyYWN0Lm1ldGhvZHMuc3VwcG9ydHNJbnRlcmZhY2UoZXJjNzIxSUQpLmNhbGwoKTsKCiAgICAgICAgICAgICAgY2FzZSA3OgogICAgICAgICAgICAgICAgaXM3MjEgPSBfY29udGV4dDEzLnNlbnQ7CgogICAgICAgICAgICAgICAgaWYgKCFpczcyMSkgewogICAgICAgICAgICAgICAgICBfY29udGV4dDEzLm5leHQgPSAxMDsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0MTMuYWJydXB0KCJyZXR1cm4iLCA3MjEpOwoKICAgICAgICAgICAgICBjYXNlIDEwOgogICAgICAgICAgICAgICAgX2NvbnRleHQxMy5uZXh0ID0gMjg7CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgY2FzZSAxMjoKICAgICAgICAgICAgICAgIF9jb250ZXh0MTMucHJldiA9IDEyOwogICAgICAgICAgICAgICAgX2NvbnRleHQxMy50MCA9IF9jb250ZXh0MTNbImNhdGNoIl0oNCk7CiAgICAgICAgICAgICAgICAvLyAyMOyduOyngCDssrTtgawg7ZW07JW8IO2VqAogICAgICAgICAgICAgICAgY29udHJhY3QyID0gdGhpcy5fbWFrZUNvbnRyYWN0SW5zdGFuY2UoSUVSQzIwLCBjb250cmFjdEFkZHJlc3MpOwogICAgICAgICAgICAgICAgX2NvbnRleHQxMy5wcmV2ID0gMTU7CiAgICAgICAgICAgICAgICBfY29udGV4dDEzLm5leHQgPSAxODsKICAgICAgICAgICAgICAgIHJldHVybiBjb250cmFjdDIubWV0aG9kcy50b3RhbFN1cHBseSgpLmNhbGwoKTsKCiAgICAgICAgICAgICAgY2FzZSAxODoKICAgICAgICAgICAgICAgIHIgPSBfY29udGV4dDEzLnNlbnQ7CiAgICAgICAgICAgICAgICBfY29udGV4dDEzLm5leHQgPSAyMTsKICAgICAgICAgICAgICAgIHJldHVybiBjb250cmFjdDIubWV0aG9kcy5iYWxhbmNlT2YoWkVST19BRERSRVNTKS5jYWxsKCk7CgogICAgICAgICAgICAgIGNhc2UgMjE6CiAgICAgICAgICAgICAgICByID0gX2NvbnRleHQxMy5zZW50OwogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0MTMuYWJydXB0KCJyZXR1cm4iLCAyMCk7CgogICAgICAgICAgICAgIGNhc2UgMjU6CiAgICAgICAgICAgICAgICBfY29udGV4dDEzLnByZXYgPSAyNTsKICAgICAgICAgICAgICAgIF9jb250ZXh0MTMudDEgPSBfY29udGV4dDEzWyJjYXRjaCJdKDE1KTsKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDEzLmFicnVwdCgicmV0dXJuIiwgOTk5OSk7CgogICAgICAgICAgICAgIGNhc2UgMjg6CiAgICAgICAgICAgICAgICBfY29udGV4dDEzLm5leHQgPSAzMDsKICAgICAgICAgICAgICAgIHJldHVybiBjb250cmFjdC5tZXRob2RzLnN1cHBvcnRzSW50ZXJmYWNlKGVyYzExNTVJRCkuY2FsbCgpOwoKICAgICAgICAgICAgICBjYXNlIDMwOgogICAgICAgICAgICAgICAgaXMxMTU1ID0gX2NvbnRleHQxMy5zZW50OwoKICAgICAgICAgICAgICAgIGlmICghaXMxMTU1KSB7CiAgICAgICAgICAgICAgICAgIF9jb250ZXh0MTMubmV4dCA9IDMzOwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQxMy5hYnJ1cHQoInJldHVybiIsIDExNTUpOwoKICAgICAgICAgICAgICBjYXNlIDMzOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0MTMuYWJydXB0KCJyZXR1cm4iLCA5OTk5KTsKCiAgICAgICAgICAgICAgY2FzZSAzNDoKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0MTMuc3RvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZTEzLCB0aGlzLCBbWzQsIDEyXSwgWzE1LCAyNV1dKTsKICAgICAgfSkpOwoKICAgICAgZnVuY3Rpb24gY2xhc3NpZnkoX3gxNSkgewogICAgICAgIHJldHVybiBfY2xhc3NpZnkuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgfQoKICAgICAgcmV0dXJuIGNsYXNzaWZ5OwogICAgfSgpIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KICAgIC8vIFJveWFsdHkKICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KCiAgfSwgewogICAga2V5OiAiZ2V0Um95YWx0aWVzT3duZXIiLAogICAgdmFsdWU6IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIF9nZXRSb3lhbHRpZXNPd25lciA9IF9hc3luY1RvR2VuZXJhdG9yKCAvKiNfX1BVUkVfXyovcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTE0KGNvbnRyYWN0QWRkcmVzcywgdG9rZW5JZCkgewogICAgICAgIHZhciBuZnRDb250cmFjdCwgck93bmVyLCByb3lhbHRpZXNSZWdpc3RyeTsKICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTE0JChfY29udGV4dDE0KSB7CiAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0MTQucHJldiA9IF9jb250ZXh0MTQubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIHRoaXMuX3ZlcmlmeVBhcmFtQWRkcmVzcyhbY29udHJhY3RBZGRyZXNzXSk7CgogICAgICAgICAgICAgICAgdGhpcy5fdmVyaWZ5UGFyYW1VaW50TnVtYmVyKFt0b2tlbklkXSk7IC8vIFJveWFsdHlWMgoKCiAgICAgICAgICAgICAgICBuZnRDb250cmFjdCA9IHRoaXMuX21ha2VDb250cmFjdEluc3RhbmNlKE5GVENvbnRyYWN0LCBjb250cmFjdEFkZHJlc3MpOwogICAgICAgICAgICAgICAgX2NvbnRleHQxNC5uZXh0ID0gNTsKICAgICAgICAgICAgICAgIHJldHVybiBuZnRDb250cmFjdC5tZXRob2RzLmdldFJveWFsdHlPd25lcih0b2tlbklkKS5jYWxsKCk7CgogICAgICAgICAgICAgIGNhc2UgNToKICAgICAgICAgICAgICAgIHJPd25lciA9IF9jb250ZXh0MTQuc2VudDsKCiAgICAgICAgICAgICAgICBpZiAoIShyT3duZXIgJiYgck93bmVyICE9IFpFUk9fQUREUkVTUykpIHsKICAgICAgICAgICAgICAgICAgX2NvbnRleHQxNC5uZXh0ID0gOTsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgY29uc29sZS5sb2coIm5mdENvbnRyYWN0LmdldFJveWFsdHlPd25lciB3b3JrcyBQQVJVIyIuY29uY2F0KHRva2VuSWQsICIncyByb3lhbHR5T3duZXIgLT4gIikuY29uY2F0KHJPd25lcikpOwogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0MTQuYWJydXB0KCJyZXR1cm4iLCByT3duZXIpOwoKICAgICAgICAgICAgICBjYXNlIDk6CiAgICAgICAgICAgICAgICAvLyBFbmRPZiAtIFJveWFsdHlWMgogICAgICAgICAgICAgICAgcm95YWx0aWVzUmVnaXN0cnkgPSB0aGlzLl9tYWtlQ29udHJhY3RJbnN0YW5jZShSb3lhbHRpZXNSZWdpc3RyeSwgdGhpcy5yb3lhbHRpZXNBZGRyZXNzKTsKICAgICAgICAgICAgICAgIF9jb250ZXh0MTQubmV4dCA9IDEyOwogICAgICAgICAgICAgICAgcmV0dXJuIHJveWFsdGllc1JlZ2lzdHJ5Lm1ldGhvZHMuZ2V0Um95YWx0aWVzT3duZXIoY29udHJhY3RBZGRyZXNzLCB0b2tlbklkKS5jYWxsKCk7CgogICAgICAgICAgICAgIGNhc2UgMTI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQxNC5hYnJ1cHQoInJldHVybiIsIF9jb250ZXh0MTQuc2VudCk7CgogICAgICAgICAgICAgIGNhc2UgMTM6CiAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDE0LnN0b3AoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sIF9jYWxsZWUxNCwgdGhpcyk7CiAgICAgIH0pKTsKCiAgICAgIGZ1bmN0aW9uIGdldFJveWFsdGllc093bmVyKF94MTYsIF94MTcpIHsKICAgICAgICByZXR1cm4gX2dldFJveWFsdGllc093bmVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgIH0KCiAgICAgIHJldHVybiBnZXRSb3lhbHRpZXNPd25lcjsKICAgIH0oKQogIH0sIHsKICAgIGtleTogImdldFJveWFsdGllcyIsCiAgICB2YWx1ZTogZnVuY3Rpb24gKCkgewogICAgICB2YXIgX2dldFJveWFsdGllcyA9IF9hc3luY1RvR2VuZXJhdG9yKCAvKiNfX1BVUkVfXyovcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTE1KGNvbnRyYWN0QWRkcmVzcywgdG9rZW5JZCkgewogICAgICAgIHZhciBuZnRDb250cmFjdCwgcm95YWx0aWVzLCByb3lhbHRpZXNSZWdpc3RyeTsKICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTE1JChfY29udGV4dDE1KSB7CiAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0MTUucHJldiA9IF9jb250ZXh0MTUubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIHRoaXMuX3ZlcmlmeVBhcmFtQWRkcmVzcyhbY29udHJhY3RBZGRyZXNzXSk7CgogICAgICAgICAgICAgICAgdGhpcy5fdmVyaWZ5UGFyYW1VaW50TnVtYmVyKFt0b2tlbklkXSk7IC8vIFJveWFsdHlWMgoKCiAgICAgICAgICAgICAgICBuZnRDb250cmFjdCA9IHRoaXMuX21ha2VDb250cmFjdEluc3RhbmNlKE5GVENvbnRyYWN0LCBjb250cmFjdEFkZHJlc3MpOwogICAgICAgICAgICAgICAgX2NvbnRleHQxNS5uZXh0ID0gNTsKICAgICAgICAgICAgICAgIHJldHVybiBuZnRDb250cmFjdC5tZXRob2RzLmdldFJveWFsdGllcyh0b2tlbklkKS5jYWxsKCk7CgogICAgICAgICAgICAgIGNhc2UgNToKICAgICAgICAgICAgICAgIHJveWFsdGllcyA9IF9jb250ZXh0MTUuc2VudDsKCiAgICAgICAgICAgICAgICBpZiAoIShyb3lhbHRpZXMubGVuZ3RoID4gMCkpIHsKICAgICAgICAgICAgICAgICAgX2NvbnRleHQxNS5uZXh0ID0gOTsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgY29uc29sZS5sb2coIm5mdENvbnRyYWN0LmdldFJveWFsdGllcyB3b3Jrcy4gUEFSVSMiLmNvbmNhdCh0b2tlbklkLCAiJ3Mgcm95YWx0aWVzOiAiKS5jb25jYXQocm95YWx0aWVzKSk7CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQxNS5hYnJ1cHQoInJldHVybiIsIHJveWFsdGllcyk7CgogICAgICAgICAgICAgIGNhc2UgOToKICAgICAgICAgICAgICAgIC8vIEVPIC0gUm95YWx0eVYyCiAgICAgICAgICAgICAgICByb3lhbHRpZXNSZWdpc3RyeSA9IHRoaXMuX21ha2VDb250cmFjdEluc3RhbmNlKFJveWFsdGllc1JlZ2lzdHJ5LCB0aGlzLnJveWFsdGllc0FkZHJlc3MpOwogICAgICAgICAgICAgICAgX2NvbnRleHQxNS5uZXh0ID0gMTI7CiAgICAgICAgICAgICAgICByZXR1cm4gcm95YWx0aWVzUmVnaXN0cnkubWV0aG9kcy5nZXRSb3lhbHRpZXMoY29udHJhY3RBZGRyZXNzLCB0b2tlbklkKS5jYWxsKCk7CgogICAgICAgICAgICAgIGNhc2UgMTI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQxNS5hYnJ1cHQoInJldHVybiIsIF9jb250ZXh0MTUuc2VudCk7CgogICAgICAgICAgICAgIGNhc2UgMTM6CiAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDE1LnN0b3AoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sIF9jYWxsZWUxNSwgdGhpcyk7CiAgICAgIH0pKTsKCiAgICAgIGZ1bmN0aW9uIGdldFJveWFsdGllcyhfeDE4LCBfeDE5KSB7CiAgICAgICAgcmV0dXJuIF9nZXRSb3lhbHRpZXMuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgfQoKICAgICAgcmV0dXJuIGdldFJveWFsdGllczsKICAgIH0oKQogIH0sIHsKICAgIGtleTogInRyYW5zZmVyUm95YWx0aWVzT3duZXJzaGlwIiwKICAgIHZhbHVlOiBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBfdHJhbnNmZXJSb3lhbHRpZXNPd25lcnNoaXAgPSBfYXN5bmNUb0dlbmVyYXRvciggLyojX19QVVJFX18qL3JlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUxNihjb250cmFjdEFkZHJlc3MsIHRva2VuSWQsIG93bmVyTmV3LCBmcm9tKSB7CiAgICAgICAgdmFyIG93bmVyQmVmb3JlLCBuZnRDb250cmFjdCwgX2NhbGxvYmosIHJlcywgcm95YWx0aWVzUmVnaXN0cnk7CgogICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlMTYkKF9jb250ZXh0MTYpIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQxNi5wcmV2ID0gX2NvbnRleHQxNi5uZXh0KSB7CiAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgdGhpcy5fdmVyaWZ5UGFyYW1BZGRyZXNzKFtjb250cmFjdEFkZHJlc3MsIG93bmVyTmV3LCBmcm9tXSk7CgogICAgICAgICAgICAgICAgdGhpcy5fdmVyaWZ5UGFyYW1VaW50TnVtYmVyKFt0b2tlbklkXSk7CgogICAgICAgICAgICAgICAgb3duZXJOZXcgPSBvd25lck5ldy50b0xvd2VyQ2FzZSgpOwogICAgICAgICAgICAgICAgX2NvbnRleHQxNi5uZXh0ID0gNTsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmdldFJveWFsdGllc093bmVyKGNvbnRyYWN0QWRkcmVzcywgdG9rZW5JZCk7CgogICAgICAgICAgICAgIGNhc2UgNToKICAgICAgICAgICAgICAgIG93bmVyQmVmb3JlID0gX2NvbnRleHQxNi5zZW50OwoKICAgICAgICAgICAgICAgIGlmICghKG93bmVyQmVmb3JlLnRvTG93ZXJDYXNlKCkgPT0gb3duZXJOZXcpKSB7CiAgICAgICAgICAgICAgICAgIF9jb250ZXh0MTYubmV4dCA9IDg7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDE2LmFicnVwdCgicmV0dXJuIiwgewogICAgICAgICAgICAgICAgICBzdGF0dXM6IHRydWUsCiAgICAgICAgICAgICAgICAgIG93bmVyQmVmb3JlOiBvd25lckJlZm9yZQogICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgIGNhc2UgODoKICAgICAgICAgICAgICAgIF9jb250ZXh0MTYucHJldiA9IDg7CiAgICAgICAgICAgICAgICBuZnRDb250cmFjdCA9IHRoaXMuX21ha2VDb250cmFjdEluc3RhbmNlKE5GVENvbnRyYWN0LCBjb250cmFjdEFkZHJlc3MpOwogICAgICAgICAgICAgICAgX2NhbGxvYmogPSBuZnRDb250cmFjdC5tZXRob2RzLnRyYW5zZmVyUm95YWx0eU93bmVyc2hpcCh0b2tlbklkLCBvd25lck5ldyk7CiAgICAgICAgICAgICAgICBfY29udGV4dDE2Lm5leHQgPSAxMzsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnNlbmRUcmFuc2FjdGlvbkFuZENvbmZpcm0oZnJvbSwgY29udHJhY3RBZGRyZXNzLCBfY2FsbG9iaiwge30sIEV2ZW50VHlwZS5UcmFuc2ZlclJveWFsdGllc093bmVyc2hpcCwgJ1RyYW5zZmVyIHJveWFsdGllcyBvd25lcnNoaXAnKTsKCiAgICAgICAgICAgICAgY2FzZSAxMzoKICAgICAgICAgICAgICAgIHJlcyA9IF9jb250ZXh0MTYuc2VudDsKCiAgICAgICAgICAgICAgICBpZiAoIShyZXMuc3RhdHVzID09IHRydWUpKSB7CiAgICAgICAgICAgICAgICAgIF9jb250ZXh0MTYubmV4dCA9IDE2OwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQxNi5hYnJ1cHQoInJldHVybiIsIF9vYmplY3RTcHJlYWQoX29iamVjdFNwcmVhZCh7fSwgcmVzKSwge30sIHsKICAgICAgICAgICAgICAgICAgb3duZXJCZWZvcmU6IG93bmVyQmVmb3JlCiAgICAgICAgICAgICAgICB9KSk7CgogICAgICAgICAgICAgIGNhc2UgMTY6CiAgICAgICAgICAgICAgICBfY29udGV4dDE2Lm5leHQgPSAyMTsKICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICBjYXNlIDE4OgogICAgICAgICAgICAgICAgX2NvbnRleHQxNi5wcmV2ID0gMTg7CiAgICAgICAgICAgICAgICBfY29udGV4dDE2LnQwID0gX2NvbnRleHQxNlsiY2F0Y2giXSg4KTsKICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoX2NvbnRleHQxNi50MCk7CgogICAgICAgICAgICAgIGNhc2UgMjE6CiAgICAgICAgICAgICAgICAvLyBFTyAtIFJveWFsdHlWMgogICAgICAgICAgICAgICAgcm95YWx0aWVzUmVnaXN0cnkgPSB0aGlzLl9tYWtlQ29udHJhY3RJbnN0YW5jZShSb3lhbHRpZXNSZWdpc3RyeSwgdGhpcy5yb3lhbHRpZXNBZGRyZXNzKTsKICAgICAgICAgICAgICAgIF9jYWxsb2JqID0gcm95YWx0aWVzUmVnaXN0cnkubWV0aG9kcy50cmFuc2ZlclJveWFsdGllc093bmVyc2hpcChjb250cmFjdEFkZHJlc3MsIHRva2VuSWQsIG93bmVyTmV3KTsKICAgICAgICAgICAgICAgIF9jb250ZXh0MTYubmV4dCA9IDI1OwogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuc2VuZFRyYW5zYWN0aW9uQW5kQ29uZmlybShmcm9tLCB0aGlzLnJveWFsdGllc0FkZHJlc3MsIF9jYWxsb2JqLCB7fSwgRXZlbnRUeXBlLlRyYW5zZmVyUm95YWx0aWVzT3duZXJzaGlwLCAnVHJhbnNmZXIgcm95YWx0aWVzIG93bmVyc2hpcCcpOwoKICAgICAgICAgICAgICBjYXNlIDI1OgogICAgICAgICAgICAgICAgcmVzID0gX2NvbnRleHQxNi5zZW50OwogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0MTYuYWJydXB0KCJyZXR1cm4iLCBfb2JqZWN0U3ByZWFkKF9vYmplY3RTcHJlYWQoe30sIHJlcyksIHt9LCB7CiAgICAgICAgICAgICAgICAgIG93bmVyQmVmb3JlOiBvd25lckJlZm9yZQogICAgICAgICAgICAgICAgfSkpOwoKICAgICAgICAgICAgICBjYXNlIDI3OgogICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQxNi5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlMTYsIHRoaXMsIFtbOCwgMThdXSk7CiAgICAgIH0pKTsKCiAgICAgIGZ1bmN0aW9uIHRyYW5zZmVyUm95YWx0aWVzT3duZXJzaGlwKF94MjAsIF94MjEsIF94MjIsIF94MjMpIHsKICAgICAgICByZXR1cm4gX3RyYW5zZmVyUm95YWx0aWVzT3duZXJzaGlwLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgIH0KCiAgICAgIHJldHVybiB0cmFuc2ZlclJveWFsdGllc093bmVyc2hpcDsKICAgIH0oKQogIH0sIHsKICAgIGtleTogInVwZGF0ZVJveWFsdGllcyIsCiAgICB2YWx1ZTogZnVuY3Rpb24gKCkgewogICAgICB2YXIgX3VwZGF0ZVJveWFsdGllcyA9IF9hc3luY1RvR2VuZXJhdG9yKCAvKiNfX1BVUkVfXyovcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTE3KGNvbnRyYWN0QWRkcmVzcywgdG9rZW5JZCwgcm95YWx0aWVzTmV3LCBmcm9tKSB7CiAgICAgICAgdmFyIHRva2VuT3duZXIsIG93bmVyQmVmb3JlLCBfcm95YWx0aWVzQmVmb3JlLCBuZnRDb250LCBfY2FsbG9iaiwgcmVzLCByb3lhbHRpZXNSZWdpc3RyeTsKCiAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUxNyQoX2NvbnRleHQxNykgewogICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDE3LnByZXYgPSBfY29udGV4dDE3Lm5leHQpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICB0aGlzLl92ZXJpZnlQYXJhbUFkZHJlc3MoW2NvbnRyYWN0QWRkcmVzcywgZnJvbV0pOwoKICAgICAgICAgICAgICAgIHRoaXMuX3ZlcmlmeVBhcmFtVWludE51bWJlcihbdG9rZW5JZF0pOwoKICAgICAgICAgICAgICAgIHRoaXMuX3ZlcmlmeVBhcmFtVHlwZVBhcnQoW3JveWFsdGllc05ld10pOyAvLyBUT0RPOiAxMDDqs7HtlbTshJwg7J6F66Cl7ZWY6rKMIO2VoOyngCDslYTri4jrqbQg7JWI7JeQ7IScIDEwMCDqs7HtlaDsp4Dsl5Ag65Sw65287IScIOqygOyCrCDri6zrnbzsp4Tri6QuIOq3uOumrOqzoCDqt7jsl5Ag66ee64qUIOy1nOuMgOqwkiDqsoDsgqzrj4Qg7LaU6rCAIO2VhOyalO2VqCjstJ3tlakgMTAwJeydtO2VmCkKCgogICAgICAgICAgICAgICAgX2NvbnRleHQxNy5wcmV2ID0gMzsKICAgICAgICAgICAgICAgIF9jb250ZXh0MTcubmV4dCA9IDY7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5nZXRUb2tlbk93bmVyT2YoY29udHJhY3RBZGRyZXNzLCB0b2tlbklkKTsKCiAgICAgICAgICAgICAgY2FzZSA2OgogICAgICAgICAgICAgICAgdG9rZW5Pd25lciA9IF9jb250ZXh0MTcuc2VudDsKICAgICAgICAgICAgICAgIF9jb250ZXh0MTcubmV4dCA9IDEyOwogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgIGNhc2UgOToKICAgICAgICAgICAgICAgIF9jb250ZXh0MTcucHJldiA9IDk7CiAgICAgICAgICAgICAgICBfY29udGV4dDE3LnQwID0gX2NvbnRleHQxN1siY2F0Y2giXSgzKTsKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDE3LmFicnVwdCgicmV0dXJuIiwgewogICAgICAgICAgICAgICAgICBzdGF0dXM6IGZhbHNlLAogICAgICAgICAgICAgICAgICBlcnI6ICJjb250cmFjdCBvciB0b2tlbklkIHByb2JsZW06OiAiLmNvbmNhdChKU09OLnN0cmluZ2lmeShfY29udGV4dDE3LnQwKSkKICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICBjYXNlIDEyOgogICAgICAgICAgICAgICAgLy8gdmFyIHJlcyA9IGF3YWl0IHBhcnVsYS51cGRhdGVSb3lhbHRpZXMocGFydWxhLm5mdEFkZHJlc3MsIHRva2VuSWQsIHJveWFsdGllc1RvLCBBTElDRV9BRERSRVNTKQogICAgICAgICAgICAgICAgZnJvbSA9IGZyb20udG9Mb3dlckNhc2UoKTsKICAgICAgICAgICAgICAgIF9jb250ZXh0MTcubmV4dCA9IDE1OwogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ2V0Um95YWx0aWVzT3duZXIoY29udHJhY3RBZGRyZXNzLCB0b2tlbklkKTsKCiAgICAgICAgICAgICAgY2FzZSAxNToKICAgICAgICAgICAgICAgIG93bmVyQmVmb3JlID0gX2NvbnRleHQxNy5zZW50OwoKICAgICAgICAgICAgICAgIGlmICghKG93bmVyQmVmb3JlID09IFpFUk9fQUREUkVTUyAmJiB0b2tlbk93bmVyLnRvTG93ZXJDYXNlKCkgPT0gZnJvbSB8fCAvLyBvd25lckJlZm9yZeqwgCB6ZXJv6rOgLCB0b2tlbk93bmVyKGVyYzcyMS5vd25lck9mKGFkZHJlc3Mp6rCAIOunnuqxsOuCmAogICAgICAgICAgICAgICAgb3duZXJCZWZvcmUudG9Mb3dlckNhc2UoKSA9PSBmcm9tKSkgewogICAgICAgICAgICAgICAgICBfY29udGV4dDE3Lm5leHQgPSA0MzsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgX2NvbnRleHQxNy5uZXh0ID0gMTk7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5nZXRSb3lhbHRpZXMoY29udHJhY3RBZGRyZXNzLCB0b2tlbklkKTsKCiAgICAgICAgICAgICAgY2FzZSAxOToKICAgICAgICAgICAgICAgIF9yb3lhbHRpZXNCZWZvcmUgPSBfY29udGV4dDE3LnNlbnQ7CiAgICAgICAgICAgICAgICBfY29udGV4dDE3LnByZXYgPSAyMDsKICAgICAgICAgICAgICAgIG5mdENvbnQgPSB0aGlzLl9tYWtlQ29udHJhY3RJbnN0YW5jZShORlRDb250cmFjdCwgY29udHJhY3RBZGRyZXNzKTsKICAgICAgICAgICAgICAgIF9jb250ZXh0MTcubmV4dCA9IDI0OwogICAgICAgICAgICAgICAgcmV0dXJuIG5mdENvbnQubWV0aG9kcy51cGRhdGVSb3lhbHR5KHRva2VuSWQsIHJveWFsdGllc05ldyk7CgogICAgICAgICAgICAgIGNhc2UgMjQ6CiAgICAgICAgICAgICAgICBfY2FsbG9iaiA9IF9jb250ZXh0MTcuc2VudDsKICAgICAgICAgICAgICAgIF9jb250ZXh0MTcubmV4dCA9IDI3OwogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuc2VuZFRyYW5zYWN0aW9uQW5kQ29uZmlybShmcm9tLCBjb250cmFjdEFkZHJlc3MsIF9jYWxsb2JqLCB7fSwgRXZlbnRUeXBlLlVwZGF0ZVJveWFsdGllcywgJ1VwZGF0ZSByb3lhbHRpZXMnKTsKCiAgICAgICAgICAgICAgY2FzZSAyNzoKICAgICAgICAgICAgICAgIHJlcyA9IF9jb250ZXh0MTcuc2VudDsKCiAgICAgICAgICAgICAgICBpZiAoIShyZXMuc3RhdHVzID09IHRydWUpKSB7CiAgICAgICAgICAgICAgICAgIF9jb250ZXh0MTcubmV4dCA9IDMwOwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQxNy5hYnJ1cHQoInJldHVybiIsIF9vYmplY3RTcHJlYWQoX29iamVjdFNwcmVhZCh7fSwgcmVzKSwge30sIHsKICAgICAgICAgICAgICAgICAgcm95YWx0aWVzQmVmb3JlOiBfcm95YWx0aWVzQmVmb3JlLAogICAgICAgICAgICAgICAgICByb3lhbHRpZXNOZXc6IHJveWFsdGllc05ldwogICAgICAgICAgICAgICAgfSkpOwoKICAgICAgICAgICAgICBjYXNlIDMwOgogICAgICAgICAgICAgICAgX2NvbnRleHQxNy5uZXh0ID0gMzU7CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgY2FzZSAzMjoKICAgICAgICAgICAgICAgIF9jb250ZXh0MTcucHJldiA9IDMyOwogICAgICAgICAgICAgICAgX2NvbnRleHQxNy50MSA9IF9jb250ZXh0MTdbImNhdGNoIl0oMjApOwogICAgICAgICAgICAgICAgY29uc29sZS5sb2coX2NvbnRleHQxNy50MSk7CgogICAgICAgICAgICAgIGNhc2UgMzU6CiAgICAgICAgICAgICAgICAvLyBFTyAtIFJveWFsdHlWMgogICAgICAgICAgICAgICAgcm95YWx0aWVzUmVnaXN0cnkgPSB0aGlzLl9tYWtlQ29udHJhY3RJbnN0YW5jZShSb3lhbHRpZXNSZWdpc3RyeSwgdGhpcy5yb3lhbHRpZXNBZGRyZXNzKTsKICAgICAgICAgICAgICAgIF9jYWxsb2JqID0gcm95YWx0aWVzUmVnaXN0cnkubWV0aG9kcy5zZXRSb3lhbHRpZXNCeVRva2VuQW5kVG9rZW5JZChjb250cmFjdEFkZHJlc3MsIHRva2VuSWQsIHJveWFsdGllc05ldyk7CiAgICAgICAgICAgICAgICBfY29udGV4dDE3Lm5leHQgPSAzOTsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnNlbmRUcmFuc2FjdGlvbkFuZENvbmZpcm0oZnJvbSwgdGhpcy5yb3lhbHRpZXNBZGRyZXNzLCBfY2FsbG9iaiwge30sIEV2ZW50VHlwZS5VcGRhdGVSb3lhbHRpZXMsICdVcGRhdGUgcm95YWx0aWVzJyk7CgogICAgICAgICAgICAgIGNhc2UgMzk6CiAgICAgICAgICAgICAgICByZXMgPSBfY29udGV4dDE3LnNlbnQ7CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQxNy5hYnJ1cHQoInJldHVybiIsIF9vYmplY3RTcHJlYWQoX29iamVjdFNwcmVhZCh7fSwgcmVzKSwge30sIHsKICAgICAgICAgICAgICAgICAgcm95YWx0aWVzQmVmb3JlOiBfcm95YWx0aWVzQmVmb3JlLAogICAgICAgICAgICAgICAgICByb3lhbHRpZXNOZXc6IHJveWFsdGllc05ldwogICAgICAgICAgICAgICAgfSkpOwoKICAgICAgICAgICAgICBjYXNlIDQzOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0MTcuYWJydXB0KCJyZXR1cm4iLCB7CiAgICAgICAgICAgICAgICAgIHN0YXR1czogZmFsc2UsCiAgICAgICAgICAgICAgICAgIHRva2VuT3duZXI6IHRva2VuT3duZXIsCiAgICAgICAgICAgICAgICAgIG93bmVyQmVmb3JlOiBvd25lckJlZm9yZSwKICAgICAgICAgICAgICAgICAgJ3VwZGF0ZVJlcXVlc3RlZEZyb20nOiBmcm9tLAogICAgICAgICAgICAgICAgICBlcnI6ICdvd25lcnNoaXAgcHJvYmxlbScKICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICBjYXNlIDQ0OgogICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQxNy5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlMTcsIHRoaXMsIFtbMywgOV0sIFsyMCwgMzJdXSk7CiAgICAgIH0pKTsKCiAgICAgIGZ1bmN0aW9uIHVwZGF0ZVJveWFsdGllcyhfeDI0LCBfeDI1LCBfeDI2LCBfeDI3KSB7CiAgICAgICAgcmV0dXJuIF91cGRhdGVSb3lhbHRpZXMuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgfQoKICAgICAgcmV0dXJuIHVwZGF0ZVJveWFsdGllczsKICAgIH0oKSAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCiAgICAvLyBlbmQgb2YgUm95YWx0eQogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwogICAgLy8gVE9ETzogY29uc2lkZXIgdXBkYXRlIG1ldGFkYXRhCgogIH0sIHsKICAgIGtleTogIl9tYXRjaE9yZGVycyIsCiAgICB2YWx1ZTogZnVuY3Rpb24gKCkgewogICAgICB2YXIgX21hdGNoT3JkZXJzMiA9IF9hc3luY1RvR2VuZXJhdG9yKCAvKiNfX1BVUkVfXyovcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTE4KGxlZnRPcmRlciwgbGVmdFNpZ25hdHVyZSwgcmlnaHRPcmRlciwgcmlnaHRTaWduYXR1cmUsIGZyb20pIHsKICAgICAgICB2YXIgdmFsdWUsCiAgICAgICAgICAgIGV4Y2hhbmdlLAogICAgICAgICAgICB0bywKICAgICAgICAgICAgX2NhbGxvYmosCiAgICAgICAgICAgIF9wYXJhbSwKICAgICAgICAgICAgcmV0LAogICAgICAgICAgICBfYXJnczE4ID0gYXJndW1lbnRzOwoKICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTE4JChfY29udGV4dDE4KSB7CiAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0MTgucHJldiA9IF9jb250ZXh0MTgubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIHZhbHVlID0gX2FyZ3MxOC5sZW5ndGggPiA1ICYmIF9hcmdzMThbNV0gIT09IHVuZGVmaW5lZCA/IF9hcmdzMThbNV0gOiAwOwogICAgICAgICAgICAgICAgZXhjaGFuZ2UgPSB0aGlzLl9tYWtlQ29udHJhY3RJbnN0YW5jZShFeGNoYW5nZSwgdGhpcy5leGNoYW5nZUFkZHJlc3MpOwogICAgICAgICAgICAgICAgdG8gPSB0aGlzLmV4Y2hhbmdlQWRkcmVzczsKICAgICAgICAgICAgICAgIF9jYWxsb2JqID0gZXhjaGFuZ2UubWV0aG9kcy5tYXRjaE9yZGVycyhsZWZ0T3JkZXIsIGxlZnRTaWduYXR1cmUsIHJpZ2h0T3JkZXIsIHJpZ2h0U2lnbmF0dXJlKTsKICAgICAgICAgICAgICAgIF9wYXJhbSA9IHsKICAgICAgICAgICAgICAgICAgdmFsdWU6IHZhbHVlCiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgX2NvbnRleHQxOC5uZXh0ID0gNzsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnNlbmRUcmFuc2FjdGlvbkFuZENvbmZpcm0oZnJvbSwgdG8sIF9jYWxsb2JqLCBfcGFyYW0sIEV2ZW50VHlwZS5NYXRjaE9yZGVycywgIk1hdGNoIG9yZGVycyIpOwoKICAgICAgICAgICAgICBjYXNlIDc6CiAgICAgICAgICAgICAgICByZXQgPSBfY29udGV4dDE4LnNlbnQ7CiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygncmV0OjoyMjInLCByZXQpOwogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0MTguYWJydXB0KCJyZXR1cm4iLCByZXQpOwoKICAgICAgICAgICAgICBjYXNlIDEwOgogICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQxOC5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlMTgsIHRoaXMpOwogICAgICB9KSk7CgogICAgICBmdW5jdGlvbiBfbWF0Y2hPcmRlcnMoX3gyOCwgX3gyOSwgX3gzMCwgX3gzMSwgX3gzMikgewogICAgICAgIHJldHVybiBfbWF0Y2hPcmRlcnMyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgIH0KCiAgICAgIHJldHVybiBfbWF0Y2hPcmRlcnM7CiAgICB9KCkKICB9LCB7CiAgICBrZXk6ICJfYXBwcm92ZVRyYW5zZmVyUHJveHkiLAogICAgdmFsdWU6IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIF9hcHByb3ZlVHJhbnNmZXJQcm94eTIgPSBfYXN5bmNUb0dlbmVyYXRvciggLyojX19QVVJFX18qL3JlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUxOShhc3NldF90eXBlLCBjb250cmFjdF9hZGRyZXNzLCBhcHByb3ZlX2Ftb3VudCwgZnJvbSkgewogICAgICAgIHZhciByZXQsIHRvLCBfcGFyYW0sIHRyYW5zZmVyX3Byb3h5LCBpZXJjMjAsIGFsbG93YW5jZSwgX3N5bWJvbCwgc3ltYm9sLCBfY2FsbG9iaiwgX3RyYW5zZmVyX3Byb3h5LCBpZXJjLCBfY2FsbG9iajIsIGlzQXBwcm92ZWQsIGVycjsKCiAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUxOSQoX2NvbnRleHQxOSkgewogICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDE5LnByZXYgPSBfY29udGV4dDE5Lm5leHQpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICAvLyBmdW5jdGlvbiBpc0FwcHJvdmVkRm9yQWxsKGFkZHJlc3Mgb3duZXIsIGFkZHJlc3Mgb3BlcmF0b3IpCiAgICAgICAgICAgICAgICAvLyBmdW5jdGlvbiBzZXRBcHByb3ZhbEZvckFsbChhZGRyZXNzIG9wZXJhdG9yLCBib29sIGFwcHJvdmVkKSBwdWJsaWMgdmlydHVhbCBvdmVycmlkZQogICAgICAgICAgICAgICAgdG8gPSBjb250cmFjdF9hZGRyZXNzOwogICAgICAgICAgICAgICAgX3BhcmFtID0ge307CgogICAgICAgICAgICAgICAgaWYgKCEoYXNzZXRfdHlwZSA9PSBFUkMyMCkpIHsKICAgICAgICAgICAgICAgICAgX2NvbnRleHQxOS5uZXh0ID0gMjk7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHRyYW5zZmVyX3Byb3h5ID0gdGhpcy5lcmMyMFRyYW5zZmVyUHJveHlBZGRyZXNzOwogICAgICAgICAgICAgICAgaWVyYzIwID0gdGhpcy5fbWFrZUNvbnRyYWN0SW5zdGFuY2UoSUVSQzIwLCBjb250cmFjdF9hZGRyZXNzKTsgLy8gY2hlY2sgYWxsb3dhbmNlKG9wZXJhdG9yLCBzcGVuZGVyKSByZXR1cm5zKHVpbnQyNTYpCgogICAgICAgICAgICAgICAgX2NvbnRleHQxOS5uZXh0ID0gNzsKICAgICAgICAgICAgICAgIHJldHVybiBpZXJjMjAubWV0aG9kcy5hbGxvd2FuY2UoZnJvbSwgdHJhbnNmZXJfcHJveHkpLmNhbGwoKTsKCiAgICAgICAgICAgICAgY2FzZSA3OgogICAgICAgICAgICAgICAgYWxsb3dhbmNlID0gX2NvbnRleHQxOS5zZW50OwoKICAgICAgICAgICAgICAgIGlmICghKGFsbG93YW5jZSA+PSBhcHByb3ZlX2Ftb3VudCkpIHsKICAgICAgICAgICAgICAgICAgX2NvbnRleHQxOS5uZXh0ID0gMjM7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIF9jb250ZXh0MTkucHJldiA9IDk7CiAgICAgICAgICAgICAgICBfY29udGV4dDE5Lm5leHQgPSAxMjsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLndlYjMuZXRoLmNhbGwoewogICAgICAgICAgICAgICAgICBmcm9tOiBmcm9tLAogICAgICAgICAgICAgICAgICB0bzogY29udHJhY3RfYWRkcmVzcywKICAgICAgICAgICAgICAgICAgZGF0YTogdGhpcy53ZWIzLmV0aC5hYmkuZW5jb2RlRnVuY3Rpb25TaWduYXR1cmUoInN5bWJvbCgpIikKICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICBjYXNlIDEyOgogICAgICAgICAgICAgICAgX3N5bWJvbCA9IF9jb250ZXh0MTkuc2VudDsKICAgICAgICAgICAgICAgIHN5bWJvbCA9IHRoaXMud2ViMy5ldGguYWJpLmRlY29kZVBhcmFtZXRlcigic3RyaW5nIiwgX3N5bWJvbCk7CiAgICAgICAgICAgICAgICB0aGlzLmxvZ2dlcigiIi5jb25jYXQoZnJvbSwgIiBhcHByb3ZlICIpLmNvbmNhdChzeW1ib2wsICI6IikuY29uY2F0KGFsbG93YW5jZSwgIiBmb3IgIikuY29uY2F0KHRyYW5zZmVyX3Byb3h5KSk7CiAgICAgICAgICAgICAgICBfY29udGV4dDE5Lm5leHQgPSAyMDsKICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICBjYXNlIDE3OgogICAgICAgICAgICAgICAgX2NvbnRleHQxOS5wcmV2ID0gMTc7CiAgICAgICAgICAgICAgICBfY29udGV4dDE5LnQwID0gX2NvbnRleHQxOVsiY2F0Y2giXSg5KTsKICAgICAgICAgICAgICAgIHRoaXMubG9nZ2VyKF9jb250ZXh0MTkudDApOwoKICAgICAgICAgICAgICBjYXNlIDIwOgogICAgICAgICAgICAgICAgcmV0ID0gewogICAgICAgICAgICAgICAgICBzdGF0dXM6IHRydWUKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICBfY29udGV4dDE5Lm5leHQgPSAyNzsKICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICBjYXNlIDIzOgogICAgICAgICAgICAgICAgX2NhbGxvYmogPSBpZXJjMjAubWV0aG9kcy5hcHByb3ZlKHRyYW5zZmVyX3Byb3h5LCBhcHByb3ZlX2Ftb3VudCk7CiAgICAgICAgICAgICAgICBfY29udGV4dDE5Lm5leHQgPSAyNjsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnNlbmRUcmFuc2FjdGlvbkFuZENvbmZpcm0oZnJvbSwgdG8sIF9jYWxsb2JqLCBfcGFyYW0sIEV2ZW50VHlwZS5BcHByb3ZlQ3VycmVuY3ksICJBcHByb3ZlIGN1cnJlbmN5Iik7CgogICAgICAgICAgICAgIGNhc2UgMjY6CiAgICAgICAgICAgICAgICByZXQgPSBfY29udGV4dDE5LnNlbnQ7CgogICAgICAgICAgICAgIGNhc2UgMjc6CiAgICAgICAgICAgICAgICBfY29udGV4dDE5Lm5leHQgPSA1MDsKICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICBjYXNlIDI5OgogICAgICAgICAgICAgICAgaWYgKCEoYXNzZXRfdHlwZSA9PSBFUkM3MjEgfHwgYXNzZXRfdHlwZSA9PSBFUkMxMTU1KSkgewogICAgICAgICAgICAgICAgICBfY29udGV4dDE5Lm5leHQgPSA0OTsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgLy8gNzIxOiBmdW5jdGlvbiBzZXRBcHByb3ZhbEZvckFsbChhZGRyZXNzIG9wZXJhdG9yLCBib29sIF9hcHByb3ZlZCkgZXh0ZXJuYWw7CiAgICAgICAgICAgICAgICAvLyAxMTU1OiBmdW5jdGlvbiBzZXRBcHByb3ZhbEZvckFsbChhZGRyZXNzIF9vcGVyYXRvciwgYm9vbCBfYXBwcm92ZWQpIGV4dGVybmFsOwogICAgICAgICAgICAgICAgX3RyYW5zZmVyX3Byb3h5ID0gdGhpcy50cmFuc2ZlclByb3h5QWRkcmVzczsgLy8gdHJhbnNmZXItcHJveHkhIG5vdCBleGNoYW5nZQoKICAgICAgICAgICAgICAgIGlmIChhc3NldF90eXBlID09IEVSQzcyMSkgewogICAgICAgICAgICAgICAgICBpZXJjID0gdGhpcy5fbWFrZUNvbnRyYWN0SW5zdGFuY2UoTkZUQ29udHJhY3QsIGNvbnRyYWN0X2FkZHJlc3MpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgaWVyYyA9IHRoaXMuX21ha2VDb250cmFjdEluc3RhbmNlKE5GVDExNTVDb250cmFjdCwgY29udHJhY3RfYWRkcmVzcyk7CiAgICAgICAgICAgICAgICB9IC8vIGNoZWNrIGlzQXBwcm92ZWRGb3JBbGwob3duZXIsIG9wZXJhdG9yKSByZXR1cm5zKGJvb2wpCgoKICAgICAgICAgICAgICAgIF9jb250ZXh0MTkubmV4dCA9IDM0OwogICAgICAgICAgICAgICAgcmV0dXJuIGllcmMubWV0aG9kcy5pc0FwcHJvdmVkRm9yQWxsKGZyb20sIF90cmFuc2Zlcl9wcm94eSkuY2FsbCgpOwoKICAgICAgICAgICAgICBjYXNlIDM0OgogICAgICAgICAgICAgICAgaXNBcHByb3ZlZCA9IF9jb250ZXh0MTkuc2VudDsKCiAgICAgICAgICAgICAgICBpZiAoIWlzQXBwcm92ZWQpIHsKICAgICAgICAgICAgICAgICAgX2NvbnRleHQxOS5uZXh0ID0gNDM7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIF9jb250ZXh0MTkubmV4dCA9IDM4OwogICAgICAgICAgICAgICAgcmV0dXJuIGllcmMubWV0aG9kcy5zeW1ib2woKS5jYWxsKCk7CgogICAgICAgICAgICAgIGNhc2UgMzg6CiAgICAgICAgICAgICAgICBzeW1ib2wgPSBfY29udGV4dDE5LnNlbnQ7CiAgICAgICAgICAgICAgICB0aGlzLmxvZ2dlcigiIi5jb25jYXQoZnJvbSwgIiBhcHByb3ZlICIpLmNvbmNhdChzeW1ib2wsICIjIGZvciAiKS5jb25jYXQoX3RyYW5zZmVyX3Byb3h5KSk7CiAgICAgICAgICAgICAgICByZXQgPSB7CiAgICAgICAgICAgICAgICAgIHN0YXR1czogdHJ1ZQogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgIF9jb250ZXh0MTkubmV4dCA9IDQ3OwogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgIGNhc2UgNDM6CiAgICAgICAgICAgICAgICBfY2FsbG9iajIgPSBpZXJjLm1ldGhvZHMuc2V0QXBwcm92YWxGb3JBbGwoX3RyYW5zZmVyX3Byb3h5LCB0cnVlKTsKICAgICAgICAgICAgICAgIF9jb250ZXh0MTkubmV4dCA9IDQ2OwogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuc2VuZFRyYW5zYWN0aW9uQW5kQ29uZmlybShmcm9tLCB0bywgX2NhbGxvYmoyLCBfcGFyYW0sIEV2ZW50VHlwZS5BcHByb3ZlT3JkZXIsICJTZXQgYXBwcm92YWwgZm9yIGFsbCIpOwoKICAgICAgICAgICAgICBjYXNlIDQ2OgogICAgICAgICAgICAgICAgcmV0ID0gX2NvbnRleHQxOS5zZW50OwoKICAgICAgICAgICAgICBjYXNlIDQ3OgogICAgICAgICAgICAgICAgX2NvbnRleHQxOS5uZXh0ID0gNTA7CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgY2FzZSA0OToKICAgICAgICAgICAgICAgIC8vIEVUSAogICAgICAgICAgICAgICAgcmV0ID0gewogICAgICAgICAgICAgICAgICBzdGF0dXM6IHRydWUKICAgICAgICAgICAgICAgIH07CgogICAgICAgICAgICAgIGNhc2UgNTA6CiAgICAgICAgICAgICAgICBlcnIgPSByZXQuc3RhdHVzID8gJycgOiAiYXBwcm92ZSBmYWlsIjsKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDE5LmFicnVwdCgicmV0dXJuIiwgX29iamVjdFNwcmVhZChfb2JqZWN0U3ByZWFkKHt9LCByZXQpLCB7fSwgewogICAgICAgICAgICAgICAgICBlcnI6IGVycgogICAgICAgICAgICAgICAgfSkpOwoKICAgICAgICAgICAgICBjYXNlIDUyOgogICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQxOS5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlMTksIHRoaXMsIFtbOSwgMTddXSk7CiAgICAgIH0pKTsKCiAgICAgIGZ1bmN0aW9uIF9hcHByb3ZlVHJhbnNmZXJQcm94eShfeDMzLCBfeDM0LCBfeDM1LCBfeDM2KSB7CiAgICAgICAgcmV0dXJuIF9hcHByb3ZlVHJhbnNmZXJQcm94eTIuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgfQoKICAgICAgcmV0dXJuIF9hcHByb3ZlVHJhbnNmZXJQcm94eTsKICAgIH0oKQogIH0sIHsKICAgIGtleTogIl9tYWtlT3JkZXJBbmRBcHByb3ZlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBfbWFrZU9yZGVyQW5kQXBwcm92ZTIgPSBfYXN5bmNUb0dlbmVyYXRvciggLyojX19QVVJFX18qL3JlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUyMChtYWtlciwgbWFrZXJBc3NldCwgdGFrZXIsIHRha2VyQXNzZXQsIHNhbHQsIHN0YXJ0LCBlbmQsIGRhdGFUeXBlLCBlbmNEYXRhKSB7CiAgICAgICAgdmFyIG9yZGVyLCBkYXRhLCBzaWduYXR1cmUsIF9zaWduZWRfZGF0YV9hbmRfc2lnbiwgX2RlY0Fzc2V0LCB0eXBlTVYsIGNvbnRyYWN0QWRkcmVzcywgdmFsdWUsIHJldDsKCiAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUyMCQoX2NvbnRleHQyMCkgewogICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDIwLnByZXYgPSBfY29udGV4dDIwLm5leHQpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICB0aGlzLl92ZXJpZnlQYXJhbUFkZHJlc3MoW21ha2VyLCB0YWtlcl0pOwoKICAgICAgICAgICAgICAgIHRoaXMuX3ZlcmlmeVBhcmFtVWludE51bWJlcihbc2FsdCwgc3RhcnQsIGVuZF0pOwoKICAgICAgICAgICAgICAgIHRoaXMuX3ZlcmlmeVBhcmFtQXNzZXQoW21ha2VyQXNzZXQsIHRha2VyQXNzZXRdKTsgLy8gbmVlZCB0byB2ZXJpZnkgW2RhdGFUeXBlLCBlbmNEYXRhXSAKICAgICAgICAgICAgICAgIC8vIHZhbGlkYXRlIG1ha2VyLCB0YWtlciBhZGRyZXNzZXMKICAgICAgICAgICAgICAgIC8vIHZhbGlkYXRlIGFzc2V0cwoKCiAgICAgICAgICAgICAgICBvcmRlciA9IE9yZGVyKG1ha2VyLCBtYWtlckFzc2V0LCAvLyBBc3NldChFVEgsICIweCIsIDIwMCksIAogICAgICAgICAgICAgICAgdGFrZXIsIC8vIGNhbiBiZSBaRVJPCiAgICAgICAgICAgICAgICB0YWtlckFzc2V0LCAvLyBBc3NldChFUkM3MjEsIGVuYyhlcmM3MjEuYWRkcmVzcywgZXJjNzIxVG9rZW5JZDEpLCAxKSwgCiAgICAgICAgICAgICAgICBzYWx0LCAvLyAKICAgICAgICAgICAgICAgIHN0YXJ0LCAvLyAKICAgICAgICAgICAgICAgIGVuZCwgLy8gCiAgICAgICAgICAgICAgICBkYXRhVHlwZSwgLy8gT1JERVJfREFUQV9WMSAoRFQgbWFnaWMgdmFsdWUpCiAgICAgICAgICAgICAgICBlbmNEYXRhIC8vIGVuY0RhdGFSaWdodCAoRFQgZW5jcnlwdGVkKQogICAgICAgICAgICAgICAgKTsgLy8gc2lnbgoKICAgICAgICAgICAgICAgIGlmICghKHNhbHQgIT0gMCkpIHsKICAgICAgICAgICAgICAgICAgX2NvbnRleHQyMC5uZXh0ID0gMTI7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIF9jb250ZXh0MjAubmV4dCA9IDc7CiAgICAgICAgICAgICAgICByZXR1cm4gY3JlYXRlVHlwZWREYXRhQW5kU2lnbmF0dXJlKHRoaXMud2ViMywgdGhpcy5leGNoYW5nZUFkZHJlc3MsIG9yZGVyLCBtYWtlcik7CgogICAgICAgICAgICAgIGNhc2UgNzoKICAgICAgICAgICAgICAgIF9zaWduZWRfZGF0YV9hbmRfc2lnbiA9IF9jb250ZXh0MjAuc2VudDsKICAgICAgICAgICAgICAgIHNpZ25hdHVyZSA9IF9zaWduZWRfZGF0YV9hbmRfc2lnbi5zaWc7CiAgICAgICAgICAgICAgICBkYXRhID0gX3NpZ25lZF9kYXRhX2FuZF9zaWduLmRhdGE7CiAgICAgICAgICAgICAgICBfY29udGV4dDIwLm5leHQgPSAxNDsKICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICBjYXNlIDEyOgogICAgICAgICAgICAgICAgc2lnbmF0dXJlID0gJzB4MDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMCc7CiAgICAgICAgICAgICAgICBkYXRhID0gJyc7CgogICAgICAgICAgICAgIGNhc2UgMTQ6CiAgICAgICAgICAgICAgICBfZGVjQXNzZXQgPSBkZWNBc3NldCh0aGlzLndlYjMsIG1ha2VyQXNzZXQpLCB0eXBlTVYgPSBfZGVjQXNzZXQudHlwZU1WLCBjb250cmFjdEFkZHJlc3MgPSBfZGVjQXNzZXQuY29udHJhY3RBZGRyZXNzLCB2YWx1ZSA9IF9kZWNBc3NldC52YWx1ZTsKICAgICAgICAgICAgICAgIF9jb250ZXh0MjAubmV4dCA9IDE3OwogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2FwcHJvdmVUcmFuc2ZlclByb3h5KHR5cGVNViwgY29udHJhY3RBZGRyZXNzLCB2YWx1ZSwgbWFrZXIpOwoKICAgICAgICAgICAgICBjYXNlIDE3OgogICAgICAgICAgICAgICAgcmV0ID0gX2NvbnRleHQyMC5zZW50OwogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0MjAuYWJydXB0KCJyZXR1cm4iLCBfb2JqZWN0U3ByZWFkKF9vYmplY3RTcHJlYWQoe30sIHJldCksIHt9LCB7CiAgICAgICAgICAgICAgICAgIG9yZGVyOiBvcmRlciwKICAgICAgICAgICAgICAgICAgZGF0YTogZGF0YSwKICAgICAgICAgICAgICAgICAgc2lnbmF0dXJlOiBzaWduYXR1cmUKICAgICAgICAgICAgICAgIH0pKTsKCiAgICAgICAgICAgICAgY2FzZSAxOToKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0MjAuc3RvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZTIwLCB0aGlzKTsKICAgICAgfSkpOwoKICAgICAgZnVuY3Rpb24gX21ha2VPcmRlckFuZEFwcHJvdmUoX3gzNywgX3gzOCwgX3gzOSwgX3g0MCwgX3g0MSwgX3g0MiwgX3g0MywgX3g0NCwgX3g0NSkgewogICAgICAgIHJldHVybiBfbWFrZU9yZGVyQW5kQXBwcm92ZTIuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgfQoKICAgICAgcmV0dXJuIF9tYWtlT3JkZXJBbmRBcHByb3ZlOwogICAgfSgpCiAgfSwgewogICAga2V5OiAiX2V4dHJhY3RUcmFuc2ZlckluZm8iLAogICAgdmFsdWU6IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIF9leHRyYWN0VHJhbnNmZXJJbmZvMiA9IF9hc3luY1RvR2VuZXJhdG9yKCAvKiNfX1BVUkVfXyovcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTIxKHR4SGFzaCkgewogICAgICAgIHZhciByZWNlaXB0LCBsb2csIHNpZ1RyYW5zZmVyNzIxLCBzaWdUcmFuc2ZlcjExNTUsIHNpZ0V2dCwgZnJvbSwgdG8sIHRva2VuSWQsIHF1YW50aXR5LCByLCBibG9ja051bWJlciwgY29udHJhY3RBZGRyZXNzLCBpc01pbnRlZDsKICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTIxJChfY29udGV4dDIxKSB7CiAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0MjEucHJldiA9IF9jb250ZXh0MjEubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIF9jb250ZXh0MjEubmV4dCA9IDI7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy53ZWIzLmV0aC5nZXRUcmFuc2FjdGlvblJlY2VpcHQodHhIYXNoKTsKCiAgICAgICAgICAgICAgY2FzZSAyOgogICAgICAgICAgICAgICAgcmVjZWlwdCA9IF9jb250ZXh0MjEuc2VudDsKICAgICAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKHJlY2VpcHQubG9ncykKICAgICAgICAgICAgICAgIC8vIHJlY2VpcHQudHJhbnNhY3Rpb25IYXNoIC8vIHR4SGFzaAogICAgICAgICAgICAgICAgbG9nID0gcmVjZWlwdC5sb2dzWzBdOyAvLyBUT0RPOiBsb2fqsIAg7Jes65+sIOqwnOydvCDrlYzripQg7Ja065a76rKMIO2VoOqyqC8vIGFyciA9IGxvZ3MubWFwKGxvZyA9PiB7IC4uIGZyb20gPSBkZWNvZGUoJ2FkZHJlc3MnLCBsb2cudG9waWNzWzFdKSAuLn0pCiAgICAgICAgICAgICAgICAvLyBsb2cuZGF0YSAvLyBub24taW5kZXhlZCDtlYTrk5wg642w7J207YSw65Ok7J20IOyXrOq4sOyXkCDsoIDsnqXrkKgoaW5kZXhlZCDtlYTrk5zripQgdG9waWNz7JeQKQogICAgICAgICAgICAgICAgLy8ga2VjY2FrMjU2KCdUcmFuc2ZlcihhZGRyZXNzLGFkZHJlc3MsdWludDI1NiknKQoKICAgICAgICAgICAgICAgIHNpZ1RyYW5zZmVyNzIxID0gJzB4ZGRmMjUyYWQxYmUyYzg5YjY5YzJiMDY4ZmMzNzhkYWE5NTJiYTdmMTYzYzRhMTE2MjhmNTVhNGRmNTIzYjNlZic7CiAgICAgICAgICAgICAgICBzaWdUcmFuc2ZlcjExNTUgPSAnMHhjM2Q1ODE2OGM1YWU3Mzk3NzMxZDA2M2Q1YmJmM2Q2NTc4NTQ0MjczNDNmNGMwODMyNDBmN2FhY2FhMmQwZjYyJzsgLy8gY29uc29sZS5sb2cocmVjZWlwdCkgIC8vIGdhbmFjbGkg7JeQ7IScIO2FjOyKpO2KuO2VmOugpOqzoCDtlojripTrjbAsIGV2ZW50IOuwnOyDneydtCDslYjrkJjrhKQ7CgogICAgICAgICAgICAgICAgc2lnRXZ0ID0gbG9nLnRvcGljc1swXTsKICAgICAgICAgICAgICAgIHF1YW50aXR5ID0gMDsKCiAgICAgICAgICAgICAgICBpZiAoIShzaWdFdnQgPT0gc2lnVHJhbnNmZXI3MjEpKSB7CiAgICAgICAgICAgICAgICAgIF9jb250ZXh0MjEubmV4dCA9IDE0OwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBmcm9tID0gdGhpcy53ZWIzLmV0aC5hYmkuZGVjb2RlUGFyYW1ldGVyKCdhZGRyZXNzJywgbG9nLnRvcGljc1sxXSk7IC8vIGZyb20KCiAgICAgICAgICAgICAgICB0byA9IHRoaXMud2ViMy5ldGguYWJpLmRlY29kZVBhcmFtZXRlcignYWRkcmVzcycsIGxvZy50b3BpY3NbMl0pOyAvLyB0bwoKICAgICAgICAgICAgICAgIHRva2VuSWQgPSB0aGlzLndlYjMuZXRoLmFiaS5kZWNvZGVQYXJhbWV0ZXIoJ3VpbnQnLCBsb2cudG9waWNzWzNdKTsgLy8gdG9rZW5JZCAoaGV4KQoKICAgICAgICAgICAgICAgIF9jb250ZXh0MjEubmV4dCA9IDI1OwogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgIGNhc2UgMTQ6CiAgICAgICAgICAgICAgICBpZiAoIShzaWdFdnQgPT0gc2lnVHJhbnNmZXIxMTU1KSkgewogICAgICAgICAgICAgICAgICBfY29udGV4dDIxLm5leHQgPSAyMjsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgLy8gaW4gSUVSQzExNTUKICAgICAgICAgICAgICAgIC8vICAgZXZlbnQgVHJhbnNmZXJTaW5nbGUoYWRkcmVzcyBpbmRleGVkIG9wZXJhdG9yLCBhZGRyZXNzIGluZGV4ZWQgZnJvbSwgYWRkcmVzcyBpbmRleGVkIHRvLCB1aW50MjU2IGlkLCB1aW50MjU2IHZhbHVlKTsKICAgICAgICAgICAgICAgIGZyb20gPSB0aGlzLndlYjMuZXRoLmFiaS5kZWNvZGVQYXJhbWV0ZXIoJ2FkZHJlc3MnLCBsb2cudG9waWNzWzJdKTsgLy8gZnJvbQoKICAgICAgICAgICAgICAgIHRvID0gdGhpcy53ZWIzLmV0aC5hYmkuZGVjb2RlUGFyYW1ldGVyKCdhZGRyZXNzJywgbG9nLnRvcGljc1szXSk7IC8vIHRvCgogICAgICAgICAgICAgICAgciA9IHRoaXMud2ViMy5ldGguYWJpLmRlY29kZVBhcmFtZXRlcignKHVpbnQyNTYsdWludDI1NiknLCBsb2cuZGF0YSk7CiAgICAgICAgICAgICAgICB0b2tlbklkID0gclswXTsKICAgICAgICAgICAgICAgIHF1YW50aXR5ID0gclsxXTsKICAgICAgICAgICAgICAgIF9jb250ZXh0MjEubmV4dCA9IDI1OwogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgIGNhc2UgMjI6CiAgICAgICAgICAgICAgICB0aGlzLmxvZ2dlcignZXZlbnQgdHlwZSBpcyBub3QgaGFuZGxlZC4nKTsKICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGxvZyk7CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQyMS5hYnJ1cHQoInJldHVybiIsIHt9KTsKCiAgICAgICAgICAgICAgY2FzZSAyNToKICAgICAgICAgICAgICAgIGJsb2NrTnVtYmVyID0gbG9nLmJsb2NrTnVtYmVyOwogICAgICAgICAgICAgICAgY29udHJhY3RBZGRyZXNzID0gbG9nLmFkZHJlc3M7IC8vIGNvbnRyYWN0CgogICAgICAgICAgICAgICAgaXNNaW50ZWQgPSBmcm9tID09IFpFUk9fQUREUkVTUyA/IHRydWUgOiBmYWxzZTsgLy8gcGFyc2UgdW5pbmRleGVkIHBhcmFtZXRlciAgaHR0cHM6Ly9tZWRpdW0uY29tL2xpbnVtLWxhYnMvZXZlcnl0aGluZy15b3UtZXZlci13YW50ZWQtdG8ta25vdy1hYm91dC1ldmVudHMtYW5kLWxvZ3Mtb24tZXRoZXJldW0tZmVjODRlYTdkMGE1CiAgICAgICAgICAgICAgICAvLyBjb25zdCBkZWNvZGVyID0gbmV3IGV0aGVycy51dGlscy5BYmlDb2RlcigpOwogICAgICAgICAgICAgICAgLy8gY29uc3QgdW5pbmRleGVkRXZlbnRzID0gZXZlbnRzLmlucHV0cy5maWx0ZXIoZXZlbnQgPT4gZXZlbnQuaW5kZXhlZCA9PT0gZmFsc2UpOwogICAgICAgICAgICAgICAgLy8gY29uc3QgZGVjb2RlZExvZ3MgPSBsb2dzLm1hcChsb2cgPT4gZGVjb2Rlci5kZWNvZGUodW5pbmRleGVkRXZlbnRzLCBsb2cuZGF0YSkKCiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQyMS5hYnJ1cHQoInJldHVybiIsIHsKICAgICAgICAgICAgICAgICAgYmxvY2tOdW1iZXI6IGJsb2NrTnVtYmVyLAogICAgICAgICAgICAgICAgICB0eEhhc2g6IHR4SGFzaCwKICAgICAgICAgICAgICAgICAgY29udHJhY3RBZGRyZXNzOiBjb250cmFjdEFkZHJlc3MsCiAgICAgICAgICAgICAgICAgIHRva2VuSWQ6IE51bWJlcih0b2tlbklkKSwKICAgICAgICAgICAgICAgICAgcXVhbnRpdHk6IE51bWJlcihxdWFudGl0eSksCiAgICAgICAgICAgICAgICAgIGZyb206IGZyb20sCiAgICAgICAgICAgICAgICAgIHRvOiB0bywKICAgICAgICAgICAgICAgICAgaXNNaW50ZWQ6IGlzTWludGVkCiAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgY2FzZSAyOToKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0MjEuc3RvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZTIxLCB0aGlzKTsKICAgICAgfSkpOwoKICAgICAgZnVuY3Rpb24gX2V4dHJhY3RUcmFuc2ZlckluZm8oX3g0NikgewogICAgICAgIHJldHVybiBfZXh0cmFjdFRyYW5zZmVySW5mbzIuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgfQoKICAgICAgcmV0dXJuIF9leHRyYWN0VHJhbnNmZXJJbmZvOwogICAgfSgpCiAgfSwgewogICAga2V5OiAic2VuZFRyYW5zYWN0aW9uQW5kQ29uZmlybSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gKCkgewogICAgICB2YXIgX3NlbmRUcmFuc2FjdGlvbkFuZENvbmZpcm0gPSBfYXN5bmNUb0dlbmVyYXRvciggLyojX19QVVJFX18qL3JlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUyMihmcm9tLCB0bywgX2NhbGxvYmosIF9wYXJhbSwgZXZ0VHlwZSwgbG9nKSB7CiAgICAgICAgdmFyIHR4LCBpc0NvbmZpcm1lZDsKICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTIyJChfY29udGV4dDIyKSB7CiAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0MjIucHJldiA9IF9jb250ZXh0MjIubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIF9jb250ZXh0MjIubmV4dCA9IDI7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fbG93TGV2ZWxTZW5kKGZyb20sIHRvLCBfY2FsbG9iaiwgX3BhcmFtKTsKCiAgICAgICAgICAgICAgY2FzZSAyOgogICAgICAgICAgICAgICAgdHggPSBfY29udGV4dDIyLnNlbnQ7CgogICAgICAgICAgICAgICAgaWYgKCF0eC5zdGF0dXMpIHsKICAgICAgICAgICAgICAgICAgX2NvbnRleHQyMi5uZXh0ID0gMTA7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIF9jb250ZXh0MjIubmV4dCA9IDY7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fY29uZmlybVRyYW5zYWN0aW9uKHR4LnRyYW5zYWN0aW9uSGFzaCwgZXZ0VHlwZSwgbG9nKTsKCiAgICAgICAgICAgICAgY2FzZSA2OgogICAgICAgICAgICAgICAgaXNDb25maXJtZWQgPSBfY29udGV4dDIyLnNlbnQ7CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQyMi5hYnJ1cHQoInJldHVybiIsIHsKICAgICAgICAgICAgICAgICAgc3RhdHVzOiBpc0NvbmZpcm1lZCwKICAgICAgICAgICAgICAgICAgdHg6IHR4CiAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgY2FzZSAxMDoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDIyLmFicnVwdCgicmV0dXJuIiwgewogICAgICAgICAgICAgICAgICBzdGF0dXM6IGZhbHNlLAogICAgICAgICAgICAgICAgICB0eDogdHgKICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICBjYXNlIDExOgogICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQyMi5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlMjIsIHRoaXMpOwogICAgICB9KSk7CgogICAgICBmdW5jdGlvbiBzZW5kVHJhbnNhY3Rpb25BbmRDb25maXJtKF94NDcsIF94NDgsIF94NDksIF94NTAsIF94NTEsIF94NTIpIHsKICAgICAgICByZXR1cm4gX3NlbmRUcmFuc2FjdGlvbkFuZENvbmZpcm0uYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgfQoKICAgICAgcmV0dXJuIHNlbmRUcmFuc2FjdGlvbkFuZENvbmZpcm07CiAgICB9KCkKICB9LCB7CiAgICBrZXk6ICJfbG93TGV2ZWxTZW5kIiwKICAgIHZhbHVlOiBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBfbG93TGV2ZWxTZW5kMiA9IF9hc3luY1RvR2VuZXJhdG9yKCAvKiNfX1BVUkVfXyovcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTIzKGZyb20sIHRvLCBfY2FsbG9iaiwgX3BhcmFtKSB7CiAgICAgICAgdmFyIGRhdGEsIGdhc1ByaWNlLCBnYXM7CiAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUyMyQoX2NvbnRleHQyMykgewogICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDIzLnByZXYgPSBfY29udGV4dDIzLm5leHQpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICBkYXRhID0gX2NhbGxvYmouZW5jb2RlQUJJKCk7CiAgICAgICAgICAgICAgICBfY29udGV4dDIzLm5leHQgPSAzOwogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2NvbXB1dGVHYXNQcmljZSgpOwoKICAgICAgICAgICAgICBjYXNlIDM6CiAgICAgICAgICAgICAgICBnYXNQcmljZSA9IF9jb250ZXh0MjMuc2VudDsKICAgICAgICAgICAgICAgIF9jb250ZXh0MjMucHJldiA9IDQ7CiAgICAgICAgICAgICAgICBfY29udGV4dDIzLm5leHQgPSA3OwogICAgICAgICAgICAgICAgcmV0dXJuIF9jYWxsb2JqLmVzdGltYXRlR2FzKF9vYmplY3RTcHJlYWQoewogICAgICAgICAgICAgICAgICBmcm9tOiBmcm9tLAogICAgICAgICAgICAgICAgICB0bzogdG8KICAgICAgICAgICAgICAgIH0sIF9wYXJhbSkpOwoKICAgICAgICAgICAgICBjYXNlIDc6CiAgICAgICAgICAgICAgICBnYXMgPSBfY29udGV4dDIzLnNlbnQ7CiAgICAgICAgICAgICAgICBfY29udGV4dDIzLm5leHQgPSAxMDsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLndlYjMuZXRoLnNlbmRUcmFuc2FjdGlvbihfb2JqZWN0U3ByZWFkKHsKICAgICAgICAgICAgICAgICAgZnJvbTogZnJvbSwKICAgICAgICAgICAgICAgICAgdG86IHRvLAogICAgICAgICAgICAgICAgICBkYXRhOiBkYXRhLAogICAgICAgICAgICAgICAgICBnYXM6IGdhcywKICAgICAgICAgICAgICAgICAgZ2FzUHJpY2U6IGdhc1ByaWNlCiAgICAgICAgICAgICAgICB9LCBfcGFyYW0pKTsKCiAgICAgICAgICAgICAgY2FzZSAxMDoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDIzLmFicnVwdCgicmV0dXJuIiwgX2NvbnRleHQyMy5zZW50KTsKCiAgICAgICAgICAgICAgY2FzZSAxMzoKICAgICAgICAgICAgICAgIF9jb250ZXh0MjMucHJldiA9IDEzOwogICAgICAgICAgICAgICAgX2NvbnRleHQyMy50MCA9IF9jb250ZXh0MjNbImNhdGNoIl0oNCk7CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQyMy5hYnJ1cHQoInJldHVybiIsIHsKICAgICAgICAgICAgICAgICAgc3RhdHVzOiBmYWxzZSwKICAgICAgICAgICAgICAgICAgZXJyOiBfY29udGV4dDIzLnQwCiAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgY2FzZSAxNjoKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0MjMuc3RvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZTIzLCB0aGlzLCBbWzQsIDEzXV0pOwogICAgICB9KSk7CgogICAgICBmdW5jdGlvbiBfbG93TGV2ZWxTZW5kKF94NTMsIF94NTQsIF94NTUsIF94NTYpIHsKICAgICAgICByZXR1cm4gX2xvd0xldmVsU2VuZDIuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgfQoKICAgICAgcmV0dXJuIF9sb3dMZXZlbFNlbmQ7CiAgICB9KCkKICB9LCB7CiAgICBrZXk6ICJfbG93TGV2ZWxDYWxsIiwKICAgIHZhbHVlOiBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBfbG93TGV2ZWxDYWxsMiA9IF9hc3luY1RvR2VuZXJhdG9yKCAvKiNfX1BVUkVfXyovcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTI0KGZyb20sIHRvLCBfY2FsbCkgewogICAgICAgIHZhciBkYXRhLCByZXQ7CiAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUyNCQoX2NvbnRleHQyNCkgewogICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDI0LnByZXYgPSBfY29udGV4dDI0Lm5leHQpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICBkYXRhID0gX2NhbGwuZW5jb2RlQUJJKCk7CiAgICAgICAgICAgICAgICBfY29udGV4dDI0LnByZXYgPSAxOwogICAgICAgICAgICAgICAgX2NvbnRleHQyNC5uZXh0ID0gNDsKICAgICAgICAgICAgICAgIHJldHVybiB3ZWIzLmV0aC5jYWxsKHsKICAgICAgICAgICAgICAgICAgZnJvbTogZnJvbSwKICAgICAgICAgICAgICAgICAgdG86IHRvLAogICAgICAgICAgICAgICAgICBkYXRhOiBkYXRhCiAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgY2FzZSA0OgogICAgICAgICAgICAgICAgcmV0ID0gX2NvbnRleHQyNC5zZW50OwogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0MjQuYWJydXB0KCJyZXR1cm4iLCB0aGlzLndlYjMuZXRoLmFiaS5kZWNvZGVQYXJhbWV0ZXJzKF9jYWxsLl9tZXRob2Qub3V0cHV0cywgcmV0KVswXSk7CgogICAgICAgICAgICAgIGNhc2UgODoKICAgICAgICAgICAgICAgIF9jb250ZXh0MjQucHJldiA9IDg7CiAgICAgICAgICAgICAgICBfY29udGV4dDI0LnQwID0gX2NvbnRleHQyNFsiY2F0Y2giXSgxKTsKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDI0LmFicnVwdCgicmV0dXJuIiwge30pOwoKICAgICAgICAgICAgICBjYXNlIDExOgogICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQyNC5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlMjQsIHRoaXMsIFtbMSwgOF1dKTsKICAgICAgfSkpOwoKICAgICAgZnVuY3Rpb24gX2xvd0xldmVsQ2FsbChfeDU3LCBfeDU4LCBfeDU5KSB7CiAgICAgICAgcmV0dXJuIF9sb3dMZXZlbENhbGwyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgIH0KCiAgICAgIHJldHVybiBfbG93TGV2ZWxDYWxsOwogICAgfSgpCiAgfSwgewogICAga2V5OiAiX2NvbXB1dGVHYXNQcmljZSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gKCkgewogICAgICB2YXIgX2NvbXB1dGVHYXNQcmljZTIgPSBfYXN5bmNUb0dlbmVyYXRvciggLyojX19QVVJFX18qL3JlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUyNSgpIHsKICAgICAgICB2YXIgbWVhbkdhcywgd2VpVG9BZGQ7CiAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUyNSQoX2NvbnRleHQyNSkgewogICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDI1LnByZXYgPSBfY29udGV4dDI1Lm5leHQpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICBfY29udGV4dDI1Lm5leHQgPSAyOwogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMud2ViMy5ldGguZ2V0R2FzUHJpY2UoKTsKCiAgICAgICAgICAgICAgY2FzZSAyOgogICAgICAgICAgICAgICAgbWVhbkdhcyA9IF9jb250ZXh0MjUuc2VudDsKICAgICAgICAgICAgICAgIHdlaVRvQWRkID0gV2ViMy51dGlscy50b0JOKHRoaXMud2ViMy51dGlscy50b1dlaSh0aGlzLmdhc1ByaWNlQWRkaXRpb24sICdnd2VpJykpOwogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0MjUuYWJydXB0KCJyZXR1cm4iLCBXZWIzLnV0aWxzLnRvQk4obWVhbkdhcykuYWRkKHdlaVRvQWRkKS50b1N0cmluZygpKTsKCiAgICAgICAgICAgICAgY2FzZSA1OgogICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQyNS5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlMjUsIHRoaXMpOwogICAgICB9KSk7CgogICAgICBmdW5jdGlvbiBfY29tcHV0ZUdhc1ByaWNlKCkgewogICAgICAgIHJldHVybiBfY29tcHV0ZUdhc1ByaWNlMi5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICB9CgogICAgICByZXR1cm4gX2NvbXB1dGVHYXNQcmljZTsKICAgIH0oKQogIH0sIHsKICAgIGtleTogIl9jb25maXJtVHJhbnNhY3Rpb24iLAogICAgdmFsdWU6IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIF9jb25maXJtVHJhbnNhY3Rpb24yID0gX2FzeW5jVG9HZW5lcmF0b3IoIC8qI19fUFVSRV9fKi9yZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlMjYodHJhbnNhY3Rpb25IYXNoLCBldmVudCwgZGVzY3JpcHRpb24sIHRlc3RGb3JTdWNjZXNzKSB7CiAgICAgICAgdmFyIHRyYW5zYWN0aW9uRXZlbnREYXRhOwogICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlMjYkKF9jb250ZXh0MjYpIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQyNi5wcmV2ID0gX2NvbnRleHQyNi5uZXh0KSB7CiAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgdHJhbnNhY3Rpb25FdmVudERhdGEgPSB7CiAgICAgICAgICAgICAgICAgIHRyYW5zYWN0aW9uSGFzaDogdHJhbnNhY3Rpb25IYXNoLAogICAgICAgICAgICAgICAgICBldmVudDogZXZlbnQKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICB0aGlzLmxvZ2dlcigidHJhbnNhY3Rpb24gc3RhcnRlZCAtICIuY29uY2F0KGRlc2NyaXB0aW9uKSk7CgogICAgICAgICAgICAgICAgaWYgKCEodHJhbnNhY3Rpb25IYXNoID09IE5VTExfQkxPQ0tfSEFTSCkpIHsKICAgICAgICAgICAgICAgICAgX2NvbnRleHQyNi5uZXh0ID0gMTI7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIC8vIFRoaXMgd2FzIGEgc21hcnQgY29udHJhY3Qgd2FsbGV0IHRoYXQgZG9lc24ndCBrbm93IHRoZSB0cmFuc2FjdGlvbgogICAgICAgICAgICAgICAgdGhpcy5fZGlzcGF0Y2goRXZlbnRUeXBlLlRyYW5zYWN0aW9uQ3JlYXRlZCwgewogICAgICAgICAgICAgICAgICBldmVudDogZXZlbnQKICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgIGlmICh0ZXN0Rm9yU3VjY2VzcykgewogICAgICAgICAgICAgICAgICBfY29udGV4dDI2Lm5leHQgPSA5OwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAvLyBXYWl0IGlmIHRlc3Qgbm90IGltcGxlbWVudGVkCiAgICAgICAgICAgICAgICB0aGlzLmxvZ2dlcigiVW5rbm93biBhY3Rpb24sIHdhaXRpbmcgMSBtaW51dGU6ICIuY29uY2F0KGRlc2NyaXB0aW9uKSk7CiAgICAgICAgICAgICAgICBfY29udGV4dDI2Lm5leHQgPSA4OwogICAgICAgICAgICAgICAgcmV0dXJuIGRlbGF5KDYwICogMTAwMCk7CgogICAgICAgICAgICAgIGNhc2UgODoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDI2LmFicnVwdCgicmV0dXJuIik7CgogICAgICAgICAgICAgIGNhc2UgOToKICAgICAgICAgICAgICAgIF9jb250ZXh0MjYubmV4dCA9IDExOwogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3BvbGxDYWxsYmFja0ZvckNvbmZpcm1hdGlvbihldmVudCwgZGVzY3JpcHRpb24sIHRlc3RGb3JTdWNjZXNzKTsKCiAgICAgICAgICAgICAgY2FzZSAxMToKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDI2LmFicnVwdCgicmV0dXJuIiwgX2NvbnRleHQyNi5zZW50KTsKCiAgICAgICAgICAgICAgY2FzZSAxMjoKICAgICAgICAgICAgICAgIF9jb250ZXh0MjYucHJldiA9IDEyOwoKICAgICAgICAgICAgICAgIHRoaXMuX2Rpc3BhdGNoKEV2ZW50VHlwZS5UcmFuc2FjdGlvbkNyZWF0ZWQsIHRyYW5zYWN0aW9uRXZlbnREYXRhKTsKCiAgICAgICAgICAgICAgICBfY29udGV4dDI2Lm5leHQgPSAxNjsKICAgICAgICAgICAgICAgIHJldHVybiBjb25maXJtVHJhbnNhY3Rpb24odGhpcy53ZWIzLCB0cmFuc2FjdGlvbkhhc2gpOwoKICAgICAgICAgICAgICBjYXNlIDE2OgogICAgICAgICAgICAgICAgdGhpcy5sb2dnZXIoInRyYW5zYWN0aW9uIHN1Y2NlZWQgLSAiLmNvbmNhdChkZXNjcmlwdGlvbikpOwoKICAgICAgICAgICAgICAgIHRoaXMuX2Rpc3BhdGNoKEV2ZW50VHlwZS5UcmFuc2FjdGlvbkNvbmZpcm1lZCwgdHJhbnNhY3Rpb25FdmVudERhdGEpOwoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDI2LmFicnVwdCgicmV0dXJuIiwgdHJ1ZSk7CgogICAgICAgICAgICAgIGNhc2UgMjE6CiAgICAgICAgICAgICAgICBfY29udGV4dDI2LnByZXYgPSAyMTsKICAgICAgICAgICAgICAgIF9jb250ZXh0MjYudDAgPSBfY29udGV4dDI2WyJjYXRjaCJdKDEyKTsKICAgICAgICAgICAgICAgIHRoaXMubG9nZ2VyKCJ0cmFuc2FjdGlvbiBmYWlsZWQ6IC0gIi5jb25jYXQoZGVzY3JpcHRpb24pKTsKCiAgICAgICAgICAgICAgICB0aGlzLl9kaXNwYXRjaChFdmVudFR5cGUuVHJhbnNhY3Rpb25GYWlsZWQsIF9vYmplY3RTcHJlYWQoX29iamVjdFNwcmVhZCh7fSwgdHJhbnNhY3Rpb25FdmVudERhdGEpLCB7fSwgewogICAgICAgICAgICAgICAgICBlcnJvcjogX2NvbnRleHQyNi50MAogICAgICAgICAgICAgICAgfSkpOwoKICAgICAgICAgICAgICAgIHRocm93IF9jb250ZXh0MjYudDA7CgogICAgICAgICAgICAgIGNhc2UgMjY6CiAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDI2LnN0b3AoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sIF9jYWxsZWUyNiwgdGhpcywgW1sxMiwgMjFdXSk7CiAgICAgIH0pKTsKCiAgICAgIGZ1bmN0aW9uIF9jb25maXJtVHJhbnNhY3Rpb24oX3g2MCwgX3g2MSwgX3g2MiwgX3g2MykgewogICAgICAgIHJldHVybiBfY29uZmlybVRyYW5zYWN0aW9uMi5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICB9CgogICAgICByZXR1cm4gX2NvbmZpcm1UcmFuc2FjdGlvbjsKICAgIH0oKQogIH0sIHsKICAgIGtleTogIl9wb2xsQ2FsbGJhY2tGb3JDb25maXJtYXRpb24iLAogICAgdmFsdWU6IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIF9wb2xsQ2FsbGJhY2tGb3JDb25maXJtYXRpb24yID0gX2FzeW5jVG9HZW5lcmF0b3IoIC8qI19fUFVSRV9fKi9yZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlMjkoZXZlbnQsIGRlc2NyaXB0aW9uLCB0ZXN0Rm9yU3VjY2VzcykgewogICAgICAgIHZhciBfdGhpczIgPSB0aGlzOwoKICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTI5JChfY29udGV4dDI5KSB7CiAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0MjkucHJldiA9IF9jb250ZXh0MjkubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDI5LmFicnVwdCgicmV0dXJuIiwgbmV3IFByb21pc2UoIC8qI19fUFVSRV9fKi9mdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgIHZhciBfcmVmOCA9IF9hc3luY1RvR2VuZXJhdG9yKCAvKiNfX1BVUkVfXyovcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTI4KHJlc29sdmUsIHJlamVjdCkgewogICAgICAgICAgICAgICAgICAgIHZhciBpbml0aWFsUmV0cmllcywgdGVzdFJlc29sdmU7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUyOCQoX2NvbnRleHQyOCkgewogICAgICAgICAgICAgICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDI4LnByZXYgPSBfY29udGV4dDI4Lm5leHQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbml0aWFsUmV0cmllcyA9IDYwOyAvLyBjb25zdCB0ZXN0UmVzb2x2ZTogKHI6IG51bWJlcikgPT4gUHJvbWlzZTx2b2lkPiA9IGFzeW5jIHJldHJpZXMgPT4gewoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGNvbnN0IHRlc3RSZXNvbHZlOiAocjogbnVtYmVyKSA9PiBQcm9taXNlPHZvaWQ+ID0gYXN5bmMgcmV0cmllcyA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0ZXN0UmVzb2x2ZSA9IC8qI19fUFVSRV9fKi9mdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBfcmVmOSA9IF9hc3luY1RvR2VuZXJhdG9yKCAvKiNfX1BVUkVfXyovcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTI3KHJldHJpZXMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgd2FzU3VjY2Vzc2Z1bDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTI3JChfY29udGV4dDI3KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0MjcucHJldiA9IF9jb250ZXh0MjcubmV4dCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9jb250ZXh0MjcubmV4dCA9IDI7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGVzdEZvclN1Y2Nlc3MoKTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAyOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd2FzU3VjY2Vzc2Z1bCA9IF9jb250ZXh0Mjcuc2VudDsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXdhc1N1Y2Nlc3NmdWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQyNy5uZXh0ID0gOTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMyLmxvZ2dlcigiVHJhbnNhY3Rpb24gc3VjY2VlZGVkOiAiLmNvbmNhdChkZXNjcmlwdGlvbikpOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzMi5fZGlzcGF0Y2goRXZlbnRUeXBlLlRyYW5zYWN0aW9uQ29uZmlybWVkLCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV2ZW50OiBldmVudAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0MjcuYWJydXB0KCJyZXR1cm4iLCByZXNvbHZlKHRydWUpKTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSA5OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCEocmV0cmllcyA8PSAwKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfY29udGV4dDI3Lm5leHQgPSAxMTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0MjcuYWJydXB0KCJyZXR1cm4iLCByZWplY3QoZmFsc2UpKTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAxMToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXRyaWVzICUgMTAgPT0gMCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfdGhpczIubG9nZ2VyKCJUZXN0ZWQgdHJhbnNhY3Rpb24gIi5jb25jYXQoaW5pdGlhbFJldHJpZXMgLSByZXRyaWVzICsgMSwgIiB0aW1lczogIikuY29uY2F0KGRlc2NyaXB0aW9uKSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQyNy5uZXh0ID0gMTQ7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZGVsYXkoNTAwMCk7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMTQ6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQyNy5hYnJ1cHQoInJldHVybiIsIHRlc3RSZXNvbHZlKHJldHJpZXMgLSAxKSk7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMTU6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDI3LnN0b3AoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sIF9jYWxsZWUyNyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pKTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbiB0ZXN0UmVzb2x2ZShfeDY5KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9yZWY5LmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KCk7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0MjguYWJydXB0KCJyZXR1cm4iLCB0ZXN0UmVzb2x2ZShpbml0aWFsUmV0cmllcykpOwoKICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDM6CiAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDI4LnN0b3AoKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0sIF9jYWxsZWUyOCk7CiAgICAgICAgICAgICAgICAgIH0pKTsKCiAgICAgICAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbiAoX3g2NywgX3g2OCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBfcmVmOC5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgfSgpKSk7CgogICAgICAgICAgICAgIGNhc2UgMToKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0Mjkuc3RvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZTI5KTsKICAgICAgfSkpOwoKICAgICAgZnVuY3Rpb24gX3BvbGxDYWxsYmFja0ZvckNvbmZpcm1hdGlvbihfeDY0LCBfeDY1LCBfeDY2KSB7CiAgICAgICAgcmV0dXJuIF9wb2xsQ2FsbGJhY2tGb3JDb25maXJtYXRpb24yLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgIH0KCiAgICAgIHJldHVybiBfcG9sbENhbGxiYWNrRm9yQ29uZmlybWF0aW9uOwogICAgfSgpCiAgfSwgewogICAga2V5OiAiX2Rpc3BhdGNoIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBfZGlzcGF0Y2goZXZlbnQsIGRhdGEpIHsKICAgICAgdGhpcy5fZW1pdHRlci5lbWl0KGV2ZW50LCBkYXRhKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJfbWFrZUNvbnRyYWN0SW5zdGFuY2UiLAogICAgdmFsdWU6IGZ1bmN0aW9uIF9tYWtlQ29udHJhY3RJbnN0YW5jZShjb250cmFjdEFiaSkgewogICAgICB2YXIgY29udHJhY3RBZGRyZXNzID0gYXJndW1lbnRzLmxlbmd0aCA+IDEgJiYgYXJndW1lbnRzWzFdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMV0gOiBudWxsOwogICAgICByZXR1cm4gbWFrZUNvbnRyYWN0SW5zdGFuY2UodGhpcy53ZWIzLCB0aGlzLm5ldElkLCBjb250cmFjdEFiaSwgY29udHJhY3RBZGRyZXNzKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJfZW5jQXNzZXREYXRhIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBfZW5jQXNzZXREYXRhKHR5cGVNViwgY29udHJhY3RBZGRyZXNzLCB2YWx1ZSkgewogICAgICB2YXIgYXNzZXREYXRhOwoKICAgICAgaWYgKHR5cGVNViA9PSBFVEgpIHsKICAgICAgICAvLyBhc3NldERhdGEgPSAiMHgiIC8vWkVST19BRERSRVNTCiAgICAgICAgYXNzZXREYXRhID0gZW5jKHRoaXMud2ViMywgWkVST19BRERSRVNTKTsKICAgICAgfSBlbHNlIGlmICh0eXBlTVYgPT0gRVJDMjApIHsKICAgICAgICBhc3NldERhdGEgPSBlbmModGhpcy53ZWIzLCBjb250cmFjdEFkZHJlc3MpOwogICAgICB9IGVsc2UgaWYgKHR5cGVNViA9PSBFUkM3MjEgfHwgdHlwZU1WID09IEVSQzExNTUpIHsKICAgICAgICBhc3NldERhdGEgPSBlbmModGhpcy53ZWIzLCBjb250cmFjdEFkZHJlc3MsIHZhbHVlKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBjb25zb2xlLnRyYWNlKCk7CiAgICAgICAgdGhyb3cgInVua25vd24gdHlwZSBtYWdpYy12YWx1ZSAoIi5jb25jYXQodHlwZU1WLCAiKSIpOwogICAgICB9CgogICAgICByZXR1cm4gYXNzZXREYXRhOwogICAgfQogIH0sIHsKICAgIGtleTogIl92ZXJpZnlQYXJhbUFkZHJlc3MiLAogICAgdmFsdWU6IGZ1bmN0aW9uIF92ZXJpZnlQYXJhbUFkZHJlc3MoYWRkcmVzc2VzVG9WZXJpZnkpIHsKICAgICAgYWRkcmVzc2VzVG9WZXJpZnkuZm9yRWFjaChmdW5jdGlvbiAob25lKSB7CiAgICAgICAgaWYgKG9uZSA9PSB1bmRlZmluZWQpIHsKICAgICAgICAgIGNvbnNvbGUudHJhY2UoKTsKICAgICAgICAgIHRocm93ICJBZGRyZXNzICd1bmRlZmluZWQnIHBhc3NlZCI7CiAgICAgICAgfQoKICAgICAgICBpZiAob25lLmxlbmd0aCAhPSA0MikgewogICAgICAgICAgY29uc29sZS50cmFjZSgpOwogICAgICAgICAgdGhyb3cgIkFkZHJlc3MgbGVuZ3RoIGluY29ycmVjdCA6Ii5jb25jYXQob25lKTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfQogIH0sIHsKICAgIGtleTogIl92ZXJpZnlQYXJhbVR5cGVNViIsCiAgICB2YWx1ZTogZnVuY3Rpb24gX3ZlcmlmeVBhcmFtVHlwZU1WKHR5cGVzVG9WcmlmeSkgewogICAgICB0eXBlc1RvVnJpZnkuZm9yRWFjaChmdW5jdGlvbiAob25lKSB7CiAgICAgICAgaWYgKG9uZSA9PSB1bmRlZmluZWQpIHsKICAgICAgICAgIGNvbnNvbGUudHJhY2UoKTsKICAgICAgICAgIHRocm93ICJ0eXBlTVYgJ3VuZGVmaW5lZCcgcGFzc2VkIjsKICAgICAgICB9CgogICAgICAgIGlmIChvbmUubGVuZ3RoICE9IDEwKSB7CiAgICAgICAgICBjb25zb2xlLnRyYWNlKCk7CiAgICAgICAgICB0aHJvdyAidHlwZU1WIGxlbmd0aCBpbmNvcnJlY3QgOiAiLmNvbmNhdChvbmUpOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9CiAgfSwgewogICAga2V5OiAiX3ZlcmlmeVBhcmFtVWludE51bWJlciIsCiAgICB2YWx1ZTogZnVuY3Rpb24gX3ZlcmlmeVBhcmFtVWludE51bWJlcih2YWx1ZXNUb1ZlcmlmeSkgewogICAgICB2YWx1ZXNUb1ZlcmlmeS5mb3JFYWNoKGZ1bmN0aW9uIChvbmUpIHsKICAgICAgICBpZiAob25lID09IHVuZGVmaW5lZCkgewogICAgICAgICAgY29uc29sZS50cmFjZSgpOwogICAgICAgICAgdGhyb3cgInZhbHVlICd1bmRlZmluZWQnIHBhc3NlZCI7CiAgICAgICAgfQoKICAgICAgICBpZiAodHlwZW9mIG9uZSAhPSAnbnVtYmVyJykgewogICAgICAgICAgY29uc29sZS50cmFjZSgpOwogICAgICAgICAgdGhyb3cgInZhbHVlIGlzIG5vdCAnbnVtYmVyJyB0eXBlICIuY29uY2F0KF90eXBlb2Yob25lKSk7CiAgICAgICAgfQoKICAgICAgICBpZiAoTnVtYmVyKG9uZS50b0ZpeGVkKCkpICE9IG9uZSkgewogICAgICAgICAgY29uc29sZS50cmFjZSgpOwogICAgICAgICAgdGhyb3cgInZhbHVlIGlzIG5vdCBpbnRlZ2VyIjsKICAgICAgICB9CgogICAgICAgIGlmIChvbmUgPCAwKSB7CiAgICAgICAgICBjb25zb2xlLnRyYWNlKCk7CiAgICAgICAgICB0aHJvdyAidmFsdWUgaW5jb3JyZWN0ICIuY29uY2F0KG9uZSk7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJfdmVyaWZ5UGFyYW1UeXBlUGFydCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gX3ZlcmlmeVBhcmFtVHlwZVBhcnQocGFydHNUb1ZlcmlmeSkgewogICAgICB2YXIgX3RoaXMzID0gdGhpczsKCiAgICAgIC8vIHR5cGVQYXJ0IGlzIHN0cnVjdCBkZWZpbmVkIGluIExpYnBhcnQuc29sLCAnTGlicGFydC5QYXJ0W10nCiAgICAgIHBhcnRzVG9WZXJpZnkuZm9yRWFjaChmdW5jdGlvbiAocGFydFRvVmVyaWZ5KSB7CiAgICAgICAgcGFydFRvVmVyaWZ5LmZvckVhY2goZnVuY3Rpb24gKG9uZSkgewogICAgICAgICAgaWYgKG9uZSA9PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgY29uc29sZS50cmFjZSgpOwogICAgICAgICAgICB0aHJvdyAidmFsdWUgJ3VuZGVmaW5lZCcgcGFzc2VkIjsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAob25lLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgdmFyIGFjY291bnQgPSBvbmVbMF07CiAgICAgICAgICAgIHZhciB2YWx1ZSA9IG9uZVsxXTsKCiAgICAgICAgICAgIF90aGlzMy5fdmVyaWZ5UGFyYW1BZGRyZXNzKFthY2NvdW50XSk7CgogICAgICAgICAgICBfdGhpczMuX3ZlcmlmeVBhcmFtVWludE51bWJlcihbdmFsdWVdKTsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgfSk7CiAgICB9CiAgfSwgewogICAga2V5OiAiX3ZlcmlmeVBhcmFtQXNzZXQiLAogICAgdmFsdWU6IGZ1bmN0aW9uIF92ZXJpZnlQYXJhbUFzc2V0KGFzc2V0c1RvVmVyaWZ5KSB7CiAgICAgIHZhciBfdGhpczQgPSB0aGlzOwoKICAgICAgYXNzZXRzVG9WZXJpZnkuZm9yRWFjaChmdW5jdGlvbiAob25lKSB7CiAgICAgICAgaWYgKG9uZSA9PSB1bmRlZmluZWQpIHsKICAgICAgICAgIGNvbnNvbGUudHJhY2UoKTsKICAgICAgICAgIHRocm93ICJhc3NldCAndW5kZWZpbmVkJyBwYXNzZWQiOwogICAgICAgIH0KCiAgICAgICAgdmFyIGFzc2V0VHlwZSA9IG9uZS5hc3NldFR5cGUsCiAgICAgICAgICAgIHZhbHVlID0gb25lLnZhbHVlOwoKICAgICAgICBpZiAoYXNzZXRUeXBlID09IHVuZGVmaW5lZCkgewogICAgICAgICAgY29uc29sZS50cmFjZSgpOwogICAgICAgICAgdGhyb3cgImFzc2V0VHlwZSAndW5kZWZpbmVkJyBwYXNzZWQiOwogICAgICAgIH0KCiAgICAgICAgX3RoaXM0Ll92ZXJpZnlQYXJhbVVpbnROdW1iZXIoW3ZhbHVlXSk7CiAgICAgIH0pOwogICAgfQogIH0sIHsKICAgIGtleTogIl9jaGVja0RpZmZBc3NldHMiLAogICAgdmFsdWU6IGZ1bmN0aW9uIF9jaGVja0RpZmZBc3NldHMoYXNzZXQxLCBhc3NldDIpIHsKICAgICAgaWYgKGFzc2V0MS52YWx1ZSAhPSBhc3NldDIudmFsdWUgfHwgYXNzZXQxLmFzc2V0VHlwZS5hc3NldENsYXNzICE9IGFzc2V0Mi5hc3NldFR5cGUuYXNzZXRDbGFzcyB8fCBhc3NldDEuYXNzZXRUeXBlLmRhdGEgIT0gYXNzZXQyLmFzc2V0VHlwZS5kYXRhKSB7CiAgICAgICAgY29uc29sZS50cmFjZSgpOwogICAgICAgIHRocm93ICJhc3NldCBub3QgbWF0Y2hlZCI7CiAgICAgIH0KICAgIH0KICB9LCB7CiAgICBrZXk6ICJ0b0JOIiwKICAgIHZhbHVlOiBmdW5jdGlvbiB0b0JOKG51bWJlcikgewogICAgICByZXR1cm4gbmV3IHRoaXMud2ViMy51dGlscy5CTihudW1iZXIpOwogICAgfQogIH1dKTsKCiAgcmV0dXJuIFBhcnVsYTsKfSgpOyAvLyBleHBvcnQgZGVmYXVsdCBQYXJ1bGE7CgoKbW9kdWxlLmV4cG9ydHMgPSB7CiAgUGFydWxhOiBQYXJ1bGEKfTs="},{"version":3,"sources":["/Users/hyunjongkim/Documents/GitHub/palura-frontend/client-v1.0/src/parula-js/src/parula.js"],"names":["require","EventEmitter","Web3","makeContractInstance","confirmTransaction","createTypedDataAndSignature","recoverTypedSignature","enc","decAsset","encDataV1","ParulaAPI","NULL_BLOCK_HASH","ZERO_ADDRESS","ORDER_DATA_V1","ERC20","ERC721","ERC1155","ETH","Network","EventType","Order","Asset","NFTContract","NFT1155Contract","Exchange","RoyaltiesRegistry","IERC20","IERC165","IERC1155","config","Parula","provider","apiConfig","logger","Object","keys","Number","chainId","networkName","netId","nftAddress","nft1155Address","exchangeAddress","royaltiesAddress","royaltiesRegistryAddress","transferProxyAddress","erc20TransferProxyAddress","neededProperties","forEach","propName","undefined","web3","web3ReadOnly","readonlyProviderUrl","gasPriceAddition","utils","BN","api","arg","_emitter","signer","owner","erc721metadataURL","royalties","_verifyParamAddress","to","nft_contract","_makeContractInstance","royalty","is_valid_address","isAddress","_val","isNaN","console","log","length","_verifyParamTypePart","_callobj","methods","mintItemWithRoyalty","mintItem","from","_param","sendTransactionAndConfirm","TransactionCreated","ret","status","_extractTransferInfo","tx","transactionHash","id","quantity","_verifyParamUintNumber","maker","maTypeMV","maContractAddress","maValue","taker","taTypeMV","taContractAddress","taValue","salt","Date","now","startDatetime","endDatetime","_verifyParamTypeMV","getTokenOwnerOf","realOwner","toUpperCase","err","getBalanceOf","balanceOf","originFees","payouts","encData","maEncData","_encAssetData","taEncData","_makeOrderAndApprove","sellOrderId","start","end","getSellOrder","sellOrder","assetData","makeAsset","_checkDiffAssets","order","takeAsset","retBuyOrder","value","JSON","stringify","signature","_matchOrders","retMatch","taPriceBegin","taPriceEnd","isTimeLimited","priceMinHidden","retOrderData","createSellOrder","error","auctionId","getAuctionOrder","auctionOrder","immediate_buyable","order_maker_asset","order_maker","bidId","getBidOrder","bidOrder","retBidMatchOrder","taAssetData","offerId","getOfferOrder","offerOrder","retAcceptOrder","exchange","cancel","CancelOrder","res","account","contractAddress","tokenId","eth","getBalance","classify","contractClass","instance","call","tokenCont","ownerOf","erc721ID","erc1155ID","contract","supportsInterface","is721","contract2","totalSupply","r","is1155","nftContract","getRoyaltyOwner","rOwner","royaltiesRegistry","getRoyaltiesOwner","getRoyalties","ownerNew","toLowerCase","ownerBefore","transferRoyaltyOwnership","TransferRoyaltiesOwnership","transferRoyaltiesOwnership","royaltiesNew","tokenOwner","_royaltiesBefore","nftCont","updateRoyalty","UpdateRoyalties","royaltiesBefore","setRoyaltiesByTokenAndTokenId","leftOrder","leftSignature","rightOrder","rightSignature","matchOrders","MatchOrders","asset_type","contract_address","approve_amount","transfer_proxy","ierc20","allowance","data","abi","encodeFunctionSignature","_symbol","symbol","decodeParameter","approve","ApproveCurrency","ierc","isApprovedForAll","isApproved","setApprovalForAll","ApproveOrder","makerAsset","takerAsset","dataType","_verifyParamAsset","_signed_data_and_sign","sig","typeMV","_approveTransferProxy","txHash","getTransactionReceipt","receipt","logs","sigTransfer721","sigTransfer1155","sigEvt","topics","blockNumber","address","isMinted","evtType","_lowLevelSend","_confirmTransaction","isConfirmed","encodeABI","_computeGasPrice","gasPrice","estimateGas","gas","sendTransaction","_call","decodeParameters","_method","outputs","getGasPrice","meanGas","weiToAdd","toBN","toWei","add","toString","event","description","testForSuccess","transactionEventData","_dispatch","delay","_pollCallbackForConfirmation","TransactionConfirmed","TransactionFailed","Promise","resolve","reject","initialRetries","testResolve","retries","wasSuccessful","emit","contractAbi","trace","addressesToVerify","one","typesToVrify","valuesToVerify","toFixed","partsToVerify","partToVerify","assetsToVerify","assetType","asset1","asset2","assetClass","number","module","exports"],"mappings":"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","sourcesContent":["const {\r\n    EventEmitter\r\n} = require(\"fbemitter\")\r\nconst Web3 = require(\"web3\")\r\n\r\nconst {\r\n    makeContractInstance,\r\n    confirmTransaction,\r\n    createTypedDataAndSignature,\r\n    recoverTypedSignature,\r\n    enc,\r\n    decAsset,\r\n    encDataV1,\r\n} = require(\"./utils/utils.js\")\r\n\r\nconst {\r\n    ParulaAPI\r\n} = require('./api')\r\nconst {\r\n    NULL_BLOCK_HASH,\r\n    ZERO_ADDRESS,\r\n    ORDER_DATA_V1,\r\n    ERC20,\r\n    ERC721,\r\n    ERC1155,\r\n    ETH\r\n} = require(\"./constants\")\r\nconst {\r\n    Network,\r\n    EventType,\r\n    Order,\r\n    Asset\r\n} = require(\"./types\")\r\n\r\nconst {\r\n    NFTContract,\r\n    NFT1155Contract,\r\n    Exchange,\r\n    RoyaltiesRegistry,\r\n    IERC20,\r\n    IERC165,\r\n    IERC1155\r\n} = require(\"./contracts\")\r\n\r\n\r\nconst {\r\n    config\r\n} = require(\"../configs/rinkeby\") // defaultConfig\r\n\r\n\r\nclass Parula {\r\n    constructor(provider, apiConfig = {}, logger) {\r\n        // apiConfig.gasPrice = apiConfig.gasPrice || makeBigNumber(300000)\r\n\r\n        if (Object.keys(apiConfig) == 0) {\r\n            apiConfig = config\r\n        }\r\n        if (Number(provider.chainId) != apiConfig.chainId) {\r\n            throw \"parula-js.constructor:: provider.chain_id != config.chain_id\"\r\n        }\r\n        this.networkName = apiConfig.networkName\r\n\r\n        this.netId = apiConfig.netId\r\n\r\n        this.nftAddress = apiConfig.nftAddress\r\n        this.nft1155Address = apiConfig.nft1155Address\r\n        this.exchangeAddress = apiConfig.exchangeAddress\r\n        this.royaltiesAddress = apiConfig.royaltiesRegistryAddress\r\n        this.transferProxyAddress = apiConfig.transferProxyAddress\r\n        this.erc20TransferProxyAddress = apiConfig.erc20TransferProxyAddress\r\n\r\n        var neededProperties = [\r\n            'nftAddress', 'nft1155Address', 'netId', 'networkName', 'readonlyProviderUrl',\r\n            'exchangeAddress', 'royaltiesRegistryAddress', 'transferProxyAddress', 'erc20TransferProxyAddress',\r\n        ]\r\n        neededProperties.forEach(propName => {\r\n            if (apiConfig[propName] == undefined) {\r\n                throw `Configuration needed '${propName}' is not defined`\r\n            }\r\n        })\r\n\r\n        // Web3 Config\r\n        this.web3 = new Web3(provider)\r\n        this.web3ReadOnly = new Web3(apiConfig.readonlyProviderUrl)\r\n        this.gasPriceAddition = new Web3.utils.BN(1)\r\n\r\n        apiConfig.web3 = this.web3ReadOnly\r\n        this.api = new ParulaAPI(apiConfig, logger)\r\n\r\n        this.logger = logger || (function (arg) {\r\n            return arg;\r\n        })\r\n        this._emitter = new EventEmitter()\r\n    }\r\n\r\n    async createArtwork(signer, owner = '', erc721metadataURL = '', royalties = []) {\r\n        this._verifyParamAddress([signer])\r\n        if (owner) {\r\n            this._verifyParamAddress([owner])\r\n        } else {\r\n            owner = signer\r\n        }\r\n\r\n        var to = this.nftAddress\r\n        var nft_contract = this._makeContractInstance(NFTContract, this.nftAddress)\r\n        let _callobj\r\n\r\n        // check royalties valid\r\n        royalties.forEach((royalty) => {\r\n            // check royalty account\r\n            var is_valid_address = this.web3.utils.isAddress(royalty[0])\r\n            if (!is_valid_address) {\r\n                throw `fail to mint with royalty, invalid address: ${royalty[0]}`\r\n            }\r\n            // check royalty value\r\n            var _val = Number(royalty[1])\r\n            if (isNaN(_val) || _val < 1 || _val > 500) { // 1~500\r\n                throw `fail to mint with royalty, invalid value: ${royalty[1]}`\r\n            }\r\n        })\r\n        console.log(royalties)\r\n        if (royalties.length > 0) {\r\n            this._verifyParamTypePart([royalties])\r\n            _callobj = nft_contract.methods.mintItemWithRoyalty(owner, erc721metadataURL, owner, royalties) // royaltyOwner, royalties\r\n        } else {\r\n            _callobj = nft_contract.methods.mintItem(owner, erc721metadataURL)\r\n        }\r\n\r\n        const from = signer\r\n        const _param = {}\r\n\r\n        const ret = await this.sendTransactionAndConfirm(\r\n            from, to, _callobj, _param, EventType.TransactionCreated, \"Create NFT\")\r\n\r\n        if (ret.status) {\r\n            return await this._extractTransferInfo(ret.tx.transactionHash)\r\n        }\r\n    }\r\n\r\n    async createArtwork1155(signer, owner = '', erc721metadataURL = '', id = 0, quantity = 1, royalties = []) {\r\n        this._verifyParamAddress([signer])\r\n        if (owner) {\r\n            this._verifyParamAddress([owner])\r\n        } else {\r\n            owner = signer\r\n        }\r\n        this._verifyParamUintNumber([id, quantity])\r\n\r\n        var to = this.nft1155Address\r\n        var nft_contract = this._makeContractInstance(NFT1155Contract, this.nft1155Address)\r\n        let _callobj\r\n        if (royalties.length > 0) {\r\n            this._verifyParamTypePart([royalties])\r\n            _callobj = nft_contract.methods.mintItemWithRoyalty(owner, id, quantity, [], owner, royalties) //, royaltyOwner, royalties\r\n        } else {\r\n            _callobj = nft_contract.methods.mintItem(owner, id, quantity, [])\r\n        }\r\n\r\n        const from = signer\r\n        const _param = {}\r\n\r\n        const ret = await this.sendTransactionAndConfirm(\r\n            from, to, _callobj, _param, EventType.TransactionCreated, \"Create NFT\")\r\n\r\n        if (ret.status) {\r\n            return await this._extractTransferInfo(ret.tx.transactionHash)\r\n        }\r\n    }\r\n\r\n    async createSellOrder({\r\n        maker, // order maker address               web3.eth.abi.encodeParameters([\"address\", \"uint256\"], [token, tokenId]);\r\n        maTypeMV, // makerAsset,  // ma, Asset(ERC721, enc(erc721.address, erc721TokenId1), 1),\r\n        maContractAddress, // contract\r\n        maValue, // tokenId when erc721, 1155\r\n        quantity = 1,\r\n\r\n        taker = ZERO_ADDRESS, // order taker address, can be ZERO\r\n        taTypeMV, // takerAsset,  // ta, Asset(ETH, \"0x\", 200), ERC20\r\n        taContractAddress,\r\n        taValue, // or Value?\r\n\r\n        salt = Date.now(), // when regist order to orderbook salt is some-uint-value, else salt is 0\r\n        //   in ExchangeV2Core, same hashed order occur error\r\n        startDatetime = 0, // Date()\r\n        endDatetime = 0, // Date()\r\n    }) {\r\n        if (taTypeMV == ETH) {\r\n            this._verifyParamAddress([maker, maContractAddress, taker]) // eth는 contractAddress 없음\r\n        } else {\r\n            this._verifyParamAddress([maker, maContractAddress, taker, taContractAddress])\r\n        }\r\n        this._verifyParamTypeMV([maTypeMV, taTypeMV])\r\n        this._verifyParamUintNumber([maValue, taValue])\r\n\r\n        if (maTypeMV == ERC721) {\r\n            var realOwner = await this.getTokenOwnerOf(maContractAddress, maValue)\r\n            if (realOwner.toUpperCase() != maker.toUpperCase()) {\r\n                return {\r\n                    status: false,\r\n                    err: `Orderer(${maker}) is not the token owner(${realOwner})`\r\n                }\r\n            }\r\n        } else if (maTypeMV == ERC1155) {\r\n            var balanceOf = await this.getBalanceOf(maker, maContractAddress, maValue) // maValue is tokenId\r\n            if (balanceOf < quantity) {\r\n                return {\r\n                    status: false,\r\n                    err: `Orderer(${maker})'s balance is not enough. `\r\n                }\r\n            }\r\n        } else {\r\n            return {\r\n                status: false,\r\n                err: `Unsupported asset type: ${maTypeMV}`\r\n            }\r\n        }\r\n\r\n\r\n        const originFees = [] // originFees 가 원천징수 느낌인가보다\r\n        const payouts = [\r\n            [maker, 10000]\r\n        ] // 100% of takeAsset to orderMaker\r\n        const encData = encDataV1(this.web3, [payouts, originFees])\r\n        // TODO: check start and end date \r\n        //   var date = new Date()\r\n        //   date.valueOf() // 1622683295328\r\n        //   new Date(1622683295328) // 2021-06-03T01:21:35.328Z\r\n\r\n        var maEncData = this._encAssetData(maTypeMV, maContractAddress, maValue)\r\n        var taEncData = this._encAssetData(taTypeMV, taContractAddress, taValue)\r\n        // order struct\r\n        const ret = await this._makeOrderAndApprove(\r\n            maker,\r\n            Asset(maTypeMV, maEncData, quantity), // 721이면 value 1, 1155면 1 이상\r\n            taker,\r\n            Asset(taTypeMV, taEncData, taValue), // takerAsset,\r\n            salt,\r\n            startDatetime,\r\n            endDatetime,\r\n            ORDER_DATA_V1,\r\n            encData\r\n        );\r\n\r\n        // TODO: api.putSellOrder\r\n        return ret // ,orderId,\r\n    }\r\n\r\n    // 누가 판다고 내놓은 거 산다는 오더&매치\r\n    async createBuyOrderAndMatch({\r\n        maker, // order maker address   \r\n        maTypeMV, // takerAsset,  // ta, Asset(ETH, \"0x\", 200), ERC20\r\n        maContractAddress, // contract\r\n        maValue,\r\n\r\n        sellOrderId, // off-chain registered, 아니면 order_id만 받고, getOrder로 가져와? 그게 성능상 좋겠구만\r\n\r\n        salt = 0, // when regist order to orderbook salt is 1, else salt is 0\r\n        start = 0, // Date()\r\n        end = 0, // Date()\r\n    }) {\r\n        console.log(`\r\n        파룰라js안쪽\r\n        maker ${maker}\r\n        maTypeMV ${maTypeMV}\r\n        maContractAddress ${maContractAddress}\r\n        maValue ${maValue}\r\n        sellOrderId ${sellOrderId}\r\n        `)\r\n        if (maTypeMV == ETH) {\r\n            this._verifyParamAddress([maker])\r\n        } else {\r\n            this._verifyParamAddress([maker, maContractAddress])\r\n        }\r\n        this._verifyParamTypeMV([maTypeMV])\r\n        this._verifyParamUintNumber([maValue, sellOrderId])\r\n\r\n        let err = ''\r\n        const originFees = []\r\n        const payouts = [\r\n            [maker, 10000]\r\n        ] // 100% of takeAsset to orderMaker\r\n        const encData = encDataV1(this.web3, [payouts, originFees])\r\n\r\n        // api.get sell order\r\n        const sellOrder = await this.api.getSellOrder({\r\n            id: sellOrderId\r\n        }) // 구현 필요, 디테일한 사용법도 필요\r\n\r\n        var assetData = this._encAssetData(maTypeMV, maContractAddress, maValue)\r\n        var makeAsset = Asset(maTypeMV, assetData, maValue)\r\n        this._checkDiffAssets(makeAsset, sellOrder.order.takeAsset)\r\n        console.log('salt', salt)\r\n        // order struct\r\n        var retBuyOrder = await this._makeOrderAndApprove(\r\n            maker,\r\n            makeAsset,\r\n            sellOrder.order.maker,\r\n            sellOrder.order.makeAsset, // 보자보자 \r\n            salt,\r\n            start,\r\n            end,\r\n            ORDER_DATA_V1,\r\n            encData\r\n        );\r\n\r\n        let value = maTypeMV == ETH ? maValue : 0 // if eth value need, in wei\r\n        console.log('sellOrder.order', JSON.stringify(sellOrder.order), '---sellOrder.signature,', JSON.stringify(sellOrder.signature), '---retBuyOrder.order', JSON.stringify(retBuyOrder.order), '---retBuyOrder.signature', JSON.stringify(retBuyOrder.signature), 'maker', maker, 'value', value)\r\n        // need put buy-order?\r\n        var retMatch = await this._matchOrders(\r\n            sellOrder.order, sellOrder.signature, retBuyOrder.order, retBuyOrder.signature,\r\n            maker, value\r\n        )\r\n\r\n        return {\r\n            status: retMatch.status,\r\n            err: ''\r\n        }\r\n    }\r\n\r\n    ////////////////////////\r\n    //// bid에 매칭은 어떻게?\r\n    ////////////////////////\r\n    // auction 등록 -> 입찰(buyOrder) -> 낙찰(sellOrder -> matchOrders)\r\n    //\r\n    // 1. auction 등록하기\r\n    //   - 상품\r\n    //   - asset\r\n    //     - 시작가\r\n    //   - 시작일시\r\n    //   - 종료일시\r\n    //   - \r\n    // 2. listing auction\r\n    //   auction item은 [bid] 버튼 표시\r\n    //   실시간 종료까지 남은 시간 표시\r\n    //   정렬 (ebay참고: https://www.ebay.com/b/Toys-Hobbies/220/bn_1865497?LH_Auction=1&rt=nc&_sop=5)\r\n    //     best match\r\n    //     time: endding soonest\r\n    //     time: newly listed\r\n    //     price + shipping: lowest first\r\n    //     price + shipping: highest first\r\n    //     number of bids: fewest first\r\n    //     number of bids: most first\r\n    // 3. bidding\r\n    // 4. 낙찰(matchingOrder)\r\n\r\n    // 경매 내 놓는 오더\r\n    async createAuction({\r\n        startDatetime,\r\n        endDatetime,\r\n        maker,\r\n        maTypeMV,\r\n        maContractAddress,\r\n        maValue,\r\n        quantity = 1,\r\n\r\n        taker = ZERO_ADDRESS,\r\n        taTypeMV,\r\n        taContractAddress,\r\n        taPriceBegin,\r\n\r\n        taPriceEnd = 0, // 즉시구매가\r\n        isTimeLimited = true,\r\n        priceMinHidden = -1,\r\n    }) {\r\n        this._verifyParamAddress([maker, maContractAddress, taker])\r\n        this._verifyParamTypeMV([maTypeMV, taTypeMV])\r\n        this._verifyParamUintNumber([maValue, quantity, startDatetime, endDatetime, taPriceBegin, taPriceBegin])\r\n\r\n        if (maTypeMV == ERC721) {\r\n            var realOwner = await this.getTokenOwnerOf(maContractAddress, maValue)\r\n            if (realOwner.toUpperCase() != maker.toUpperCase()) {\r\n                return {\r\n                    status: false,\r\n                    err: `Orderer(${maker}) is not the token owner(${realOwner})`\r\n                }\r\n            }\r\n        } else if (maTypeMV == ERC1155) {\r\n            var balanceOf = await this.getBalanceOf(maker, maContractAddress, maValue) // maValue is tokenId\r\n            if (balanceOf < quantity) {\r\n                return {\r\n                    status: false,\r\n                    err: `Orderer(${maker})'s balance is not enough. `\r\n                }\r\n            }\r\n        } else {\r\n            return {\r\n                status: false,\r\n                err: `Unsupported asset type: ${maTypeMV}`\r\n            }\r\n        }\r\n\r\n        let retOrderData = null\r\n        let err = ''\r\n\r\n        if (taPriceEnd != 0) { // 즉시구매 시 사용될 sellOrder\r\n            retOrderData = await this.createSellOrder({\r\n                maker,\r\n                maTypeMV,\r\n                maContractAddress,\r\n                maValue,\r\n                taker,\r\n                taTypeMV,\r\n                taContractAddress,\r\n                taValue: taPriceEnd,\r\n                quantity,\r\n                start: startDatetime,\r\n                end: endDatetime\r\n            })\r\n\r\n            if (!retOrderData.status) {\r\n                console.error(retOrderData.err)\r\n                err = `err: ${retOrderData.err}`\r\n            }\r\n            // console.log(retOrderData.data, retOrderData.signature)\r\n        }\r\n        // 즉구 order, signature 만들었고,\r\n        //   즉구 order DB 테이블: market_order\r\n\r\n        // 테이블 따로 필요 없지?\r\n\r\n        // 경매 취소 가능한가? || 입찰 없으면 가능, 입찰 있으면 불가능\r\n        return {\r\n            ...retOrderData,\r\n            err\r\n        }\r\n    }\r\n\r\n    async createBidOrder({\r\n        maker, // bidder\r\n        maTypeMV,\r\n        maContractAddress,\r\n        maValue,\r\n\r\n        // taker, // auction owner\r\n        // taTypeMV, taContractAddress, taValue,\r\n\r\n        auctionId\r\n    }) {\r\n        if (maTypeMV == ETH) {\r\n            return {\r\n                status: false,\r\n                err: \"Can't use ETH for bid-order\"\r\n            }\r\n        }\r\n        this._verifyParamAddress([maker, maContractAddress])\r\n        this._verifyParamTypeMV([maTypeMV])\r\n        this._verifyParamUintNumber([maValue, auctionId])\r\n\r\n        const originFees = []\r\n        const payouts = [\r\n            [maker, 10000]\r\n        ] // 100% of takeAsset to orderMaker\r\n        const encData = encDataV1(this.web3, [payouts, originFees])\r\n\r\n        var auctionOrder = await this.api.getAuctionOrder({\r\n            id: auctionId\r\n        })\r\n\r\n        var assetData = this._encAssetData(maTypeMV, maContractAddress, maValue)\r\n        var makeAsset = Asset(maTypeMV, assetData, maValue)\r\n\r\n        let order_maker;\r\n        let order_maker_asset;\r\n        if (!auctionOrder.immediate_buyable) {\r\n            order_maker_asset = auctionOrder.order.makeAsset\r\n            order_maker = auctionOrder.order.maker\r\n        } else {\r\n            order_maker = auctionOrder.order.maker\r\n            order_maker_asset = auctionOrder.order.makeAsset\r\n        }\r\n\r\n        // this._checkDiffAssets(makeAsset, auctionOrder.order.takeAsset)\r\n        // order struct\r\n        const ret = await this._makeOrderAndApprove(\r\n            maker,\r\n            makeAsset,\r\n            order_maker,\r\n            order_maker_asset,\r\n            1, 0, 0,\r\n            ORDER_DATA_V1,\r\n            encData\r\n        );\r\n\r\n        return ret\r\n    }\r\n\r\n    async createBidMatch({\r\n        maker,\r\n        maTypeMV,\r\n        maContractAddress,\r\n        maValue,\r\n        quantity = 1,\r\n\r\n        bidId, // off-chain registered id in DB\r\n    }) {\r\n        this._verifyParamAddress([maker, maContractAddress])\r\n        this._verifyParamTypeMV([maTypeMV])\r\n        this._verifyParamUintNumber([maValue, bidId, quantity])\r\n\r\n        const originFees = []\r\n        const payouts = [\r\n            [maker, 10000]\r\n        ]\r\n        const encData = encDataV1(this.web3, [payouts, originFees])\r\n\r\n        var bidOrder = await this.api.getBidOrder({\r\n            id: bidId\r\n        })\r\n\r\n        var assetData = this._encAssetData(maTypeMV, maContractAddress, maValue)\r\n        var makeAsset = Asset(maTypeMV, assetData, quantity)\r\n        this._checkDiffAssets(makeAsset, bidOrder.order.takeAsset)\r\n\r\n        const retBidMatchOrder = await this._makeOrderAndApprove(\r\n            maker,\r\n            makeAsset,\r\n            bidOrder.order.maker,\r\n            bidOrder.order.makeAsset,\r\n            0, 0, 0,\r\n            ORDER_DATA_V1, encData\r\n        )\r\n        // TODO: match\r\n        var ret = await this._matchOrders(\r\n            retBidMatchOrder.order, retBidMatchOrder.signature, bidOrder.order, bidOrder.signature,\r\n            maker\r\n        )\r\n        return ret\r\n    }\r\n\r\n    // 나한테 팔라고 하는 제안 오더\r\n    async createOfferOrder({\r\n        maker, // offerer\r\n        maTypeMV,\r\n        maContractAddress,\r\n        maValue,\r\n\r\n        taker, // offeree\r\n        taTypeMV,\r\n        taContractAddress,\r\n        taValue,\r\n        quantity = 1,\r\n        salt = Date.now() //   in ExchangeV2Core, same hashed order occur error\r\n    }) {\r\n        if (maTypeMV == ETH) {\r\n            return {\r\n                status: false,\r\n                err: \"Can't use ETH for offer-order\"\r\n            }\r\n        }\r\n        this._verifyParamAddress([maker, maContractAddress, taker, taContractAddress])\r\n        this._verifyParamTypeMV([maTypeMV, taTypeMV])\r\n        this._verifyParamUintNumber([maValue, taValue, quantity, salt])\r\n\r\n        const originFees = []\r\n        const payouts = [\r\n            [maker, 10000]\r\n        ] // 100% of takeAsset to orderMaker\r\n        const encData = encDataV1(this.web3, [payouts, originFees])\r\n\r\n        var assetData = this._encAssetData(maTypeMV, maContractAddress, maValue)\r\n        var taAssetData = this._encAssetData(taTypeMV, taContractAddress, taValue)\r\n        // order struct\r\n        const ret = await this._makeOrderAndApprove(\r\n            maker,\r\n            Asset(maTypeMV, assetData, maValue),\r\n            taker,\r\n            Asset(taTypeMV, taAssetData, quantity), // target must be NFT?\r\n            salt,\r\n            0,\r\n            0,\r\n            ORDER_DATA_V1,\r\n            encData\r\n        );\r\n\r\n        return ret\r\n    }\r\n\r\n    // // offer를 수락하는 오더\r\n    async createAcceptOrderAndMatch({\r\n        maker,\r\n        maTypeMV,\r\n        maContractAddress,\r\n        maValue,\r\n        quantity = 1,\r\n\r\n        offerId, // off-chain registered, 아니면 order_id만 받고, getOrder로 가져와? 그게 성능상 좋겠구만\r\n    }) {\r\n        this._verifyParamAddress([maker, maContractAddress])\r\n        this._verifyParamTypeMV([maTypeMV])\r\n        this._verifyParamUintNumber([maValue, offerId, quantity])\r\n\r\n        const originFees = []\r\n        const payouts = [\r\n            [maker, 10000]\r\n        ]\r\n\r\n        const encData = encDataV1(this.web3, [payouts, originFees])\r\n        var offerOrder = await this.api.getOfferOrder({\r\n            id: offerId\r\n        })\r\n\r\n        var assetData = this._encAssetData(maTypeMV, maContractAddress, maValue)\r\n        var makeAsset = Asset(maTypeMV, assetData, quantity)\r\n        this._checkDiffAssets(makeAsset, offerOrder.order.takeAsset)\r\n\r\n        const retAcceptOrder = await this._makeOrderAndApprove(\r\n            maker,\r\n            makeAsset,\r\n            offerOrder.order.maker,\r\n            offerOrder.order.makeAsset,\r\n            0, 0, 0,\r\n            ORDER_DATA_V1, encData\r\n        )\r\n\r\n        // TODO: match\r\n        // console.log(retAcceptOrder.order, retAcceptOrder.signature, offerOrder.order, offerOrder.signature)\r\n        var ret = await this._matchOrders(\r\n            retAcceptOrder.order, retAcceptOrder.signature, offerOrder.order, offerOrder.signature,\r\n            maker\r\n        )\r\n        return ret\r\n    }\r\n\r\n    // order를 취소\r\n    async cancelOrder(order, order_maker) {\r\n        // https://github.com/rariblecom/protocol-documentation/blob/master/exchange/updating-cancelling-an-order.md\r\n        // order\r\n        const exchange = this._makeContractInstance(Exchange, this.exchangeAddress)\r\n        var _callobj = exchange.methods.cancel(order)\r\n        var res = await this.sendTransactionAndConfirm(\r\n            order_maker, this.exchangeAddress, _callobj, {},\r\n            EventType.CancelOrder, 'CancelOrder'\r\n        )\r\n        return res\r\n    }\r\n\r\n    // order update?\r\n\r\n    // swap eth to erc20 how to?\r\n\r\n    async getBalanceOf(account, contractAddress = 0, tokenId = 0) { // is 721 or 1155\r\n        this._verifyParamAddress([account])\r\n        this._verifyParamUintNumber([tokenId])\r\n\r\n        if (contractAddress == 0) { // ETH\r\n            return await this.web3.eth.getBalance(account)\r\n        }\r\n\r\n        // else\r\n\r\n        const contractClass = await this.classify(contractAddress)\r\n        if (contractClass == 1155) {\r\n            if (tokenId < 1) {\r\n                throw 'token id must bigger than 0'\r\n            }\r\n            const instance = this._makeContractInstance(IERC1155, contractAddress)\r\n            return await instance.methods.balanceOf(account, tokenId).call()\r\n        } else if (contractClass == 20 || contractClass == 721) { // ERC20 & ERC721 has same interface ( 'balanceOf(address account) returns(uint256 amount)' )\r\n            const instance = this._makeContractInstance(IERC20, contractAddress)\r\n            return await instance.methods.balanceOf(account).call()\r\n        } else {\r\n            throw `${contractAddress} is not token(20,721,1155) contract.`\r\n        }\r\n    }\r\n\r\n    async getTokenOwnerOf(contractAddress, tokenId) {\r\n        this._verifyParamAddress([contractAddress])\r\n        this._verifyParamUintNumber([tokenId])\r\n        try {\r\n            var tokenCont = this._makeContractInstance(NFTContract, contractAddress)\r\n            return await tokenCont.methods.ownerOf(tokenId).call()\r\n        } catch (err) {\r\n            throw `error:${err}: contract.ownerOf(${contractAddress, tokenId}) `\r\n        }\r\n    }\r\n\r\n    async classify(contractAddress) {\r\n        this._verifyParamAddress([contractAddress])\r\n\r\n        const erc721ID = '0x80ac58cd'\r\n        const erc1155ID = '0xd9b67a26'\r\n        const contract = this._makeContractInstance(IERC165, contractAddress)\r\n\r\n        try {\r\n            var is721 = await contract.methods.supportsInterface(erc721ID).call()\r\n            if (is721) {\r\n                return 721\r\n            }\r\n        } catch (e) {\r\n            // 20인지 체크 해야 함\r\n            const contract2 = this._makeContractInstance(IERC20, contractAddress)\r\n            try {\r\n                var r = await contract2.methods.totalSupply().call()\r\n                var r = await contract2.methods.balanceOf(ZERO_ADDRESS).call()\r\n                // TODO: 이거 호출될 때 metamask 에러 나는 것 같은데, 확인 필요 { .. -32000, ...}\r\n                return 20\r\n            } catch (e) {\r\n                return 9999 // it's not supports 'supportsInterface' and 'totalSupply'\r\n            }\r\n        }\r\n\r\n        var is1155 = await contract.methods.supportsInterface(erc1155ID).call()\r\n        if (is1155) {\r\n            return 1155\r\n        }\r\n\r\n        return 9999\r\n    }\r\n\r\n    ////////////////////////////\r\n    // Royalty\r\n    ////////////////////////////\r\n    async getRoyaltiesOwner(contractAddress, tokenId) {\r\n        this._verifyParamAddress([contractAddress])\r\n        this._verifyParamUintNumber([tokenId])\r\n\r\n        // RoyaltyV2\r\n        const nftContract = this._makeContractInstance(NFTContract, contractAddress)\r\n        var rOwner = await nftContract.methods.getRoyaltyOwner(tokenId).call()\r\n        if (rOwner && rOwner != ZERO_ADDRESS) {\r\n            console.log(`nftContract.getRoyaltyOwner works PARU#${tokenId}'s royaltyOwner -> ${rOwner}`)\r\n            return rOwner\r\n        } // EndOf - RoyaltyV2\r\n\r\n        const royaltiesRegistry = this._makeContractInstance(RoyaltiesRegistry, this.royaltiesAddress)\r\n        return await royaltiesRegistry.methods.getRoyaltiesOwner(contractAddress, tokenId).call()\r\n    }\r\n\r\n    async getRoyalties(contractAddress, tokenId) {\r\n        this._verifyParamAddress([contractAddress])\r\n        this._verifyParamUintNumber([tokenId])\r\n\r\n        // RoyaltyV2\r\n        const nftContract = this._makeContractInstance(NFTContract, contractAddress)\r\n        var royalties = await nftContract.methods.getRoyalties(tokenId).call()\r\n        if (royalties.length > 0) {\r\n            console.log(`nftContract.getRoyalties works. PARU#${tokenId}'s royalties: ${royalties}`)\r\n            return royalties\r\n        } // EO - RoyaltyV2\r\n\r\n        const royaltiesRegistry = this._makeContractInstance(RoyaltiesRegistry, this.royaltiesAddress)\r\n        return await royaltiesRegistry.methods.getRoyalties(contractAddress, tokenId).call()\r\n    }\r\n\r\n    async transferRoyaltiesOwnership(contractAddress, tokenId, ownerNew, from) {\r\n        this._verifyParamAddress([contractAddress, ownerNew, from])\r\n        this._verifyParamUintNumber([tokenId])\r\n\r\n        var ownerNew = ownerNew.toLowerCase()\r\n        var ownerBefore = await this.getRoyaltiesOwner(contractAddress, tokenId)\r\n        if (ownerBefore.toLowerCase() == ownerNew) {\r\n            return {\r\n                status: true,\r\n                ownerBefore\r\n            }\r\n        }\r\n\r\n        // RoyaltyV2\r\n        try {\r\n            const nftContract = this._makeContractInstance(NFTContract, contractAddress)\r\n            var _callobj = nftContract.methods.transferRoyaltyOwnership(tokenId, ownerNew)\r\n            var res = await this.sendTransactionAndConfirm(\r\n                from, contractAddress, _callobj, {},\r\n                EventType.TransferRoyaltiesOwnership, 'Transfer royalties ownership'\r\n            )\r\n            if (res.status == true) {\r\n                return {\r\n                    ...res,\r\n                    ownerBefore\r\n                }\r\n            }\r\n        } catch (e) {\r\n            console.error(e)\r\n        }\r\n        // EO - RoyaltyV2\r\n\r\n        const royaltiesRegistry = this._makeContractInstance(RoyaltiesRegistry, this.royaltiesAddress)\r\n        var _callobj = royaltiesRegistry.methods.transferRoyaltiesOwnership(contractAddress, tokenId, ownerNew)\r\n        var res = await this.sendTransactionAndConfirm(\r\n            from, this.royaltiesAddress, _callobj, {},\r\n            EventType.TransferRoyaltiesOwnership, 'Transfer royalties ownership'\r\n        )\r\n        return {\r\n            ...res,\r\n            ownerBefore\r\n        }\r\n    }\r\n\r\n    async updateRoyalties(contractAddress, tokenId, royaltiesNew, from) {\r\n        this._verifyParamAddress([contractAddress, from])\r\n        this._verifyParamUintNumber([tokenId])\r\n        this._verifyParamTypePart([royaltiesNew]) // TODO: 100곱해서 입력하게 할지 아니면 안에서 100 곱할지에 따라서 검사 달라진다. 그리고 그에 맞는 최대값 검사도 추가 필요함(총합 100%이하)\r\n\r\n        let tokenOwner;\r\n        try {\r\n            tokenOwner = await this.getTokenOwnerOf(contractAddress, tokenId)\r\n        } catch (err) {\r\n            return {\r\n                status: false,\r\n                err: `contract or tokenId problem:: ${JSON.stringify(err)}`\r\n            }\r\n        }\r\n        // var res = await parula.updateRoyalties(parula.nftAddress, tokenId, royaltiesTo, ALICE_ADDRESS)\r\n\r\n        var from = from.toLowerCase()\r\n        var ownerBefore = await this.getRoyaltiesOwner(contractAddress, tokenId)\r\n        if ((ownerBefore == ZERO_ADDRESS && tokenOwner.toLowerCase() == from) // ownerBefore가 zero고, tokenOwner(erc721.ownerOf(address)가 맞거나\r\n            ||\r\n            (ownerBefore.toLowerCase() == from)) { // royaltiesOwnership이 from면 성공한다\r\n            // update 한다\r\n            var _royaltiesBefore = await this.getRoyalties(contractAddress, tokenId)\r\n            //RoyaltyV2\r\n            try {\r\n                var nftCont = this._makeContractInstance(NFTContract, contractAddress)\r\n                var _callobj = await nftCont.methods.updateRoyalty(tokenId, royaltiesNew)\r\n                var res = await this.sendTransactionAndConfirm(\r\n                    from, contractAddress, _callobj, {},\r\n                    EventType.UpdateRoyalties, 'Update royalties'\r\n                )\r\n                if (res.status == true) {\r\n                    return {\r\n                        ...res,\r\n                        royaltiesBefore: _royaltiesBefore,\r\n                        royaltiesNew\r\n                    }\r\n                }\r\n            } catch (e) {\r\n                console.log(e)\r\n            }\r\n            // EO - RoyaltyV2\r\n\r\n            const royaltiesRegistry = this._makeContractInstance(RoyaltiesRegistry, this.royaltiesAddress)\r\n            var _callobj = royaltiesRegistry.methods.setRoyaltiesByTokenAndTokenId(contractAddress, tokenId, royaltiesNew)\r\n            var res = await this.sendTransactionAndConfirm(\r\n                from, this.royaltiesAddress, _callobj, {},\r\n                EventType.UpdateRoyalties, 'Update royalties'\r\n            )\r\n            return {\r\n                ...res,\r\n                royaltiesBefore: _royaltiesBefore,\r\n                royaltiesNew\r\n            }\r\n        } else {\r\n            // 실패시킨다\r\n            return {\r\n                status: false,\r\n                tokenOwner,\r\n                ownerBefore,\r\n                'updateRequestedFrom': from,\r\n                err: 'ownership problem'\r\n            }\r\n        }\r\n    }\r\n    ////////////////////////////\r\n    // end of Royalty\r\n    ////////////////////////////\r\n\r\n    // TODO: consider update metadata\r\n\r\n    async _matchOrders(leftOrder, leftSignature, rightOrder, rightSignature, from, value = 0) {\r\n        const exchange = this._makeContractInstance(Exchange, this.exchangeAddress)\r\n\r\n        var to = this.exchangeAddress\r\n        var _callobj = exchange.methods.matchOrders(leftOrder, leftSignature, rightOrder, rightSignature)\r\n\r\n        var _param = {\r\n            value\r\n        }\r\n        var ret = await this.sendTransactionAndConfirm(from, to, _callobj, _param, EventType.MatchOrders, \"Match orders\")\r\n        console.log('ret::222', ret)\r\n        return ret\r\n    }\r\n\r\n    async _approveTransferProxy(asset_type, contract_address, approve_amount, from) {\r\n        // function isApprovedForAll(address owner, address operator)\r\n        // function setApprovalForAll(address operator, bool approved) public virtual override\r\n        let ret\r\n        var to = contract_address\r\n        var _param = {}\r\n        if (asset_type == ERC20) {\r\n            const transfer_proxy = this.erc20TransferProxyAddress\r\n            const ierc20 = this._makeContractInstance(IERC20, contract_address)\r\n\r\n            // check allowance(operator, spender) returns(uint256)\r\n            var allowance = await ierc20.methods.allowance(from, transfer_proxy).call()\r\n            if (allowance >= approve_amount) {\r\n                // skip approve if allowance is enough\r\n                try {\r\n                    var _symbol = await this.web3.eth.call({\r\n                        from,\r\n                        to: contract_address,\r\n                        data: this.web3.eth.abi.encodeFunctionSignature(\"symbol()\")\r\n                    })\r\n                    var symbol = this.web3.eth.abi.decodeParameter(\"string\", _symbol)\r\n                    this.logger(`${from} approve ${symbol}:${allowance} for ${transfer_proxy}`)\r\n                } catch (e) {\r\n                    this.logger(e)\r\n                }\r\n                ret = {\r\n                    status: true\r\n                }\r\n            } else {\r\n                var _callobj = ierc20.methods.approve(transfer_proxy, approve_amount)\r\n                ret = await this.sendTransactionAndConfirm(from, to, _callobj, _param, EventType.ApproveCurrency, \"Approve currency\")\r\n            }\r\n        } else if (asset_type == ERC721 || asset_type == ERC1155) {\r\n            // 721: function setApprovalForAll(address operator, bool _approved) external;\r\n            // 1155: function setApprovalForAll(address _operator, bool _approved) external;\r\n            const transfer_proxy = this.transferProxyAddress // transfer-proxy! not exchange\r\n            let ierc, _callobj\r\n            if (asset_type == ERC721) {\r\n                ierc = this._makeContractInstance(NFTContract, contract_address)\r\n            } else {\r\n                ierc = this._makeContractInstance(NFT1155Contract, contract_address)\r\n            }\r\n            // check isApprovedForAll(owner, operator) returns(bool)\r\n            var isApproved = await ierc.methods.isApprovedForAll(from, transfer_proxy).call()\r\n            if (isApproved) {\r\n                // skip setApprovalForAll if already approved\r\n                var symbol = await ierc.methods.symbol().call()\r\n                this.logger(`${from} approve ${symbol}# for ${transfer_proxy}`)\r\n                ret = {\r\n                    status: true\r\n                }\r\n            } else {\r\n                _callobj = ierc.methods.setApprovalForAll(transfer_proxy, true)\r\n                ret = await this.sendTransactionAndConfirm(from, to, _callobj, _param, EventType.ApproveOrder, \"Set approval for all\")\r\n            }\r\n        } else { // ETH\r\n            ret = {\r\n                status: true\r\n            }\r\n        }\r\n        var err = ret.status ? '' : \"approve fail\"\r\n        return {\r\n            ...ret,\r\n            err\r\n        }\r\n    }\r\n\r\n    async _makeOrderAndApprove(maker, makerAsset, taker, takerAsset, salt, start, end, dataType, encData) {\r\n        this._verifyParamAddress([maker, taker])\r\n        this._verifyParamUintNumber([salt, start, end])\r\n        this._verifyParamAsset([makerAsset, takerAsset])\r\n\r\n        // need to verify [dataType, encData] \r\n\r\n        // validate maker, taker addresses\r\n        // validate assets\r\n        var order = Order(\r\n            maker,\r\n            makerAsset, // Asset(ETH, \"0x\", 200), \r\n            taker, // can be ZERO\r\n            takerAsset, // Asset(ERC721, enc(erc721.address, erc721TokenId1), 1), \r\n            salt, // \r\n            start, // \r\n            end, // \r\n            dataType, // ORDER_DATA_V1 (DT magic value)\r\n            encData // encDataRight (DT encrypted)\r\n        );\r\n\r\n        // sign\r\n        let data, signature\r\n        if (salt != 0) {\r\n            const _signed_data_and_sign = await createTypedDataAndSignature(this.web3, this.exchangeAddress, order, maker)\r\n            signature = _signed_data_and_sign.sig\r\n            data = _signed_data_and_sign.data\r\n        } else {\r\n            signature = '0x0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000'\r\n            data = ''\r\n        }\r\n        const {\r\n            typeMV,\r\n            contractAddress,\r\n            value\r\n        } = decAsset(this.web3, makerAsset)\r\n\r\n        var ret = await this._approveTransferProxy(typeMV, contractAddress, value, maker)\r\n        return {\r\n            ...ret,\r\n            order,\r\n            data,\r\n            signature\r\n        }\r\n    }\r\n\r\n    async _extractTransferInfo(txHash) {\r\n        // parse ERC721-Transfer event\r\n        const receipt = await this.web3.eth.getTransactionReceipt(txHash)\r\n        // console.log(receipt.logs)\r\n        // receipt.transactionHash // txHash\r\n        let log = receipt.logs[0] // TODO: log가 여러 개일 때는 어떻게 할겨// arr = logs.map(log => { .. from = decode('address', log.topics[1]) ..})\r\n\r\n        // log.data // non-indexed 필드 데이터들이 여기에 저장됨(indexed 필드는 topics에)\r\n        // keccak256('Transfer(address,address,uint256)')\r\n        const sigTransfer721 = '0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef'\r\n        const sigTransfer1155 = '0xc3d58168c5ae7397731d063d5bbf3d657854427343f4c083240f7aacaa2d0f62'\r\n        // console.log(receipt)  // ganacli 에서 테스트하려고 했는데, event 발생이 안되네;\r\n        var sigEvt = log.topics[0]\r\n\r\n        let from, to, tokenId, quantity = 0;\r\n        if (sigEvt == sigTransfer721) {\r\n            from = this.web3.eth.abi.decodeParameter('address', log.topics[1]) // from\r\n            to = this.web3.eth.abi.decodeParameter('address', log.topics[2]) // to\r\n            tokenId = this.web3.eth.abi.decodeParameter('uint', log.topics[3]) // tokenId (hex)\r\n        } else if (sigEvt == sigTransfer1155) {\r\n            // in IERC1155\r\n            //   event TransferSingle(address indexed operator, address indexed from, address indexed to, uint256 id, uint256 value);\r\n            from = this.web3.eth.abi.decodeParameter('address', log.topics[2]) // from\r\n            to = this.web3.eth.abi.decodeParameter('address', log.topics[3]) // to\r\n\r\n            var r = this.web3.eth.abi.decodeParameter('(uint256,uint256)', log.data)\r\n            tokenId = r[0]\r\n            quantity = r[1]\r\n        } else {\r\n            this.logger('event type is not handled.')\r\n            console.log(log)\r\n            return {}\r\n        }\r\n\r\n        var blockNumber = log.blockNumber;\r\n        var contractAddress = log.address // contract\r\n        var isMinted = (from == ZERO_ADDRESS) ? true : false\r\n\r\n        // parse unindexed parameter  https://medium.com/linum-labs/everything-you-ever-wanted-to-know-about-events-and-logs-on-ethereum-fec84ea7d0a5\r\n        // const decoder = new ethers.utils.AbiCoder();\r\n        // const unindexedEvents = events.inputs.filter(event => event.indexed === false);\r\n        // const decodedLogs = logs.map(log => decoder.decode(unindexedEvents, log.data)\r\n\r\n        return {\r\n            blockNumber,\r\n            txHash,\r\n            contractAddress,\r\n            tokenId: Number(tokenId),\r\n            quantity: Number(quantity),\r\n            from,\r\n            to,\r\n            isMinted\r\n        }\r\n\r\n        // https://gist.github.com/wschwab/528153cb6f2ea17ef9eee0c180425961\r\n        // https://gist.github.com/wschwab/6e89eeb29a8e24203ee954c042e47a6f\r\n\r\n    }\r\n\r\n    async sendTransactionAndConfirm(from, to, _callobj, _param, evtType, log) {\r\n        const tx = await this._lowLevelSend(from, to, _callobj, _param)\r\n        if (tx.status) {\r\n            const isConfirmed = await this._confirmTransaction(tx.transactionHash, evtType, log)\r\n            return {\r\n                status: isConfirmed,\r\n                tx\r\n            }\r\n        } else {\r\n            return {\r\n                status: false,\r\n                tx\r\n            }\r\n        }\r\n    }\r\n\r\n    async _lowLevelSend(from, to, _callobj, _param) {\r\n        var data = _callobj.encodeABI()\r\n        var gasPrice = await this._computeGasPrice()\r\n        try {\r\n            var gas = await _callobj.estimateGas({\r\n                from,\r\n                to,\r\n                ..._param\r\n            })\r\n            return await this.web3.eth.sendTransaction({\r\n                from,\r\n                to,\r\n                data,\r\n                gas,\r\n                gasPrice,\r\n                ..._param\r\n            })\r\n        } catch (err) {\r\n            return {\r\n                status: false,\r\n                err\r\n            }\r\n        }\r\n    }\r\n\r\n    async _lowLevelCall(from, to, _call) {\r\n        var data = _call.encodeABI()\r\n        try {\r\n            var ret = await web3.eth.call({\r\n                from,\r\n                to,\r\n                data\r\n            })\r\n            return this.web3.eth.abi.decodeParameters(_call._method.outputs, ret)[0]\r\n        } catch (err) {\r\n            return {}\r\n        }\r\n    }\r\n\r\n    async _computeGasPrice() {\r\n        const meanGas = await this.web3.eth.getGasPrice()\r\n        const weiToAdd = Web3.utils.toBN(this.web3.utils.toWei(this.gasPriceAddition, 'gwei'))\r\n        return Web3.utils.toBN(meanGas).add(weiToAdd).toString()\r\n    }\r\n\r\n    async _confirmTransaction(transactionHash, event, description, testForSuccess) {\r\n        const transactionEventData = {\r\n            transactionHash,\r\n            event\r\n        }\r\n        this.logger(`transaction started - ${description}`)\r\n\r\n        if (transactionHash == NULL_BLOCK_HASH) {\r\n            // This was a smart contract wallet that doesn't know the transaction\r\n            this._dispatch(EventType.TransactionCreated, {\r\n                event\r\n            })\r\n\r\n            if (!testForSuccess) {\r\n                // Wait if test not implemented\r\n                this.logger(`Unknown action, waiting 1 minute: ${description}`)\r\n                await delay(60 * 1000)\r\n                return\r\n            }\r\n            return await this._pollCallbackForConfirmation(event, description, testForSuccess)\r\n        }\r\n\r\n        // Normal wallet\r\n        try {\r\n            this._dispatch(EventType.TransactionCreated, transactionEventData)\r\n            await confirmTransaction(this.web3, transactionHash)\r\n            this.logger(`transaction succeed - ${description}`)\r\n            this._dispatch(EventType.TransactionConfirmed, transactionEventData)\r\n            return true\r\n        } catch (error) {\r\n            this.logger(`transaction failed: - ${description}`)\r\n            this._dispatch(EventType.TransactionFailed, {\r\n                ...transactionEventData,\r\n                error\r\n            })\r\n            throw error\r\n        }\r\n    }\r\n\r\n    async _pollCallbackForConfirmation(event, description, testForSuccess) {\r\n        return new Promise(async (resolve, reject) => {\r\n            const initialRetries = 60\r\n            // const testResolve: (r: number) => Promise<void> = async retries => {\r\n            const testResolve = async retries => {\r\n                const wasSuccessful = await testForSuccess()\r\n                if (wasSuccessful) {\r\n                    this.logger(`Transaction succeeded: ${description}`)\r\n                    this._dispatch(EventType.TransactionConfirmed, {\r\n                        event\r\n                    })\r\n                    return resolve(true)\r\n                } else if (retries <= 0) {\r\n                    return reject(false)\r\n                }\r\n\r\n                if (retries % 10 == 0) {\r\n                    this.logger(`Tested transaction ${initialRetries - retries + 1} times: ${description}`)\r\n                }\r\n\r\n                await delay(5000)\r\n                return testResolve(retries - 1)\r\n            }\r\n\r\n            return testResolve(initialRetries)\r\n        })\r\n    }\r\n\r\n    _dispatch(event, data) {\r\n        this._emitter.emit(event, data)\r\n    }\r\n\r\n    _makeContractInstance(contractAbi, contractAddress = null) {\r\n        return makeContractInstance(this.web3, this.netId, contractAbi, contractAddress)\r\n    }\r\n\r\n    _encAssetData(typeMV, contractAddress, value) {\r\n        let assetData\r\n        if (typeMV == ETH) {\r\n            // assetData = \"0x\" //ZERO_ADDRESS\r\n            assetData = enc(this.web3, ZERO_ADDRESS)\r\n        } else if (typeMV == ERC20) {\r\n            assetData = enc(this.web3, contractAddress)\r\n        } else if (typeMV == ERC721 || typeMV == ERC1155) {\r\n            assetData = enc(this.web3, contractAddress, value)\r\n        } else {\r\n            console.trace()\r\n            throw `unknown type magic-value (${typeMV})`\r\n        }\r\n        return assetData\r\n    }\r\n\r\n    _verifyParamAddress(addressesToVerify) {\r\n        addressesToVerify.forEach(one => {\r\n            if (one == undefined) {\r\n                console.trace()\r\n                throw `Address 'undefined' passed`\r\n            }\r\n            if (one.length != 42) {\r\n                console.trace()\r\n                throw `Address length incorrect :${one}`\r\n            }\r\n        })\r\n    }\r\n    _verifyParamTypeMV(typesToVrify) {\r\n        typesToVrify.forEach(one => {\r\n            if (one == undefined) {\r\n                console.trace()\r\n                throw `typeMV 'undefined' passed`\r\n            }\r\n            if (one.length != 10) {\r\n                console.trace()\r\n                throw `typeMV length incorrect : ${one}`\r\n            }\r\n        })\r\n    }\r\n    _verifyParamUintNumber(valuesToVerify) {\r\n        valuesToVerify.forEach(one => {\r\n            if (one == undefined) {\r\n                console.trace()\r\n                throw `value 'undefined' passed`\r\n            }\r\n            if (typeof one != 'number') {\r\n                console.trace()\r\n                throw `value is not 'number' type ${typeof one}`\r\n            }\r\n            if (Number(one.toFixed()) != one) {\r\n                console.trace()\r\n                throw `value is not integer`\r\n            }\r\n            if (one < 0) {\r\n                console.trace()\r\n                throw `value incorrect ${one}`\r\n            }\r\n        })\r\n    }\r\n\r\n    _verifyParamTypePart(partsToVerify) {\r\n        // typePart is struct defined in Libpart.sol, 'Libpart.Part[]'\r\n        partsToVerify.forEach(partToVerify => {\r\n            partToVerify.forEach(one => {\r\n                if (one == undefined) {\r\n                    console.trace()\r\n                    throw `value 'undefined' passed`\r\n                }\r\n                if (one.length > 0) {\r\n                    var account = one[0]\r\n                    var value = one[1]\r\n                    this._verifyParamAddress([account])\r\n                    this._verifyParamUintNumber([value])\r\n                }\r\n            })\r\n        })\r\n    }\r\n\r\n    _verifyParamAsset(assetsToVerify) {\r\n        assetsToVerify.forEach(one => {\r\n            if (one == undefined) {\r\n                console.trace()\r\n                throw `asset 'undefined' passed`\r\n            }\r\n            const {\r\n                assetType,\r\n                value\r\n            } = one\r\n            if (assetType == undefined) {\r\n                console.trace()\r\n                throw `assetType 'undefined' passed`\r\n            }\r\n            this._verifyParamUintNumber([value])\r\n        })\r\n    }\r\n\r\n    _checkDiffAssets(asset1, asset2) {\r\n        if (asset1.value != asset2.value ||\r\n            asset1.assetType.assetClass != asset2.assetType.assetClass ||\r\n            asset1.assetType.data != asset2.assetType.data\r\n        ) {\r\n            console.trace()\r\n            throw `asset not matched`\r\n        }\r\n    }\r\n\r\n    toBN(number) {\r\n        return new this.web3.utils.BN(number)\r\n    }\r\n}\r\n\r\n// export default Parula;\r\nmodule.exports = {\r\n    Parula\r\n}"]}]}